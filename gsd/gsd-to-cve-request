#!/bin/bash
#
# Convert a gsd request file into an upstream git id to feed as a request
#
# Warning, almost no error checking, this is a hack to get things converted only.
#

in_file=$1
out_file=$2

for record in $(cat ${in_file}); do
	stable_id=$(echo "${record}" | cut -f 3 -d ',')
	echo -n "record=${record} stable_id=${stable_id} "
	upstream=$(cd /home/gregkh/linux/next/ && git show ${stable_id} | grep -i upstream | head -n 1)
	if [[ ${upstream} =~ [[:xdigit:]]{40} ]] ; then
		upstream_id=${BASH_REMATCH[0]}
		echo "upstream_id=${upstream_id}"
		echo "${upstream_id}" >> ${out_file}
	else
		echo "NOT FOUND"
	fi
done
