From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53717: wifi: ath9k: Fix potential stack-out-of-bounds write in ath9k_wmi_rsp_callback()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

wifi: ath9k: Fix potential stack-out-of-bounds write in ath9k_wmi_rsp_callback()

Fix a stack-out-of-bounds write that occurs in a WMI response callback
function that is called after a timeout occurs in ath9k_wmi_cmd().
The callback writes to wmi->cmd_rsp_buf, a stack-allocated buffer that
could no longer be valid when a timeout occurs. Set wmi->last_seq_id to
0 when a timeout occurred.

Found by a modified version of syzkaller.

BUG: KASAN: stack-out-of-bounds in ath9k_wmi_ctrl_rx
Write of size 4
Call Trace:
 memcpy
 ath9k_wmi_ctrl_rx
 ath9k_htc_rx_msg
 ath9k_hif_usb_reg_in_cb
 __usb_hcd_giveback_urb
 usb_hcd_giveback_urb
 dummy_timer
 call_timer_fn
 run_timer_softirq
 __do_softirq
 irq_exit_rcu
 sysvec_apic_timer_interrupt

The Linux kernel CVE team has assigned CVE-2023-53717 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 4.14.308 with commit 89a33c3c847b19b19205cde1d924df2a6c70d8eb
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 4.19.276 with commit ae4933b4f17de8e2b7ff6f91b17d3b0099a6d6bc
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 5.4.235 with commit bf6dc175a2b53098a69db1236d9d53982f4b1bc0
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 5.10.173 with commit 78b56b0a613a87b61290b95be497fdfe2fe58aa6
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 5.15.99 with commit 1af7eacfad45149c54893a8a9df9e92ef89f0a90
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 6.1.16 with commit 8f28513d9520184059530c01a9f928a1b3809d3f
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 6.2.3 with commit 554048a72d7ecfdd58cc1bfb56e0a1864e64e82c
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 6.3 with commit 8a2f35b9830692f7a616f2f627f943bc748af13a

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53717
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/wireless/ath/ath9k/wmi.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/89a33c3c847b19b19205cde1d924df2a6c70d8eb
	https://git.kernel.org/stable/c/ae4933b4f17de8e2b7ff6f91b17d3b0099a6d6bc
	https://git.kernel.org/stable/c/bf6dc175a2b53098a69db1236d9d53982f4b1bc0
	https://git.kernel.org/stable/c/78b56b0a613a87b61290b95be497fdfe2fe58aa6
	https://git.kernel.org/stable/c/1af7eacfad45149c54893a8a9df9e92ef89f0a90
	https://git.kernel.org/stable/c/8f28513d9520184059530c01a9f928a1b3809d3f
	https://git.kernel.org/stable/c/554048a72d7ecfdd58cc1bfb56e0a1864e64e82c
	https://git.kernel.org/stable/c/8a2f35b9830692f7a616f2f627f943bc748af13a
