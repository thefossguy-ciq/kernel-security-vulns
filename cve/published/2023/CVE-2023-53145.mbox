From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53145: Bluetooth: btsdio: fix use after free bug in btsdio_remove due to race condition
Message-Id: <2025051018-CVE-2023-53145-281f@gregkh>
Content-Length: 2595
Lines: 62
X-Developer-Signature: v=1; a=openpgp-sha256; l=2658;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=jtRjLwO9X3RXsq+rOj93Fma0SmzUmLRvSmXJc0C1bNc=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBnyCWnnn7yR3fTptZbdTta1Gj9S1Tzqrmw69YzTW+eec
 tBpyTtcHbEsDIJMDLJiiixftvEc3V9xSNHL0PY0zBxWJpAhDFycAjARU2aG+enWPzetat9t1zT5
 KIPinSb3mdErWxgWbFm+MX1GOtMJ75c5bCtmfldkzjGxBgA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

Bluetooth: btsdio: fix use after free bug in btsdio_remove due to race condition

In btsdio_probe, the data->work is bound with btsdio_work. It will be
started in btsdio_send_frame.

If the btsdio_remove runs with a unfinished work, there may be a race
condition that hdev is freed but used in btsdio_work. Fix it by
canceling the work before do cleanup in btsdio_remove.

The Linux kernel CVE team has assigned CVE-2023-53145 to this issue.


Affected and fixed versions
===========================

	Fixed in 4.14.326 with commit 6c3653627397a0d6eab19b20a59423e118985a6b
	Fixed in 4.19.295 with commit 3efcbf25e5ab4d4ad1b7e6ba0869ff85540e3f6e
	Fixed in 5.4.257 with commit a6650d27ab2c12a8ee750f396edb5ac8b4558b2e
	Fixed in 5.10.195 with commit 746b363bef41cc159c051c47f9e30800bc6b520d
	Fixed in 5.15.131 with commit a5c2a467e9e789ae0891de55b766daac52e3b7b3
	Fixed in 6.1.52 with commit 179c65828593aff1f444e15debd40a477cb23cf4
	Fixed in 6.3 with commit 73f7b171b7c09139eb3c6a5677c200dc1be5f318

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53145
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/bluetooth/btsdio.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/6c3653627397a0d6eab19b20a59423e118985a6b
	https://git.kernel.org/stable/c/3efcbf25e5ab4d4ad1b7e6ba0869ff85540e3f6e
	https://git.kernel.org/stable/c/a6650d27ab2c12a8ee750f396edb5ac8b4558b2e
	https://git.kernel.org/stable/c/746b363bef41cc159c051c47f9e30800bc6b520d
	https://git.kernel.org/stable/c/a5c2a467e9e789ae0891de55b766daac52e3b7b3
	https://git.kernel.org/stable/c/179c65828593aff1f444e15debd40a477cb23cf4
	https://git.kernel.org/stable/c/73f7b171b7c09139eb3c6a5677c200dc1be5f318
