From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53746: s390/vfio-ap: fix memory leak in vfio_ap device driver

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

s390/vfio-ap: fix memory leak in vfio_ap device driver

The device release callback function invoked to release the matrix device
uses the dev_get_drvdata(device *dev) function to retrieve the
pointer to the vfio_matrix_dev object in order to free its storage. The
problem is, this object is not stored as drvdata with the device; since the
kfree function will accept a NULL pointer, the memory for the
vfio_matrix_dev object is never freed.

Since the device being released is contained within the vfio_matrix_dev
object, the container_of macro will be used to retrieve its pointer.

The Linux kernel CVE team has assigned CVE-2023-53746 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.20 with commit 1fde573413b549d52183382e639c1d6ce88f5959 and fixed in 5.4.240 with commit 5195de1d5f66b276683240a896783f7f43c4f664
	Issue introduced in 4.20 with commit 1fde573413b549d52183382e639c1d6ce88f5959 and fixed in 5.10.177 with commit ee17dea3072dec0bc34399a32fa884e26342e4ea
	Issue introduced in 4.20 with commit 1fde573413b549d52183382e639c1d6ce88f5959 and fixed in 5.15.106 with commit aa2bff25e9bb10c935c7ffe3d5f5975bdccb1749
	Issue introduced in 4.20 with commit 1fde573413b549d52183382e639c1d6ce88f5959 and fixed in 6.1.23 with commit 6a40fda14b4be3e38f03cc42ffd4efbc64fb3e67
	Issue introduced in 4.20 with commit 1fde573413b549d52183382e639c1d6ce88f5959 and fixed in 6.2.10 with commit 7b6a02f5bf15931464c79dfd487c57f76aae3496
	Issue introduced in 4.20 with commit 1fde573413b549d52183382e639c1d6ce88f5959 and fixed in 6.3 with commit 8f8cf767589f2131ae5d40f3758429095c701c84

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53746
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/s390/crypto/vfio_ap_drv.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/5195de1d5f66b276683240a896783f7f43c4f664
	https://git.kernel.org/stable/c/ee17dea3072dec0bc34399a32fa884e26342e4ea
	https://git.kernel.org/stable/c/aa2bff25e9bb10c935c7ffe3d5f5975bdccb1749
	https://git.kernel.org/stable/c/6a40fda14b4be3e38f03cc42ffd4efbc64fb3e67
	https://git.kernel.org/stable/c/7b6a02f5bf15931464c79dfd487c57f76aae3496
	https://git.kernel.org/stable/c/8f8cf767589f2131ae5d40f3758429095c701c84
