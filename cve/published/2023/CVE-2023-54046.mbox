From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54046: crypto: essiv - Handle EBUSY correctly

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

crypto: essiv - Handle EBUSY correctly

As it is essiv only handles the special return value of EINPROGERSS,
which means that in all other cases it will free data related to the
request.

However, as the caller of essiv may specify MAY_BACKLOG, we also need
to expect EBUSY and treat it in the same way.  Otherwise backlogged
requests will trigger a use-after-free.

The Linux kernel CVE team has assigned CVE-2023-54046 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.4 with commit be1eb7f78aa8fbe34779c56c266ccd0364604e71 and fixed in 5.4.235 with commit c61e7d182ee3f3f5ecf18a2964e303d49c539b52
	Issue introduced in 5.4 with commit be1eb7f78aa8fbe34779c56c266ccd0364604e71 and fixed in 5.10.173 with commit 796e02cca30a67322161f0745e5ce994bbe75605
	Issue introduced in 5.4 with commit be1eb7f78aa8fbe34779c56c266ccd0364604e71 and fixed in 5.15.99 with commit 840a1d3b77c1b062bd62b4733969a5b1efc274ce
	Issue introduced in 5.4 with commit be1eb7f78aa8fbe34779c56c266ccd0364604e71 and fixed in 6.1.16 with commit a006aa3eedb8bfd6fe317c3cfe9c86ffe76b2385
	Issue introduced in 5.4 with commit be1eb7f78aa8fbe34779c56c266ccd0364604e71 and fixed in 6.2.3 with commit 69c67d451fc19d88e54f7d97e8e7c093e08357e1
	Issue introduced in 5.4 with commit be1eb7f78aa8fbe34779c56c266ccd0364604e71 and fixed in 6.3 with commit b5a772adf45a32c68bef28e60621f12617161556

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54046
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	crypto/essiv.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/c61e7d182ee3f3f5ecf18a2964e303d49c539b52
	https://git.kernel.org/stable/c/796e02cca30a67322161f0745e5ce994bbe75605
	https://git.kernel.org/stable/c/840a1d3b77c1b062bd62b4733969a5b1efc274ce
	https://git.kernel.org/stable/c/a006aa3eedb8bfd6fe317c3cfe9c86ffe76b2385
	https://git.kernel.org/stable/c/69c67d451fc19d88e54f7d97e8e7c093e08357e1
	https://git.kernel.org/stable/c/b5a772adf45a32c68bef28e60621f12617161556
