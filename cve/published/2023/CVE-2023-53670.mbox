From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53670: nvme-core: fix dev_pm_qos memleak

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

nvme-core: fix dev_pm_qos memleak

Call dev_pm_qos_hide_latency_tolerance() in the error unwind patch to
avoid following kmemleak:-

blktests (master) # kmemleak-clear; ./check nvme/044;
blktests (master) # kmemleak-scan ; kmemleak-show
nvme/044 (Test bi-directional authentication)                [passed]
    runtime  2.111s  ...  2.124s
unreferenced object 0xffff888110c46240 (size 96):
  comm "nvme", pid 33461, jiffies 4345365353 (age 75.586s)
  hex dump (first 32 bytes):
    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  backtrace:
    [<0000000069ac2cec>] kmalloc_trace+0x25/0x90
    [<000000006acc66d5>] dev_pm_qos_update_user_latency_tolerance+0x6f/0x100
    [<00000000cc376ea7>] nvme_init_ctrl+0x38e/0x410 [nvme_core]
    [<000000007df61b4b>] 0xffffffffc05e88b3
    [<00000000d152b985>] 0xffffffffc05744cb
    [<00000000f04a4041>] vfs_write+0xc5/0x3c0
    [<00000000f9491baf>] ksys_write+0x5f/0xe0
    [<000000001c46513d>] do_syscall_64+0x3b/0x90
    [<00000000ecf348fe>] entry_SYSCALL_64_after_hwframe+0x72/0xdc

The Linux kernel CVE team has assigned CVE-2023-53670 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.0 with commit f50fff73d620cd6e8f48bc58d4f1c944615a3fea and fixed in 6.1.39 with commit e1379e067b9485e5af03399fe3f0d39bccb023ad
	Issue introduced in 6.0 with commit f50fff73d620cd6e8f48bc58d4f1c944615a3fea and fixed in 6.3.13 with commit 7237c26431cc78e5ec3259f4350f3dd58f6a4319
	Issue introduced in 6.0 with commit f50fff73d620cd6e8f48bc58d4f1c944615a3fea and fixed in 6.4.4 with commit 2ed9a89192e3192e5fea7ff6475c8722513f325e
	Issue introduced in 6.0 with commit f50fff73d620cd6e8f48bc58d4f1c944615a3fea and fixed in 6.5 with commit 7ed5cf8e6d9bfb6a78d0471317edff14f0f2b4dd

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53670
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/nvme/host/core.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/e1379e067b9485e5af03399fe3f0d39bccb023ad
	https://git.kernel.org/stable/c/7237c26431cc78e5ec3259f4350f3dd58f6a4319
	https://git.kernel.org/stable/c/2ed9a89192e3192e5fea7ff6475c8722513f325e
	https://git.kernel.org/stable/c/7ed5cf8e6d9bfb6a78d0471317edff14f0f2b4dd
