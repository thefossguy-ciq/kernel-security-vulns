From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54027: iio: core: Prevent invalid memory access when there is no parent

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

iio: core: Prevent invalid memory access when there is no parent

Commit 813665564b3d ("iio: core: Convert to use firmware node handle
instead of OF node") switched the kind of nodes to use for label
retrieval in device registration.  Probably an unwanted change in that
commit was that if the device has no parent then NULL pointer is
accessed.  This is what happens in the stock IIO dummy driver when a
new entry is created in configfs:

  # mkdir /sys/kernel/config/iio/devices/dummy/foo
  BUG: kernel NULL pointer dereference, address: ...
  ...
  Call Trace:
  __iio_device_register
  iio_dummy_probe

Since there seems to be no reason to make a parent device of an IIO
dummy device mandatory, letâ€™s prevent the invalid memory access in
__iio_device_register when the parent device is NULL.  With this
change, the IIO dummy driver works fine with configfs.

The Linux kernel CVE team has assigned CVE-2023-54027 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.19 with commit 813665564b3d7c74412fe2877520f1d254ce948a and fixed in 6.1.46 with commit 312f04ede209f0a186799fe8e64a19b49700d5dc
	Issue introduced in 5.19 with commit 813665564b3d7c74412fe2877520f1d254ce948a and fixed in 6.4.11 with commit a4b34cccff14ce74bb7d77fbfd56e7c9d7c28a97
	Issue introduced in 5.19 with commit 813665564b3d7c74412fe2877520f1d254ce948a and fixed in 6.5 with commit b2a69969908fcaf68596dfc04369af0fe2e1d2f7

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54027
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/iio/industrialio-core.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/312f04ede209f0a186799fe8e64a19b49700d5dc
	https://git.kernel.org/stable/c/a4b34cccff14ce74bb7d77fbfd56e7c9d7c28a97
	https://git.kernel.org/stable/c/b2a69969908fcaf68596dfc04369af0fe2e1d2f7
