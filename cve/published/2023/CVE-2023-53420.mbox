From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53420: ntfs: Fix panic about slab-out-of-bounds caused by ntfs_listxattr()
Message-Id: <2025091855-CVE-2023-53420-e1ce@gregkh>
Content-Length: 2835
Lines: 67
X-Developer-Signature: v=1; a=openpgp-sha256; l=2903;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=TPOFe60bX54gjlCl+MuHHOAakGxnJDukq55ImjuG9Tg=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBlndLO3V0ZVzJ5m0bfixWKWSz+W5qufbVDf5PPA0nLnP
 ZZW2Tz2jlgWBkEmBlkxRZYv23iO7q84pOhlaHsaZg4rE8gQBi5OAZjILR6GBY1m1XzZy1I2lLe0
 fvri/2lP5NHG6QzzS2x2XG0uSPl8QFWh6lnV+zlOV64VAAA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ntfs: Fix panic about slab-out-of-bounds caused by ntfs_listxattr()

Here is a BUG report from syzbot:

BUG: KASAN: slab-out-of-bounds in ntfs_list_ea fs/ntfs3/xattr.c:191 [inline]
BUG: KASAN: slab-out-of-bounds in ntfs_listxattr+0x401/0x570 fs/ntfs3/xattr.c:710
Read of size 1 at addr ffff888021acaf3d by task syz-executor128/3632

Call Trace:
 ntfs_list_ea fs/ntfs3/xattr.c:191 [inline]
 ntfs_listxattr+0x401/0x570 fs/ntfs3/xattr.c:710
 vfs_listxattr fs/xattr.c:457 [inline]
 listxattr+0x293/0x2d0 fs/xattr.c:804

Fix the logic of ea_all iteration. When the ea->name_len is 0,
return immediately, or Add2Ptr() would visit invalid memory
in the next loop.

[almaz.alexandrovich@paragon-software.com: lines of the patch have changed]

The Linux kernel CVE team has assigned CVE-2023-53420 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.15 with commit be71b5cba2e6485e8959da7a9f9a44461a1bb074 and fixed in 5.15.121 with commit f3380d895e28a32632eb3609f5bd515adee4e5a1
	Issue introduced in 5.15 with commit be71b5cba2e6485e8959da7a9f9a44461a1bb074 and fixed in 6.1.39 with commit c86a2517df6c9304db8fb12b77136ec7a5d85994
	Issue introduced in 5.15 with commit be71b5cba2e6485e8959da7a9f9a44461a1bb074 and fixed in 6.4.4 with commit 721b75ea2dfce53a8890dff92ae01afca8e74f88
	Issue introduced in 5.15 with commit be71b5cba2e6485e8959da7a9f9a44461a1bb074 and fixed in 6.5 with commit 3c675ddffb17a8b1e32efad5c983254af18b12c2

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53420
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/ntfs3/xattr.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/f3380d895e28a32632eb3609f5bd515adee4e5a1
	https://git.kernel.org/stable/c/c86a2517df6c9304db8fb12b77136ec7a5d85994
	https://git.kernel.org/stable/c/721b75ea2dfce53a8890dff92ae01afca8e74f88
	https://git.kernel.org/stable/c/3c675ddffb17a8b1e32efad5c983254af18b12c2
