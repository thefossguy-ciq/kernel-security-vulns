From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53723: drm/amdgpu: disable sdma ecc irq only when sdma RAS is enabled in suspend
Message-Id: <2025102215-CVE-2023-53723-8e9e@gregkh>
Content-Length: 3687
Lines: 79
X-Developer-Signature: v=1; a=openpgp-sha256; l=3767;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=dY+hNjen/wifkspWE2dP888crfM1jXuCOyFK/0nxxMc=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBk/bv2vP9HYPt/p0PdkFk2lI9LPt9sxT0j5pGp48ZDrv
 o1rdqxY2RHLwiDIxCArpsjyZRvP0f0VhxS9DG1Pw8xhZQIZwsDFKQATkb/OsGBqe9uTL35cb3Xu
 /OaQjfXefns1UzrDgj4DlT36G8ym/+jRLTdfX3rU+UCSHAA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/amdgpu: disable sdma ecc irq only when sdma RAS is enabled in suspend

sdma_v4_0_ip is shared on a few asics, but in sdma_v4_0_hw_fini,
driver unconditionally disables ecc_irq which is only enabled on
those asics enabling sdma ecc. This will introduce a warning in
suspend cycle on those chips with sdma ip v4.0, while without
sdma ecc. So this patch correct this.

[ 7283.166354] RIP: 0010:amdgpu_irq_put+0x45/0x70 [amdgpu]
[ 7283.167001] RSP: 0018:ffff9a5fc3967d08 EFLAGS: 00010246
[ 7283.167019] RAX: ffff98d88afd3770 RBX: 0000000000000001 RCX: 0000000000000000
[ 7283.167023] RDX: 0000000000000000 RSI: ffff98d89da30390 RDI: ffff98d89da20000
[ 7283.167025] RBP: ffff98d89da20000 R08: 0000000000036838 R09: 0000000000000006
[ 7283.167028] R10: ffffd5764243c008 R11: 0000000000000000 R12: ffff98d89da30390
[ 7283.167030] R13: ffff98d89da38978 R14: ffffffff999ae15a R15: ffff98d880130105
[ 7283.167032] FS:  0000000000000000(0000) GS:ffff98d996f00000(0000) knlGS:0000000000000000
[ 7283.167036] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 7283.167039] CR2: 00000000f7a9d178 CR3: 00000001c42ea000 CR4: 00000000003506e0
[ 7283.167041] Call Trace:
[ 7283.167046]  <TASK>
[ 7283.167048]  sdma_v4_0_hw_fini+0x38/0xa0 [amdgpu]
[ 7283.167704]  amdgpu_device_ip_suspend_phase2+0x101/0x1a0 [amdgpu]
[ 7283.168296]  amdgpu_device_suspend+0x103/0x180 [amdgpu]
[ 7283.168875]  amdgpu_pmops_freeze+0x21/0x60 [amdgpu]
[ 7283.169464]  pci_pm_freeze+0x54/0xc0

The Linux kernel CVE team has assigned CVE-2023-53723 to this issue.


Affected and fixed versions
===========================

	Fixed in 5.4.243 with commit 3decf3a750a924362bf4e2680dd3b07242fe56e8
	Fixed in 5.10.180 with commit c1420276be7a98df0074584bb9c1709cbc1a9df5
	Fixed in 5.15.112 with commit 823787470e320f90372c3ef506769520026c571f
	Fixed in 6.1.29 with commit 2a179117a3b29e7136e4045c57090a05bb97f373
	Fixed in 6.2.16 with commit 71e1f44077db83e205db70a684c1f2c5d2247174
	Fixed in 6.3.3 with commit c5123c193696bf97fdf259c825ebfac517b54e44
	Fixed in 6.4 with commit 8b229ada2669b74fdae06c83fbfda5a5a99fc253

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53723
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/amd/amdgpu/sdma_v4_0.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/3decf3a750a924362bf4e2680dd3b07242fe56e8
	https://git.kernel.org/stable/c/c1420276be7a98df0074584bb9c1709cbc1a9df5
	https://git.kernel.org/stable/c/823787470e320f90372c3ef506769520026c571f
	https://git.kernel.org/stable/c/2a179117a3b29e7136e4045c57090a05bb97f373
	https://git.kernel.org/stable/c/71e1f44077db83e205db70a684c1f2c5d2247174
	https://git.kernel.org/stable/c/c5123c193696bf97fdf259c825ebfac517b54e44
	https://git.kernel.org/stable/c/8b229ada2669b74fdae06c83fbfda5a5a99fc253
