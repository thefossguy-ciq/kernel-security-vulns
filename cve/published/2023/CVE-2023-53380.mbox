From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53380: md/raid10: fix null-ptr-deref of mreplace in raid10_sync_request

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

md/raid10: fix null-ptr-deref of mreplace in raid10_sync_request

There are two check of 'mreplace' in raid10_sync_request(). In the first
check, 'need_replace' will be set and 'mreplace' will be used later if
no-Faulty 'mreplace' exists, In the second check, 'mreplace' will be
set to NULL if it is Faulty, but 'need_replace' will not be changed
accordingly. null-ptr-deref occurs if Faulty is set between two check.

Fix it by merging two checks into one. And replace 'need_replace' with
'mreplace' because their values are always the same.

The Linux kernel CVE team has assigned CVE-2023-53380 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.20 with commit ee37d7314a32ab6809eacc3389bad0406c69a81f and fixed in 5.4.251 with commit 45fa023b3334a7ae6f6c4eb977295804222dfa28
	Issue introduced in 4.20 with commit ee37d7314a32ab6809eacc3389bad0406c69a81f and fixed in 5.10.188 with commit 2990e2ece18dd4cca71b3109c80517ad94adb065
	Issue introduced in 4.20 with commit ee37d7314a32ab6809eacc3389bad0406c69a81f and fixed in 5.15.121 with commit f4368a462b1f9a8ecc2fdb09a28c3d4cad302a4f
	Issue introduced in 4.20 with commit ee37d7314a32ab6809eacc3389bad0406c69a81f and fixed in 6.1.39 with commit 222cc459d59857ee28a5366dc225ab42b22f9272
	Issue introduced in 4.20 with commit ee37d7314a32ab6809eacc3389bad0406c69a81f and fixed in 6.3.13 with commit b5015b97adda6a24dd3e713c63e521ecbeff25c6
	Issue introduced in 4.20 with commit ee37d7314a32ab6809eacc3389bad0406c69a81f and fixed in 6.4.4 with commit 144c7fd008e0072b0b565f1157eec618de54ca8a
	Issue introduced in 4.20 with commit ee37d7314a32ab6809eacc3389bad0406c69a81f and fixed in 6.5 with commit 34817a2441747b48e444cb0e05d84e14bc9443da

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53380
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/md/raid10.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/45fa023b3334a7ae6f6c4eb977295804222dfa28
	https://git.kernel.org/stable/c/2990e2ece18dd4cca71b3109c80517ad94adb065
	https://git.kernel.org/stable/c/f4368a462b1f9a8ecc2fdb09a28c3d4cad302a4f
	https://git.kernel.org/stable/c/222cc459d59857ee28a5366dc225ab42b22f9272
	https://git.kernel.org/stable/c/b5015b97adda6a24dd3e713c63e521ecbeff25c6
	https://git.kernel.org/stable/c/144c7fd008e0072b0b565f1157eec618de54ca8a
	https://git.kernel.org/stable/c/34817a2441747b48e444cb0e05d84e14bc9443da
