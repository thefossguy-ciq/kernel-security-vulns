From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54268: debugobjects: Don't wake up kswapd from fill_pool()
Message-Id: <2025123000-CVE-2023-54268-3ba2@gregkh>
Content-Length: 3096
Lines: 63
X-Developer-Signature: v=1; a=openpgp-sha256; l=3160;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=fjLHfCgS/FG8q7iIH+ELMJU+/r+C+MvP5Djp9x++GbQ=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJnBhwv6uHQ87vWy2HPpfuU16lvbz6Ja13Bh1r/YuK0qZ
 0IX+2zriGVhEGRikBVTZPmyjefo/opDil6Gtqdh5rAygQxh4OIUgInsvMUwTzHvwDIJSf4fLAL3
 ObOmVXyXya2WZVhwOPWD3eE1Zmt2XdwS0fX3kMpdd3YLAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

debugobjects: Don't wake up kswapd from fill_pool()

syzbot is reporting a lockdep warning in fill_pool() because the allocation
from debugobjects is using GFP_ATOMIC, which is (__GFP_HIGH | __GFP_KSWAPD_RECLAIM)
and therefore tries to wake up kswapd, which acquires kswapd_wait::lock.

Since fill_pool() might be called with arbitrary locks held, fill_pool()
should not assume that acquiring kswapd_wait::lock is safe.

Use __GFP_HIGH instead and remove __GFP_NORETRY as it is pointless for
!__GFP_DIRECT_RECLAIM allocation.

The Linux kernel CVE team has assigned CVE-2023-54268 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.26 with commit 3ac7fe5a4aab409bd5674d0b070bce97f9d20872 and fixed in 5.4.244 with commit be646802b3dc408c4dc72a3ac32c3f4a0282414d
	Issue introduced in 2.6.26 with commit 3ac7fe5a4aab409bd5674d0b070bce97f9d20872 and fixed in 5.10.181 with commit fd673079749bac97bb30f1461df079e6c8e86511
	Issue introduced in 2.6.26 with commit 3ac7fe5a4aab409bd5674d0b070bce97f9d20872 and fixed in 5.15.114 with commit aee97eec77029270866c704f66cdf2881cbd2fe1
	Issue introduced in 2.6.26 with commit 3ac7fe5a4aab409bd5674d0b070bce97f9d20872 and fixed in 6.1.31 with commit d7fff52c99d52f180d8bef95d8ed8fec6343889c
	Issue introduced in 2.6.26 with commit 3ac7fe5a4aab409bd5674d0b070bce97f9d20872 and fixed in 6.3.5 with commit 4c088d30a72d9b8f9c6ae9362222942e4075cb00
	Issue introduced in 2.6.26 with commit 3ac7fe5a4aab409bd5674d0b070bce97f9d20872 and fixed in 6.4 with commit eb799279fb1f9c63c520fe8c1c41cb9154252db6

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54268
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	lib/debugobjects.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/be646802b3dc408c4dc72a3ac32c3f4a0282414d
	https://git.kernel.org/stable/c/fd673079749bac97bb30f1461df079e6c8e86511
	https://git.kernel.org/stable/c/aee97eec77029270866c704f66cdf2881cbd2fe1
	https://git.kernel.org/stable/c/d7fff52c99d52f180d8bef95d8ed8fec6343889c
	https://git.kernel.org/stable/c/4c088d30a72d9b8f9c6ae9362222942e4075cb00
	https://git.kernel.org/stable/c/eb799279fb1f9c63c520fe8c1c41cb9154252db6
