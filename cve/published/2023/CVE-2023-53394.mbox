From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53394: net/mlx5e: xsk: Fix crash on regular rq reactivation
Message-Id: <2025091859-CVE-2023-53394-dd17@gregkh>
Content-Length: 2344
Lines: 58
X-Developer-Signature: v=1; a=openpgp-sha256; l=2403;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=foG8SZVXEjhPideogDXTgchbCa0vdr4H4/ugEcJqeFI=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBlnuNxfsHydfOrNgamXqib6Sq52jyn+ECcyTeSazc4DW
 rdj3X11OmJZGASZGGTFFFm+bOM5ur/ikKKXoe1pmDmsTCBDGLg4BWAi4lcZ5gplvuCMizCsdVc7
 5t9jtefDpzt3IxkWtHT9d/jPbS2110fk3rLdfY7JLTv6AA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net/mlx5e: xsk: Fix crash on regular rq reactivation

When the regular rq is reactivated after the XSK socket is closed
it could be reading stale cqes which eventually corrupts the rq.
This leads to no more traffic being received on the regular rq and a
crash on the next close or deactivation of the rq.

Kal Cuttler Conely reported this issue as a crash on the release
path when the xdpsock sample program is stopped (killed) and restarted
in sequence while traffic is running.

This patch flushes all cqes when during the rq flush. The cqe flushing
is done in the reset state of the rq. mlx5e_rq_to_ready code is moved
into the flush function to allow for this.

The Linux kernel CVE team has assigned CVE-2023-53394 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.1 with commit 082a9edf12fef88400172e7d1b131d65a3ed492e and fixed in 6.4.10 with commit 02a84eb2af6bea7871cd34264fb27f141f005fd9
	Issue introduced in 6.1 with commit 082a9edf12fef88400172e7d1b131d65a3ed492e and fixed in 6.5 with commit 39646d9bcd1a65d2396328026626859a1dab59d7

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53394
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/ethernet/mellanox/mlx5/core/en_main.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/02a84eb2af6bea7871cd34264fb27f141f005fd9
	https://git.kernel.org/stable/c/39646d9bcd1a65d2396328026626859a1dab59d7
