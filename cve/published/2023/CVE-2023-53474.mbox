From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53474: x86/MCE/AMD: Use an u64 for bank_map
Message-Id: <2025100110-CVE-2023-53474-b2ae@gregkh>
Content-Length: 3185
Lines: 69
X-Developer-Signature: v=1; a=openpgp-sha256; l=3255;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=J7XRkXaQ0kFkkWp4r24uKefsKwd0HGw0RoExKtZh/2Q=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBl3hSffC9XZ2vNY9MvxvnV1tfesWG6tLD810/pL+orF5
 qs1Eg787IhlYRBkYpAVU2T5so3n6P6KQ4pehranYeawMoEMYeDiFICJHPzKsGCXmul7WdM1cg/Y
 Dug+is/L/bVMxpdhwUwdS6VZtjsVv1744H9d4VfKrodr5gMA
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

x86/MCE/AMD: Use an u64 for bank_map

Thee maximum number of MCA banks is 64 (MAX_NR_BANKS), see

  a0bc32b3cacf ("x86/mce: Increase maximum number of banks to 64").

However, the bank_map which contains a bitfield of which banks to
initialize is of type unsigned int and that overflows when those bit
numbers are >= 32, leading to UBSAN complaining correctly:

  UBSAN: shift-out-of-bounds in arch/x86/kernel/cpu/mce/amd.c:1365:38
  shift exponent 32 is too large for 32-bit type 'int'

Change the bank_map to a u64 and use the proper BIT_ULL() macro when
modifying bits in there.

  [ bp: Rewrite commit message. ]

The Linux kernel CVE team has assigned CVE-2023-53474 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.10 with commit a0bc32b3cacf194dc479b342f006203fd1e1941a and fixed in 5.10.180 with commit a9b9ea0e63a0ec5e97bf1219ab6dcbd55e362f83
	Issue introduced in 5.10 with commit a0bc32b3cacf194dc479b342f006203fd1e1941a and fixed in 5.15.111 with commit 11c58a0c1937c157dbdf82d5ab634d68c99f3098
	Issue introduced in 5.10 with commit a0bc32b3cacf194dc479b342f006203fd1e1941a and fixed in 6.1.28 with commit ba8ffb1251eb629c2ec35220e3896cf4f7b888a7
	Issue introduced in 5.10 with commit a0bc32b3cacf194dc479b342f006203fd1e1941a and fixed in 6.2.15 with commit 9669fa17287c3af2bbd4868d4c8fdd9e57f8332e
	Issue introduced in 5.10 with commit a0bc32b3cacf194dc479b342f006203fd1e1941a and fixed in 6.3.2 with commit 67bb7521b6420d81dab7538c0686f18f7d6d09f4
	Issue introduced in 5.10 with commit a0bc32b3cacf194dc479b342f006203fd1e1941a and fixed in 6.4 with commit 4c1cdec319b9aadb65737c3eb1f5cb74bd6aa156

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53474
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	arch/x86/kernel/cpu/mce/amd.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/a9b9ea0e63a0ec5e97bf1219ab6dcbd55e362f83
	https://git.kernel.org/stable/c/11c58a0c1937c157dbdf82d5ab634d68c99f3098
	https://git.kernel.org/stable/c/ba8ffb1251eb629c2ec35220e3896cf4f7b888a7
	https://git.kernel.org/stable/c/9669fa17287c3af2bbd4868d4c8fdd9e57f8332e
	https://git.kernel.org/stable/c/67bb7521b6420d81dab7538c0686f18f7d6d09f4
	https://git.kernel.org/stable/c/4c1cdec319b9aadb65737c3eb1f5cb74bd6aa156
