From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54091: drm/client: Fix memory leak in drm_client_target_cloned
Message-Id: <2025122407-CVE-2023-54091-577a@gregkh>
Content-Length: 4174
Lines: 78
X-Developer-Signature: v=1; a=openpgp-sha256; l=4253;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=TsSJB7j1IhsDpfCpuUVkr7rRnORgHZfIvv2hbmFr+IY=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJneT+0vGgg+PpFxYbLL1F2bY6956x2ZojljVcZdjZuhB
 5pOqie6d8SyMAgyMciKKbJ82cZzdH/FIUUvQ9vTMHNYmUCGMHBxCsBEJk9kmMM5cY9semZeSV5U
 0lGRo0oGC3q3pDIs6JvanR/Qt1Bd7c/Sq6+33maR7LudBQA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/client: Fix memory leak in drm_client_target_cloned

dmt_mode is allocated and never freed in this function.
It was found with the ast driver, but most drivers using generic fbdev
setup are probably affected.

This fixes the following kmemleak report:
  backtrace:
    [<00000000b391296d>] drm_mode_duplicate+0x45/0x220 [drm]
    [<00000000e45bb5b3>] drm_client_target_cloned.constprop.0+0x27b/0x480 [drm]
    [<00000000ed2d3a37>] drm_client_modeset_probe+0x6bd/0xf50 [drm]
    [<0000000010e5cc9d>] __drm_fb_helper_initial_config_and_unlock+0xb4/0x2c0 [drm_kms_helper]
    [<00000000909f82ca>] drm_fbdev_client_hotplug+0x2bc/0x4d0 [drm_kms_helper]
    [<00000000063a69aa>] drm_client_register+0x169/0x240 [drm]
    [<00000000a8c61525>] ast_pci_probe+0x142/0x190 [ast]
    [<00000000987f19bb>] local_pci_probe+0xdc/0x180
    [<000000004fca231b>] work_for_cpu_fn+0x4e/0xa0
    [<0000000000b85301>] process_one_work+0x8b7/0x1540
    [<000000003375b17c>] worker_thread+0x70a/0xed0
    [<00000000b0d43cd9>] kthread+0x29f/0x340
    [<000000008d770833>] ret_from_fork+0x1f/0x30
unreferenced object 0xff11000333089a00 (size 128):

The Linux kernel CVE team has assigned CVE-2023-54091 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.35 with commit 1d42bbc8f7f9ce4d852692ef7aa336b133b0830a and fixed in 4.14.322 with commit d3009700f48602b557eade1f22c98b6bc20247e8
	Issue introduced in 2.6.35 with commit 1d42bbc8f7f9ce4d852692ef7aa336b133b0830a and fixed in 4.19.291 with commit a4b978249e8fa94956fce8b70a709f7797716f62
	Issue introduced in 2.6.35 with commit 1d42bbc8f7f9ce4d852692ef7aa336b133b0830a and fixed in 5.4.251 with commit 52daf6ba2e0d201640cb1ce42049c5c4426b4d6e
	Issue introduced in 2.6.35 with commit 1d42bbc8f7f9ce4d852692ef7aa336b133b0830a and fixed in 5.10.188 with commit 105275879a80503686a8108af2f5c579a1c5aef4
	Issue introduced in 2.6.35 with commit 1d42bbc8f7f9ce4d852692ef7aa336b133b0830a and fixed in 5.15.123 with commit a85e23a1ef63e45a18f0a30d7816fcb4a865ca95
	Issue introduced in 2.6.35 with commit 1d42bbc8f7f9ce4d852692ef7aa336b133b0830a and fixed in 6.1.42 with commit b5359d7a5087ac398fc429da6833133b4784c268
	Issue introduced in 2.6.35 with commit 1d42bbc8f7f9ce4d852692ef7aa336b133b0830a and fixed in 6.4.7 with commit 4b596a6e2d2e0f9c14e4122506dd715f43fcd727
	Issue introduced in 2.6.35 with commit 1d42bbc8f7f9ce4d852692ef7aa336b133b0830a and fixed in 6.5 with commit c2a88e8bdf5f6239948d75283d0ae7e0c7945b03

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54091
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/drm_client_modeset.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d3009700f48602b557eade1f22c98b6bc20247e8
	https://git.kernel.org/stable/c/a4b978249e8fa94956fce8b70a709f7797716f62
	https://git.kernel.org/stable/c/52daf6ba2e0d201640cb1ce42049c5c4426b4d6e
	https://git.kernel.org/stable/c/105275879a80503686a8108af2f5c579a1c5aef4
	https://git.kernel.org/stable/c/a85e23a1ef63e45a18f0a30d7816fcb4a865ca95
	https://git.kernel.org/stable/c/b5359d7a5087ac398fc429da6833133b4784c268
	https://git.kernel.org/stable/c/4b596a6e2d2e0f9c14e4122506dd715f43fcd727
	https://git.kernel.org/stable/c/c2a88e8bdf5f6239948d75283d0ae7e0c7945b03
