From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54183: media: v4l2-core: Fix a potential resource leak in v4l2_fwnode_parse_link()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

media: v4l2-core: Fix a potential resource leak in v4l2_fwnode_parse_link()

If fwnode_graph_get_remote_endpoint() fails, 'fwnode' is known to be NULL,
so fwnode_handle_put() is a no-op.

Release the reference taken from a previous fwnode_graph_get_port_parent()
call instead.

Also handle fwnode_graph_get_port_parent() failures.

In order to fix these issues, add an error handling path to the function
and the needed gotos.

The Linux kernel CVE team has assigned CVE-2023-54183 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.13 with commit ca50c197bd9610ea984cfc0dc6855f183cbb46f8 and fixed in 4.19.295 with commit 2342942331e1f034ff58f293e10d0d9b7581601f
	Issue introduced in 4.13 with commit ca50c197bd9610ea984cfc0dc6855f183cbb46f8 and fixed in 5.4.257 with commit 4bc5ffaf8ac4f3e7a1fcd10a0a0e7b022b694877
	Issue introduced in 4.13 with commit ca50c197bd9610ea984cfc0dc6855f183cbb46f8 and fixed in 5.10.195 with commit d8a8f75fce049bdb3144b607deefe51e996b9660
	Issue introduced in 4.13 with commit ca50c197bd9610ea984cfc0dc6855f183cbb46f8 and fixed in 5.15.132 with commit caf058833b6f3fe7beabf738110f79bb987c8fff
	Issue introduced in 4.13 with commit ca50c197bd9610ea984cfc0dc6855f183cbb46f8 and fixed in 6.1.53 with commit 25afb3e03bf8ab02567af4b6ffbfd6250a91a9f8
	Issue introduced in 4.13 with commit ca50c197bd9610ea984cfc0dc6855f183cbb46f8 and fixed in 6.4.16 with commit ed1696f7f92e8404940d51dec80a123aa18163a8
	Issue introduced in 4.13 with commit ca50c197bd9610ea984cfc0dc6855f183cbb46f8 and fixed in 6.5.3 with commit e8a1cd87bb9fa3149ee112ecb8058908dc9b520e
	Issue introduced in 4.13 with commit ca50c197bd9610ea984cfc0dc6855f183cbb46f8 and fixed in 6.6 with commit d7b13edd4cb4bfa335b6008ab867ac28582d3e5c

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54183
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/media/v4l2-core/v4l2-fwnode.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/2342942331e1f034ff58f293e10d0d9b7581601f
	https://git.kernel.org/stable/c/4bc5ffaf8ac4f3e7a1fcd10a0a0e7b022b694877
	https://git.kernel.org/stable/c/d8a8f75fce049bdb3144b607deefe51e996b9660
	https://git.kernel.org/stable/c/caf058833b6f3fe7beabf738110f79bb987c8fff
	https://git.kernel.org/stable/c/25afb3e03bf8ab02567af4b6ffbfd6250a91a9f8
	https://git.kernel.org/stable/c/ed1696f7f92e8404940d51dec80a123aa18163a8
	https://git.kernel.org/stable/c/e8a1cd87bb9fa3149ee112ecb8058908dc9b520e
	https://git.kernel.org/stable/c/d7b13edd4cb4bfa335b6008ab867ac28582d3e5c
