From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54199: drm/msm/adreno: Fix null ptr access in adreno_gpu_cleanup()
Message-Id: <2025123030-CVE-2023-54199-595d@gregkh>
Content-Length: 4577
Lines: 98
X-Developer-Signature: v=1; a=openpgp-sha256; l=4676;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=7VJyW6DtxtNK9y5BOzRA9EYUCB8uxztFs1lbRs4bcL4=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJnBB36ZBTZseOGWNMWmiLN5HtfHz98k7XaEOK51jzto9
 dU1xORxRywLgyATg6yYIsuXbTxH91ccUvQytD0NM4eVCWQIAxenAEzkYCXDHF5/bpu5Al+ZOHdH
 1BX4p6sIpx6sZ5hn1HLZK+HUnffK3kujt5jMePng/NpeAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/msm/adreno: Fix null ptr access in adreno_gpu_cleanup()

Fix the below kernel panic due to null pointer access:
[   18.504431] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000048
[   18.513464] Mem abort info:
[   18.516346]   ESR = 0x0000000096000005
[   18.520204]   EC = 0x25: DABT (current EL), IL = 32 bits
[   18.525706]   SET = 0, FnV = 0
[   18.528878]   EA = 0, S1PTW = 0
[   18.532117]   FSC = 0x05: level 1 translation fault
[   18.537138] Data abort info:
[   18.540110]   ISV = 0, ISS = 0x00000005
[   18.544060]   CM = 0, WnR = 0
[   18.547109] user pgtable: 4k pages, 39-bit VAs, pgdp=0000000112826000
[   18.553738] [0000000000000048] pgd=0000000000000000, p4d=0000000000000000, pud=0000000000000000
[   18.562690] Internal error: Oops: 0000000096000005 [#1] PREEMPT SMP
**Snip**
[   18.696758] Call trace:
[   18.699278]  adreno_gpu_cleanup+0x30/0x88
[   18.703396]  a6xx_destroy+0xc0/0x130
[   18.707066]  a6xx_gpu_init+0x308/0x424
[   18.710921]  adreno_bind+0x178/0x288
[   18.714590]  component_bind_all+0xe0/0x214
[   18.718797]  msm_drm_bind+0x1d4/0x614
[   18.722566]  try_to_bring_up_aggregate_device+0x16c/0x1b8
[   18.728105]  __component_add+0xa0/0x158
[   18.732048]  component_add+0x20/0x2c
[   18.735719]  adreno_probe+0x40/0xc0
[   18.739300]  platform_probe+0xb4/0xd4
[   18.743068]  really_probe+0xfc/0x284
[   18.746738]  __driver_probe_device+0xc0/0xec
[   18.751129]  driver_probe_device+0x48/0x110
[   18.755421]  __device_attach_driver+0xa8/0xd0
[   18.759900]  bus_for_each_drv+0x90/0xdc
[   18.763843]  __device_attach+0xfc/0x174
[   18.767786]  device_initial_probe+0x20/0x2c
[   18.772090]  bus_probe_device+0x40/0xa0
[   18.776032]  deferred_probe_work_func+0x94/0xd0
[   18.780686]  process_one_work+0x190/0x3d0
[   18.784805]  worker_thread+0x280/0x3d4
[   18.788659]  kthread+0x104/0x1c0
[   18.791981]  ret_from_fork+0x10/0x20
[   18.795654] Code: f9400408 aa0003f3 aa1f03f4 91142015 (f9402516)
[   18.801913] ---[ end trace 0000000000000000 ]---
[   18.809039] Kernel panic - not syncing: Oops: Fatal exception

Patchwork: https://patchwork.freedesktop.org/patch/515605/

The Linux kernel CVE team has assigned CVE-2023-54199 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.9 with commit 17e822f7591fb66162aca07685dc0b01468e5480 and fixed in 5.10.173 with commit b26bd7791f3cdf3c3318162b1d40c9d1910facca
	Issue introduced in 5.9 with commit 17e822f7591fb66162aca07685dc0b01468e5480 and fixed in 5.15.99 with commit 399d01375659c273fb6ad9ccfb6e92bc5b891e0d
	Issue introduced in 5.9 with commit 17e822f7591fb66162aca07685dc0b01468e5480 and fixed in 6.1.16 with commit 7af606b9eb11d6cdf767cabbddc326e20d0d4702
	Issue introduced in 5.9 with commit 17e822f7591fb66162aca07685dc0b01468e5480 and fixed in 6.2.3 with commit 5fef23c1c0edceb44d16e64e7818f27d48b5bc38
	Issue introduced in 5.9 with commit 17e822f7591fb66162aca07685dc0b01468e5480 and fixed in 6.3 with commit dbeedbcb268d055d8895aceca427f897e12c2b50

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54199
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/msm/adreno/adreno_gpu.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/65a8b6d129cfcf63a2b8a36a63d275479ba6a217
	https://git.kernel.org/stable/c/b26bd7791f3cdf3c3318162b1d40c9d1910facca
	https://git.kernel.org/stable/c/399d01375659c273fb6ad9ccfb6e92bc5b891e0d
	https://git.kernel.org/stable/c/7af606b9eb11d6cdf767cabbddc326e20d0d4702
	https://git.kernel.org/stable/c/5fef23c1c0edceb44d16e64e7818f27d48b5bc38
	https://git.kernel.org/stable/c/dbeedbcb268d055d8895aceca427f897e12c2b50
