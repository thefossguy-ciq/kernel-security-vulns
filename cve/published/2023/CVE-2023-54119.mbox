From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54119: inotify: Avoid reporting event with invalid wd
Message-Id: <2025122416-CVE-2023-54119-fbd4@gregkh>
Content-Length: 3230
Lines: 62
X-Developer-Signature: v=1; a=openpgp-sha256; l=3293;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=wHYSBby126Md9PePGmSla5ydrt3ERMa+h6lRgtcew04=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJneTz2+lmo+3dU4657iooAN2jsOhTne8irzrqh5nPG5u
 yrg333hjlgWBkEmBlkxRZYv23iO7q84pOhlaHsaZg4rE8gQBi5OAZhIsgPDPMWfB+d4H2G7ddDZ
 PD8i2iRYo+dZLMP84oiZ26JmmZvc/7PnidmcGRkL7+0/DwA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

inotify: Avoid reporting event with invalid wd

When inotify_freeing_mark() races with inotify_handle_inode_event() it
can happen that inotify_handle_inode_event() sees that i_mark->wd got
already reset to -1 and reports this value to userspace which can
confuse the inotify listener. Avoid the problem by validating that wd is
sensible (and pretend the mark got removed before the event got
generated otherwise).

The Linux kernel CVE team has assigned CVE-2023-54119 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.31 with commit 7e790dd5fc937bc8d2400c30a05e32a9e9eef276 and fixed in 5.4.243 with commit 8fb33166aed888769ea63d6af49515893f8a1f14
	Issue introduced in 2.6.31 with commit 7e790dd5fc937bc8d2400c30a05e32a9e9eef276 and fixed in 5.10.180 with commit 2d65c97777e5b4a845637800d5d7b648f5772106
	Issue introduced in 2.6.31 with commit 7e790dd5fc937bc8d2400c30a05e32a9e9eef276 and fixed in 5.15.112 with commit 17ad86d8c12220de97e80d88b5b4c934a40e1812
	Issue introduced in 2.6.31 with commit 7e790dd5fc937bc8d2400c30a05e32a9e9eef276 and fixed in 6.1.29 with commit 145f54ea336b06cf4f92eeee996f2ffca939ea43
	Issue introduced in 2.6.31 with commit 7e790dd5fc937bc8d2400c30a05e32a9e9eef276 and fixed in 6.2.16 with commit fb3294998489d39835006240e9c6e6b2ac62022e
	Issue introduced in 2.6.31 with commit 7e790dd5fc937bc8d2400c30a05e32a9e9eef276 and fixed in 6.3.3 with commit a48bacee05860c6089c3482bcdc80720b0ee5732
	Issue introduced in 2.6.31 with commit 7e790dd5fc937bc8d2400c30a05e32a9e9eef276 and fixed in 6.4 with commit c915d8f5918bea7c3962b09b8884ca128bfd9b0c

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54119
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/notify/inotify/inotify_fsnotify.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/8fb33166aed888769ea63d6af49515893f8a1f14
	https://git.kernel.org/stable/c/2d65c97777e5b4a845637800d5d7b648f5772106
	https://git.kernel.org/stable/c/17ad86d8c12220de97e80d88b5b4c934a40e1812
	https://git.kernel.org/stable/c/145f54ea336b06cf4f92eeee996f2ffca939ea43
	https://git.kernel.org/stable/c/fb3294998489d39835006240e9c6e6b2ac62022e
	https://git.kernel.org/stable/c/a48bacee05860c6089c3482bcdc80720b0ee5732
	https://git.kernel.org/stable/c/c915d8f5918bea7c3962b09b8884ca128bfd9b0c
