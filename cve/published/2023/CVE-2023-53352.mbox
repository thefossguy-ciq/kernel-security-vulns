From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53352: drm/ttm: check null pointer before accessing when swapping
Message-Id: <2025091720-CVE-2023-53352-9be5@gregkh>
Content-Length: 3788
Lines: 83
X-Developer-Signature: v=1; a=openpgp-sha256; l=3872;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=8LlQ27lxbxWdrpxSIVMcaw/2GKeTD514Bi99cJrvIBA=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBmnzohICGRwKHQ9tZtUr7kkPPXNnu8LBPZVdTKaxvRfO
 hC6fcvGjlgWBkEmBlkxRZYv23iO7q84pOhlaHsaZg4rE8gQBi5OAZiIWBjDgnNnglQ3CniteV3k
 NUVnxoeDKufTwhnmmU6NvLz25ysFzp3B91Ys2Lxa4ihTEAA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/ttm: check null pointer before accessing when swapping

Add a check to avoid null pointer dereference as below:

[   90.002283] general protection fault, probably for non-canonical
address 0xdffffc0000000000: 0000 [#1] PREEMPT SMP KASAN NOPTI
[   90.002292] KASAN: null-ptr-deref in range
[0x0000000000000000-0x0000000000000007]
[   90.002346]  ? exc_general_protection+0x159/0x240
[   90.002352]  ? asm_exc_general_protection+0x26/0x30
[   90.002357]  ? ttm_bo_evict_swapout_allowable+0x322/0x5e0 [ttm]
[   90.002365]  ? ttm_bo_evict_swapout_allowable+0x42e/0x5e0 [ttm]
[   90.002373]  ttm_bo_swapout+0x134/0x7f0 [ttm]
[   90.002383]  ? __pfx_ttm_bo_swapout+0x10/0x10 [ttm]
[   90.002391]  ? lock_acquire+0x44d/0x4f0
[   90.002398]  ? ttm_device_swapout+0xa5/0x260 [ttm]
[   90.002412]  ? lock_acquired+0x355/0xa00
[   90.002416]  ? do_raw_spin_trylock+0xb6/0x190
[   90.002421]  ? __pfx_lock_acquired+0x10/0x10
[   90.002426]  ? ttm_global_swapout+0x25/0x210 [ttm]
[   90.002442]  ttm_device_swapout+0x198/0x260 [ttm]
[   90.002456]  ? __pfx_ttm_device_swapout+0x10/0x10 [ttm]
[   90.002472]  ttm_global_swapout+0x75/0x210 [ttm]
[   90.002486]  ttm_tt_populate+0x187/0x3f0 [ttm]
[   90.002501]  ttm_bo_handle_move_mem+0x437/0x590 [ttm]
[   90.002517]  ttm_bo_validate+0x275/0x430 [ttm]
[   90.002530]  ? __pfx_ttm_bo_validate+0x10/0x10 [ttm]
[   90.002544]  ? kasan_save_stack+0x33/0x60
[   90.002550]  ? kasan_set_track+0x25/0x30
[   90.002554]  ? __kasan_kmalloc+0x8f/0xa0
[   90.002558]  ? amdgpu_gtt_mgr_new+0x81/0x420 [amdgpu]
[   90.003023]  ? ttm_resource_alloc+0xf6/0x220 [ttm]
[   90.003038]  amdgpu_bo_pin_restricted+0x2dd/0x8b0 [amdgpu]
[   90.003210]  ? __x64_sys_ioctl+0x131/0x1a0
[   90.003210]  ? do_syscall_64+0x60/0x90

The Linux kernel CVE team has assigned CVE-2023-53352 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.15.124 with commit da60170558b956c1b45dee1c4423da2425037426 and fixed in 5.15.126 with commit 8089eb93d6787dbf348863e935698b4610d90321
	Issue introduced in 6.1.43 with commit 17e188e0feb008bab5f4b083083dff7cdc633ca1 and fixed in 6.1.45 with commit 1fdd16d89c01336d9a942b5f03673c17d401da87
	Issue introduced in 6.4.8 with commit c24d051e6b48015e32f1361cdf67e1784dd14a9f and fixed in 6.4.10 with commit 49b3b979e79faef129605018ad82aa0f2258f2f7

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53352
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/ttm/ttm_bo.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d39971d902d067b4dc366981b75b17c8c57ed5d1
	https://git.kernel.org/stable/c/8089eb93d6787dbf348863e935698b4610d90321
	https://git.kernel.org/stable/c/1fdd16d89c01336d9a942b5f03673c17d401da87
	https://git.kernel.org/stable/c/49b3b979e79faef129605018ad82aa0f2258f2f7
	https://git.kernel.org/stable/c/2dedcf414bb01b8d966eb445db1d181d92304fb2
