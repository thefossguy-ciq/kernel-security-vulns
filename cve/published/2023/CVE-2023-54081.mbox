From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54081: xen: speed up grant-table reclaim

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

xen: speed up grant-table reclaim

When a grant entry is still in use by the remote domain, Linux must put
it on a deferred list.  Normally, this list is very short, because
the PV network and block protocols expect the backend to unmap the grant
first.  However, Qubes OS's GUI protocol is subject to the constraints
of the X Window System, and as such winds up with the frontend unmapping
the window first.  As a result, the list can grow very large, resulting
in a massive memory leak and eventual VM freeze.

To partially solve this problem, make the number of entries that the VM
will attempt to free at each iteration tunable.  The default is still
10, but it can be overridden via a module parameter.

This is Cc: stable because (when combined with appropriate userspace
changes) it fixes a severe performance and stability problem for Qubes
OS users.

The Linux kernel CVE team has assigned CVE-2023-54081 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.5 with commit 569ca5b3f94cd0b3295ec5943aa457cf4a4f6a3a and fixed in 6.1.43 with commit cd1a8952ff529adc210e62306849fd6f256608c0
	Issue introduced in 3.5 with commit 569ca5b3f94cd0b3295ec5943aa457cf4a4f6a3a and fixed in 6.4.8 with commit c76d96c555895ac602c1587b001e5cf656abc371
	Issue introduced in 3.5 with commit 569ca5b3f94cd0b3295ec5943aa457cf4a4f6a3a and fixed in 6.5 with commit c04e9894846c663f3278a414f34416e6e45bbe68

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54081
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	Documentation/ABI/testing/sysfs-module
	drivers/xen/grant-table.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/cd1a8952ff529adc210e62306849fd6f256608c0
	https://git.kernel.org/stable/c/c76d96c555895ac602c1587b001e5cf656abc371
	https://git.kernel.org/stable/c/c04e9894846c663f3278a414f34416e6e45bbe68
