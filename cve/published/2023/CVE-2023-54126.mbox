From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54126: crypto: safexcel - Cleanup ring IRQ workqueues on load failure
Message-Id: <2025122418-CVE-2023-54126-7e20@gregkh>
Content-Length: 5228
Lines: 108
X-Developer-Signature: v=1; a=openpgp-sha256; l=5337;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=gOMnswQz1GODqCmYL7W696YOail4yy0LlAZC1XZJErs=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJneT70u62lEBnh+2Bhc+WtyTq2Ca5tp5IuWOyq5R3N+/
 k3eMd26I5aFQZCJQVZMkeXLNp6j+ysOKXoZ2p6GmcPKBDKEgYtTACbydj/DXMFJN1VV+c7PSkvt
 ltG76n/C3OfaGoYFu7RuriwQWcJZJ7fgSNGu291r1Te9BgA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

crypto: safexcel - Cleanup ring IRQ workqueues on load failure

A failure loading the safexcel driver results in the following warning
on boot, because the IRQ affinity has not been correctly cleaned up.
Ensure we clean up the affinity and workqueues on a failure to load the
driver.

crypto-safexcel: probe of f2800000.crypto failed with error -2
------------[ cut here ]------------
WARNING: CPU: 1 PID: 232 at kernel/irq/manage.c:1913 free_irq+0x300/0x340
Modules linked in: hwmon mdio_i2c crypto_safexcel(+) md5 sha256_generic libsha256 authenc libdes omap_rng rng_core nft_masq nft_nat nft_chain_nat nf_nat nft_ct nf_conntrack nf_defrag_ipv6 nf_defrag_ipv4 nf_tables libcrc32c nfnetlink fuse autofs4
CPU: 1 PID: 232 Comm: systemd-udevd Tainted: G        W          6.1.6-00002-g9d4898824677 #3
Hardware name: MikroTik RB5009 (DT)
pstate: 600000c5 (nZCv daIF -PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : free_irq+0x300/0x340
lr : free_irq+0x2e0/0x340
sp : ffff800008fa3890
x29: ffff800008fa3890 x28: 0000000000000000 x27: 0000000000000000
x26: ffff8000008e6dc0 x25: ffff000009034cac x24: ffff000009034d50
x23: 0000000000000000 x22: 000000000000004a x21: ffff0000093e0d80
x20: ffff000009034c00 x19: ffff00000615fc00 x18: 0000000000000000
x17: 0000000000000000 x16: 0000000000000000 x15: 000075f5c1584c5e
x14: 0000000000000017 x13: 0000000000000000 x12: 0000000000000040
x11: ffff000000579b60 x10: ffff000000579b62 x9 : ffff800008bbe370
x8 : ffff000000579dd0 x7 : 0000000000000000 x6 : ffff000000579e18
x5 : ffff000000579da8 x4 : ffff800008ca0000 x3 : ffff800008ca0188
x2 : 0000000013033204 x1 : ffff000009034c00 x0 : ffff8000087eadf0
Call trace:
 free_irq+0x300/0x340
 devm_irq_release+0x14/0x20
 devres_release_all+0xa0/0x100
 device_unbind_cleanup+0x14/0x60
 really_probe+0x198/0x2d4
 __driver_probe_device+0x74/0xdc
 driver_probe_device+0x3c/0x110
 __driver_attach+0x8c/0x190
 bus_for_each_dev+0x6c/0xc0
 driver_attach+0x20/0x30
 bus_add_driver+0x148/0x1fc
 driver_register+0x74/0x120
 __platform_driver_register+0x24/0x30
 safexcel_init+0x48/0x1000 [crypto_safexcel]
 do_one_initcall+0x4c/0x1b0
 do_init_module+0x44/0x1cc
 load_module+0x1724/0x1be4
 __do_sys_finit_module+0xbc/0x110
 __arm64_sys_finit_module+0x1c/0x24
 invoke_syscall+0x44/0x110
 el0_svc_common.constprop.0+0xc0/0xe0
 do_el0_svc+0x20/0x80
 el0_svc+0x14/0x4c
 el0t_64_sync_handler+0xb0/0xb4
 el0t_64_sync+0x148/0x14c
---[ end trace 0000000000000000 ]---

The Linux kernel CVE team has assigned CVE-2023-54126 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.13 with commit 1b44c5a60c137e5fd0c2c8b86e58fdbc9cd181ce and fixed in 5.4.243 with commit 4f4de392f4926820ec1fd3573a016c704a68893d
	Issue introduced in 4.13 with commit 1b44c5a60c137e5fd0c2c8b86e58fdbc9cd181ce and fixed in 5.10.180 with commit 0a89d4a075524cf1f865cfdbb9cf38ab8e3e5409
	Issue introduced in 4.13 with commit 1b44c5a60c137e5fd0c2c8b86e58fdbc9cd181ce and fixed in 5.15.111 with commit 09e177d6f7edd0873a63f51abe914902ec0f4400
	Issue introduced in 4.13 with commit 1b44c5a60c137e5fd0c2c8b86e58fdbc9cd181ce and fixed in 6.1.28 with commit 4d9d2fd86766ee3ec077c011aa482e85b6c9595c
	Issue introduced in 4.13 with commit 1b44c5a60c137e5fd0c2c8b86e58fdbc9cd181ce and fixed in 6.2.15 with commit 162f9daf0c22480f88b24fd46d16abae46c10fce
	Issue introduced in 4.13 with commit 1b44c5a60c137e5fd0c2c8b86e58fdbc9cd181ce and fixed in 6.3.2 with commit ab573af2655ba509e2a167897de9b5585c2ca44d
	Issue introduced in 4.13 with commit 1b44c5a60c137e5fd0c2c8b86e58fdbc9cd181ce and fixed in 6.4 with commit ca25c00ccbc5f942c63897ed23584cfc66e8ec81

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54126
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/crypto/inside-secure/safexcel.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/4f4de392f4926820ec1fd3573a016c704a68893d
	https://git.kernel.org/stable/c/0a89d4a075524cf1f865cfdbb9cf38ab8e3e5409
	https://git.kernel.org/stable/c/09e177d6f7edd0873a63f51abe914902ec0f4400
	https://git.kernel.org/stable/c/4d9d2fd86766ee3ec077c011aa482e85b6c9595c
	https://git.kernel.org/stable/c/162f9daf0c22480f88b24fd46d16abae46c10fce
	https://git.kernel.org/stable/c/ab573af2655ba509e2a167897de9b5585c2ca44d
	https://git.kernel.org/stable/c/ca25c00ccbc5f942c63897ed23584cfc66e8ec81
