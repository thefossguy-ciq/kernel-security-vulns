From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54237: net/smc: fix potential panic dues to unprotected smc_llc_srv_add_link()
Message-Id: <2025123032-CVE-2023-54237-c03d@gregkh>
Content-Length: 3409
Lines: 74
X-Developer-Signature: v=1; a=openpgp-sha256; l=3484;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=laMc0Ft7sAqOSvc+xLaZsV9LT4Z2E6GSW0HugW22hSY=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJnBB9/0rqxOyWQ5GJpz1YRvQeA3V5u1ymodfp+bty6ZW
 KxyeMLjjlgWBkEmBlkxRZYv23iO7q84pOhlaHsaZg4rE8gQBi5OAbhIJsOCzlc8HdN3zjjVcoRn
 wVU9u00T5p/7xbCgWah/tvLX31wbH7Q4/bl+e3VX9u99AA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net/smc: fix potential panic dues to unprotected smc_llc_srv_add_link()

There is a certain chance to trigger the following panic:

PID: 5900   TASK: ffff88c1c8af4100  CPU: 1   COMMAND: "kworker/1:48"
 #0 [ffff9456c1cc79a0] machine_kexec at ffffffff870665b7
 #1 [ffff9456c1cc79f0] __crash_kexec at ffffffff871b4c7a
 #2 [ffff9456c1cc7ab0] crash_kexec at ffffffff871b5b60
 #3 [ffff9456c1cc7ac0] oops_end at ffffffff87026ce7
 #4 [ffff9456c1cc7ae0] page_fault_oops at ffffffff87075715
 #5 [ffff9456c1cc7b58] exc_page_fault at ffffffff87ad0654
 #6 [ffff9456c1cc7b80] asm_exc_page_fault at ffffffff87c00b62
    [exception RIP: ib_alloc_mr+19]
    RIP: ffffffffc0c9cce3  RSP: ffff9456c1cc7c38  RFLAGS: 00010202
    RAX: 0000000000000000  RBX: 0000000000000002  RCX: 0000000000000004
    RDX: 0000000000000010  RSI: 0000000000000000  RDI: 0000000000000000
    RBP: ffff88c1ea281d00   R8: 000000020a34ffff   R9: ffff88c1350bbb20
    R10: 0000000000000000  R11: 0000000000000001  R12: 0000000000000000
    R13: 0000000000000010  R14: ffff88c1ab040a50  R15: ffff88c1ea281d00
    ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018
 #7 [ffff9456c1cc7c60] smc_ib_get_memory_region at ffffffffc0aff6df [smc]
 #8 [ffff9456c1cc7c88] smcr_buf_map_link at ffffffffc0b0278c [smc]
 #9 [ffff9456c1cc7ce0] __smc_buf_create at ffffffffc0b03586 [smc]

The reason here is that when the server tries to create a second link,
smc_llc_srv_add_link() has no protection and may add a new link to
link group. This breaks the security environment protected by
llc_conf_mutex.

The Linux kernel CVE team has assigned CVE-2023-54237 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.8 with commit 2d2209f2018943d4152a21eff5b76f1952e0b435 and fixed in 6.1.16 with commit f2f46de98c11d41ac8d22765f47ba54ce5480a5b
	Issue introduced in 5.8 with commit 2d2209f2018943d4152a21eff5b76f1952e0b435 and fixed in 6.2.3 with commit 0c764cc271d3aa6528ae1b3394babf34ac01f775
	Issue introduced in 5.8 with commit 2d2209f2018943d4152a21eff5b76f1952e0b435 and fixed in 6.3 with commit e40b801b3603a8f90b46acbacdea3505c27f01c0

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54237
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/smc/af_smc.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/f2f46de98c11d41ac8d22765f47ba54ce5480a5b
	https://git.kernel.org/stable/c/0c764cc271d3aa6528ae1b3394babf34ac01f775
	https://git.kernel.org/stable/c/e40b801b3603a8f90b46acbacdea3505c27f01c0
