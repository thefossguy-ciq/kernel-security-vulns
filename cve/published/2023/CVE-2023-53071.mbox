From bippy-1.1.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53071: wifi: mt76: do not run mt76_unregister_device() on unregistered hw

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

wifi: mt76: do not run mt76_unregister_device() on unregistered hw

Trying to probe a mt7921e pci card without firmware results in a
successful probe where ieee80211_register_hw hasn't been called. When
removing the driver, ieee802111_unregister_hw is called unconditionally
leading to a kernel NULL pointer dereference.
Fix the issue running mt76_unregister_device routine just for registered
hw.

The Linux kernel CVE team has assigned CVE-2023-53071 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.18 with commit 1c71e03afe4b457a15e50de40006b927dfc00755 and fixed in 6.1.113 with commit dffe86df26aee01a5fc56a175b7a7f157961e370
	Issue introduced in 5.18 with commit 1c71e03afe4b457a15e50de40006b927dfc00755 and fixed in 6.2.9 with commit 2d34f27714c97a9786a30b3bb54944d6d8ed612f
	Issue introduced in 5.18 with commit 1c71e03afe4b457a15e50de40006b927dfc00755 and fixed in 6.3 with commit 41130c32f3a18fcc930316da17f3a5f3bc326aa1

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53071
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/wireless/mediatek/mt76/mac80211.c
	drivers/net/wireless/mediatek/mt76/mt76.h


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/dffe86df26aee01a5fc56a175b7a7f157961e370
	https://git.kernel.org/stable/c/2d34f27714c97a9786a30b3bb54944d6d8ed612f
	https://git.kernel.org/stable/c/41130c32f3a18fcc930316da17f3a5f3bc326aa1
