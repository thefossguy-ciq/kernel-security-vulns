From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53357: md/raid10: check slab-out-of-bounds in md_bitmap_get_counter

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

md/raid10: check slab-out-of-bounds in md_bitmap_get_counter

If we write a large number to md/bitmap_set_bits, md_bitmap_checkpage()
will return -EINVAL because 'page >= bitmap->pages', but the return value
was not checked immediately in md_bitmap_get_counter() in order to set
*blocks value and slab-out-of-bounds occurs.

Move check of 'page >= bitmap->pages' to md_bitmap_get_counter() and
return directly if true.

The Linux kernel CVE team has assigned CVE-2023-53357 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.36 with commit ef4256733506f2459a0c436b62267d22a3f0cec6 and fixed in 4.19.291 with commit 374fb914304d9b500721007f3837ea8f1f9a2418
	Issue introduced in 2.6.36 with commit ef4256733506f2459a0c436b62267d22a3f0cec6 and fixed in 5.4.251 with commit b0b971fe7d61411ede63c3291764dbde1577ef2c
	Issue introduced in 2.6.36 with commit ef4256733506f2459a0c436b62267d22a3f0cec6 and fixed in 5.10.188 with commit 39fa14e824acfd470db4f42c354297456bd82b53
	Issue introduced in 2.6.36 with commit ef4256733506f2459a0c436b62267d22a3f0cec6 and fixed in 5.15.121 with commit a134dd582c0d5b6068efa308bd485cf1d00b3f65
	Issue introduced in 2.6.36 with commit ef4256733506f2459a0c436b62267d22a3f0cec6 and fixed in 6.1.39 with commit be1a3ec63a840cc9e59a033acf154f56255699a1
	Issue introduced in 2.6.36 with commit ef4256733506f2459a0c436b62267d22a3f0cec6 and fixed in 6.3.13 with commit 152bb26796ff054af50b2ee1b3ca56e364e4f61b
	Issue introduced in 2.6.36 with commit ef4256733506f2459a0c436b62267d22a3f0cec6 and fixed in 6.4.4 with commit bea301c046110bf421a3ce153fb868cb8d618e90
	Issue introduced in 2.6.36 with commit ef4256733506f2459a0c436b62267d22a3f0cec6 and fixed in 6.5 with commit 301867b1c16805aebbc306aafa6ecdc68b73c7e5

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53357
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/md/md-bitmap.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/374fb914304d9b500721007f3837ea8f1f9a2418
	https://git.kernel.org/stable/c/b0b971fe7d61411ede63c3291764dbde1577ef2c
	https://git.kernel.org/stable/c/39fa14e824acfd470db4f42c354297456bd82b53
	https://git.kernel.org/stable/c/a134dd582c0d5b6068efa308bd485cf1d00b3f65
	https://git.kernel.org/stable/c/be1a3ec63a840cc9e59a033acf154f56255699a1
	https://git.kernel.org/stable/c/152bb26796ff054af50b2ee1b3ca56e364e4f61b
	https://git.kernel.org/stable/c/bea301c046110bf421a3ce153fb868cb8d618e90
	https://git.kernel.org/stable/c/301867b1c16805aebbc306aafa6ecdc68b73c7e5
