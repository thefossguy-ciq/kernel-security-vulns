From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53261: coresight: Fix memory leak in acpi_buffer->pointer
Message-Id: <2025091504-CVE-2023-53261-6a1a@gregkh>
Content-Length: 2758
Lines: 67
X-Developer-Signature: v=1; a=openpgp-sha256; l=2826;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=rt+gPy/SA9oLKHzPS9d1ZbF6mblSzqjyOWXZW99SNlc=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBkn1NborTE6/7qopfu30mbHP9+e58z8LxK6W98tNlik7
 P7umlvHOmJZGASZGGTFFFm+bOM5ur/ikKKXoe1pmDmsTCBDGLg4BWAibk4M8+OssnlT09/eX6vP
 9qFYp24DS6atBMP8rJksJQscClUE1j//Jatw8Upt0+GNAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

coresight: Fix memory leak in acpi_buffer->pointer

There are memory leaks reported by kmemleak:
...
unreferenced object 0xffff00213c141000 (size 1024):
  comm "systemd-udevd", pid 2123, jiffies 4294909467 (age 6062.160s)
  hex dump (first 32 bytes):
    04 00 00 00 02 00 00 00 18 10 14 3c 21 00 ff ff  ...........<!...
    00 00 00 00 00 00 00 00 03 00 00 00 10 00 00 00  ................
  backtrace:
    [<000000004b7c9001>] __kmem_cache_alloc_node+0x2f8/0x348
    [<00000000b0fc7ceb>] __kmalloc+0x58/0x108
    [<0000000064ff4695>] acpi_os_allocate+0x2c/0x68
    [<000000007d57d116>] acpi_ut_initialize_buffer+0x54/0xe0
    [<0000000024583908>] acpi_evaluate_object+0x388/0x438
    [<0000000017b2e72b>] acpi_evaluate_object_typed+0xe8/0x240
    [<000000005df0eac2>] coresight_get_platform_data+0x1b4/0x988 [coresight]
...

The ACPI buffer memory (buf.pointer) should be freed. But the buffer
is also used after returning from acpi_get_dsd_graph().
Move the temporary variables buf to acpi_coresight_parse_graph(),
and free it before the function return to prevent memory leak.

The Linux kernel CVE team has assigned CVE-2023-53261 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.3 with commit 76ffa5ab5b79c250b9744b7f8bdd835db426a1ae and fixed in 6.5.3 with commit d1b60e7c9fee34eaedf1fc4e0471f75b33f83a4a
	Issue introduced in 5.3 with commit 76ffa5ab5b79c250b9744b7f8bdd835db426a1ae and fixed in 6.6 with commit 1a9e02673e2550f5612099e64e8761f0c8fc0f50

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53261
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/hwtracing/coresight/coresight-platform.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d1b60e7c9fee34eaedf1fc4e0471f75b33f83a4a
	https://git.kernel.org/stable/c/1a9e02673e2550f5612099e64e8761f0c8fc0f50
