From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53276: ubifs: Free memory for tmpfile name

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ubifs: Free memory for tmpfile name

When opening a ubifs tmpfile on an encrypted directory, function
fscrypt_setup_filename allocates memory for the name that is to be
stored in the directory entry, but after the name has been copied to the
directory entry inode, the memory is not freed.

When running kmemleak on it we see that it is registered as a leak. The
report below is triggered by a simple program 'tmpfile' just opening a
tmpfile:

  unreferenced object 0xffff88810178f380 (size 32):
    comm "tmpfile", pid 509, jiffies 4294934744 (age 1524.742s)
    backtrace:
      __kmem_cache_alloc_node
      __kmalloc
      fscrypt_setup_filename
      ubifs_tmpfile
      vfs_tmpfile
      path_openat

Free this memory after it has been copied to the inode.

The Linux kernel CVE team has assigned CVE-2023-53276 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.10 with commit f4f61d2cc6d8789a52245a4733b3e5643be154f3 and fixed in 4.14.315 with commit 8ad8c67a897e68426e85990ebfe0a7d1f71fc79f
	Issue introduced in 4.10 with commit f4f61d2cc6d8789a52245a4733b3e5643be154f3 and fixed in 4.19.283 with commit 107d481642c356a5668058066360fc473911e628
	Issue introduced in 4.10 with commit f4f61d2cc6d8789a52245a4733b3e5643be154f3 and fixed in 5.4.243 with commit 823f554747f8aafaa965fb2f3ae794110ed429ef
	Issue introduced in 4.10 with commit f4f61d2cc6d8789a52245a4733b3e5643be154f3 and fixed in 5.10.180 with commit b8f444a4fadfb5070ed7e298e0a5ceb4a18014f3
	Issue introduced in 4.10 with commit f4f61d2cc6d8789a52245a4733b3e5643be154f3 and fixed in 5.15.111 with commit ce840284929b75dbbf062e0ce7fcb78a63b08b5e
	Issue introduced in 4.10 with commit f4f61d2cc6d8789a52245a4733b3e5643be154f3 and fixed in 6.1.28 with commit 29738e1bcc799dd754711d4e4aab967f0c018175
	Issue introduced in 4.10 with commit f4f61d2cc6d8789a52245a4733b3e5643be154f3 and fixed in 6.2.15 with commit fd197308c0e4f738c7ea687d5332035c5753881c
	Issue introduced in 4.10 with commit f4f61d2cc6d8789a52245a4733b3e5643be154f3 and fixed in 6.3.2 with commit 1e43d4284bdc3bd34bd770fea13910ac37ab0618
	Issue introduced in 4.10 with commit f4f61d2cc6d8789a52245a4733b3e5643be154f3 and fixed in 6.4 with commit 1fb815b38bb31d6af9bd0540b8652a0d6fe6cfd3

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53276
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/ubifs/dir.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/8ad8c67a897e68426e85990ebfe0a7d1f71fc79f
	https://git.kernel.org/stable/c/107d481642c356a5668058066360fc473911e628
	https://git.kernel.org/stable/c/823f554747f8aafaa965fb2f3ae794110ed429ef
	https://git.kernel.org/stable/c/b8f444a4fadfb5070ed7e298e0a5ceb4a18014f3
	https://git.kernel.org/stable/c/ce840284929b75dbbf062e0ce7fcb78a63b08b5e
	https://git.kernel.org/stable/c/29738e1bcc799dd754711d4e4aab967f0c018175
	https://git.kernel.org/stable/c/fd197308c0e4f738c7ea687d5332035c5753881c
	https://git.kernel.org/stable/c/1e43d4284bdc3bd34bd770fea13910ac37ab0618
	https://git.kernel.org/stable/c/1fb815b38bb31d6af9bd0540b8652a0d6fe6cfd3
