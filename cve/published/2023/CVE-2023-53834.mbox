From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53834: iio: adc: ina2xx: avoid NULL pointer dereference on OF device match

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

iio: adc: ina2xx: avoid NULL pointer dereference on OF device match

The affected lines were resulting in a NULL pointer dereference on our
platform because the device tree contained the following list of
compatible strings:

    power-sensor@40 {
        compatible = "ti,ina232", "ti,ina231";
        ...
    };

Since the driver doesn't declare a compatible string "ti,ina232", the OF
matching succeeds on "ti,ina231". But the I2C device ID info is
populated via the first compatible string, cf. modalias population in
of_i2c_get_board_info(). Since there is no "ina232" entry in the legacy
I2C device ID table either, the struct i2c_device_id *id pointer in the
probe function is NULL.

Fix this by using the already populated type variable instead, which
points to the proper driver data. Since the name is also wanted, add a
generic one to the ina2xx_config table.

The Linux kernel CVE team has assigned CVE-2023-53834 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.5 with commit c43a102e67db99c8bfe6e8a9280cec13ff53b789 and fixed in 5.15.127 with commit a8e2ae6296d56478fb98ae7f739846ed121f154f
	Issue introduced in 4.5 with commit c43a102e67db99c8bfe6e8a9280cec13ff53b789 and fixed in 6.1.46 with commit 77b689cc27d489b75d33f1a368356d70eb0ce08c
	Issue introduced in 4.5 with commit c43a102e67db99c8bfe6e8a9280cec13ff53b789 and fixed in 6.4.11 with commit 13f3ce53b65aa8b44cad7039d31e62c9ffd6c5d1
	Issue introduced in 4.5 with commit c43a102e67db99c8bfe6e8a9280cec13ff53b789 and fixed in 6.5 with commit a41e19cc0d6b6a445a4133170b90271e4a2553dc

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53834
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/iio/adc/ina2xx-adc.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/a8e2ae6296d56478fb98ae7f739846ed121f154f
	https://git.kernel.org/stable/c/77b689cc27d489b75d33f1a368356d70eb0ce08c
	https://git.kernel.org/stable/c/13f3ce53b65aa8b44cad7039d31e62c9ffd6c5d1
	https://git.kernel.org/stable/c/a41e19cc0d6b6a445a4133170b90271e4a2553dc
