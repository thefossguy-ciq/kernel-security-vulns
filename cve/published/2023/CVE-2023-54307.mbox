From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-54307: ptp_qoriq: fix memory leak in probe()
Message-Id: <2025123034-CVE-2023-54307-1ddf@gregkh>
Content-Length: 2961
Lines: 63
X-Developer-Signature: v=1; a=openpgp-sha256; l=3025;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=OqMOSSi3QgluURwpKy6r5C6END1GCkw1+OMGmvi2558=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJnBR9x2Fzubr5RhaKr4e/BtdmjMG4OzAfbfHtm+9Re7u
 fsvZ39wRywLgyATg6yYIsuXbTxH91ccUvQytD0NM4eVCWQIAxenAExk+3aG2eynuLhv/Gf0/C2b
 sWlJ54PNQWynjjLMFf7o3/Sk6GL4wbkyn7IOC64s2ayfCAA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ptp_qoriq: fix memory leak in probe()

Smatch complains that:
drivers/ptp/ptp_qoriq.c ptp_qoriq_probe()
warn: 'base' from ioremap() not released.

Fix this by revising the parameter from 'ptp_qoriq->base' to 'base'.
This is only a bug if ptp_qoriq_init() returns on the
first -ENODEV error path.
For other error paths ptp_qoriq->base and base are the same.
And this change makes the code more readable.

The Linux kernel CVE team has assigned CVE-2023-54307 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.2 with commit 7f4399ba405b6201fb318b43091703a34b1489ab and fixed in 5.4.240 with commit 46c4993a1514eea3bbc7147d0c81c23cc06c6bed
	Issue introduced in 5.2 with commit 7f4399ba405b6201fb318b43091703a34b1489ab and fixed in 5.10.177 with commit 3907fcb5a439933cf8c10d6dc300bc11eba30de3
	Issue introduced in 5.2 with commit 7f4399ba405b6201fb318b43091703a34b1489ab and fixed in 5.15.106 with commit c0de1a26e6595b0e7969c5b35990a77a2d93104f
	Issue introduced in 5.2 with commit 7f4399ba405b6201fb318b43091703a34b1489ab and fixed in 6.1.23 with commit 43b4331ce0cd88ccba425e0702ba35c1a52daccf
	Issue introduced in 5.2 with commit 7f4399ba405b6201fb318b43091703a34b1489ab and fixed in 6.2.10 with commit c960785c8168d0e572101ed921b9be3934ed0bc9
	Issue introduced in 5.2 with commit 7f4399ba405b6201fb318b43091703a34b1489ab and fixed in 6.3 with commit f33642224e38d7e0d59336e10e7b4e370b1c4506

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-54307
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/ptp/ptp_qoriq.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/46c4993a1514eea3bbc7147d0c81c23cc06c6bed
	https://git.kernel.org/stable/c/3907fcb5a439933cf8c10d6dc300bc11eba30de3
	https://git.kernel.org/stable/c/c0de1a26e6595b0e7969c5b35990a77a2d93104f
	https://git.kernel.org/stable/c/43b4331ce0cd88ccba425e0702ba35c1a52daccf
	https://git.kernel.org/stable/c/c960785c8168d0e572101ed921b9be3934ed0bc9
	https://git.kernel.org/stable/c/f33642224e38d7e0d59336e10e7b4e370b1c4506
