{
   "containers": {
      "cna": {
         "providerMetadata": {
            "orgId": "f4215fc3-5b6b-47ff-a258-f7189bd81038"
         },
         "descriptions": [
            {
               "lang": "en",
               "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nKVM: nSVM: Check instead of asserting on nested TSC scaling support\n\nCheck for nested TSC scaling support on nested SVM VMRUN instead of\nasserting that TSC scaling is exposed to L1 if L1's MSR_AMD64_TSC_RATIO\nhas diverged from KVM's default.  Userspace can trigger the WARN at will\nby writing the MSR and then updating guest CPUID to hide the feature\n(modifying guest CPUID is allowed anytime before KVM_RUN).  E.g. hacking\nKVM's state_test selftest to do\n\n\t\tvcpu_set_msr(vcpu, MSR_AMD64_TSC_RATIO, 0);\n\t\tvcpu_clear_cpuid_feature(vcpu, X86_FEATURE_TSCRATEMSR);\n\nafter restoring state in a new VM+vCPU yields an endless supply of:\n\n  ------------[ cut here ]------------\n  WARNING: CPU: 164 PID: 62565 at arch/x86/kvm/svm/nested.c:699\n           nested_vmcb02_prepare_control+0x3d6/0x3f0 [kvm_amd]\n  Call Trace:\n   <TASK>\n   enter_svm_guest_mode+0x114/0x560 [kvm_amd]\n   nested_svm_vmrun+0x260/0x330 [kvm_amd]\n   vmrun_interception+0x29/0x30 [kvm_amd]\n   svm_invoke_exit_handler+0x35/0x100 [kvm_amd]\n   svm_handle_exit+0xe7/0x180 [kvm_amd]\n   kvm_arch_vcpu_ioctl_run+0x1eab/0x2570 [kvm]\n   kvm_vcpu_ioctl+0x4c9/0x5b0 [kvm]\n   __se_sys_ioctl+0x7a/0xc0\n   __x64_sys_ioctl+0x21/0x30\n   do_syscall_64+0x41/0x90\n   entry_SYSCALL_64_after_hwframe+0x63/0xcd\n  RIP: 0033:0x45ca1b\n\nNote, the nested #VMEXIT path has the same flaw, but needs a different\nfix and will be handled separately."
            }
         ],
         "affected": [
            {
               "product": "Linux",
               "vendor": "Linux",
               "defaultStatus": "unaffected",
               "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
               "programFiles": [
                  "arch/x86/kvm/svm/nested.c"
               ],
               "versions": [
                  {
                     "version": "5228eb96a4875f8cf5d61d486e3795ac14df8904",
                     "lessThan": "6c1ecfea1daf6e75c46e295aad99dfbafd878897",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "5228eb96a4875f8cf5d61d486e3795ac14df8904",
                     "lessThan": "02b24270568f65dd607c4a848512dc8055b4491b",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "5228eb96a4875f8cf5d61d486e3795ac14df8904",
                     "lessThan": "7cafe9b8e22bb3d77f130c461aedf6868c4aaf58",
                     "status": "affected",
                     "versionType": "git"
                  }
               ]
            },
            {
               "product": "Linux",
               "vendor": "Linux",
               "defaultStatus": "affected",
               "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
               "programFiles": [
                  "arch/x86/kvm/svm/nested.c"
               ],
               "versions": [
                  {
                     "version": "5.16",
                     "status": "affected"
                  },
                  {
                     "version": "0",
                     "lessThan": "5.16",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "6.1.54",
                     "lessThanOrEqual": "6.1.*",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "6.5.4",
                     "lessThanOrEqual": "6.5.*",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "6.6",
                     "lessThanOrEqual": "*",
                     "status": "unaffected",
                     "versionType": "original_commit_for_fix"
                  }
               ]
            }
         ],
         "cpeApplicability": [
            {
               "nodes": [
                  {
                     "operator": "OR",
                     "negate": false,
                     "cpeMatch": [
                        {
                           "vulnerable": true,
                           "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                           "versionStartIncluding": "5.16",
                           "versionEndExcluding": "6.1.54"
                        },
                        {
                           "vulnerable": true,
                           "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                           "versionStartIncluding": "5.16",
                           "versionEndExcluding": "6.5.4"
                        },
                        {
                           "vulnerable": true,
                           "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                           "versionStartIncluding": "5.16",
                           "versionEndExcluding": "6.6"
                        }
                     ]
                  }
               ]
            }
         ],
         "references": [
            {
               "url": "https://git.kernel.org/stable/c/6c1ecfea1daf6e75c46e295aad99dfbafd878897"
            },
            {
               "url": "https://git.kernel.org/stable/c/02b24270568f65dd607c4a848512dc8055b4491b"
            },
            {
               "url": "https://git.kernel.org/stable/c/7cafe9b8e22bb3d77f130c461aedf6868c4aaf58"
            }
         ],
         "title": "KVM: nSVM: Check instead of asserting on nested TSC scaling support",
         "x_generator": {
            "engine": "bippy-1.2.0"
         }
      }
   },
   "cveMetadata": {
      "assignerOrgId": "f4215fc3-5b6b-47ff-a258-f7189bd81038",
      "cveID": "CVE-2023-53663",
      "requesterUserId": "gregkh@kernel.org",
      "serial": "1",
      "state": "PUBLISHED"
   },
   "dataType": "CVE_RECORD",
   "dataVersion": "5.0"
}
