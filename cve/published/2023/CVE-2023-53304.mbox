From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53304: netfilter: nft_set_rbtree: fix overlap expiration walk
Message-Id: <2025091641-CVE-2023-53304-9a57@gregkh>
Content-Length: 3078
Lines: 66
X-Developer-Signature: v=1; a=openpgp-sha256; l=3145;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=M44V5KFy9LlLJbJdXZPHo9zW65hyQyZ3rPLdqjz4eWE=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBkne2zlz2styYtxvsNiKpG/06KfL0ymSsnYSeDbJlWnz
 THeSbc7YlkYBJkYZMUUWb5s4zm6v+KQopeh7WmYOaxMIEMYuDgFYCILPjIs2F6kH8szubS5SbRm
 95Xfy3d6Sx+9xDCH18nXsrlQ94yup//BHwvKZuRZy3ABAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

netfilter: nft_set_rbtree: fix overlap expiration walk

The lazy gc on insert that should remove timed-out entries fails to release
the other half of the interval, if any.

Can be reproduced with tests/shell/testcases/sets/0044interval_overlap_0
in nftables.git and kmemleak enabled kernel.

Second bug is the use of rbe_prev vs. prev pointer.
If rbe_prev() returns NULL after at least one iteration, rbe_prev points
to element that is not an end interval, hence it should not be removed.

Lastly, check the genmask of the end interval if this is active in the
current generation.

The Linux kernel CVE team has assigned CVE-2023-53304 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.10.166 with commit 4aacf3d78424293e318c616016865380b37b9cc5 and fixed in 5.10.190 with commit 893cb3c3513cf661a0ff45fe0cfa83fe27131f76
	Issue introduced in 5.15.91 with commit 2bf1435fa19d2c58054391b3bba40d5510a5758c and fixed in 5.15.124 with commit 50cbb9d195c197af671869c8cadce3bd483735a0
	Issue introduced in 6.1.9 with commit 318cb24a4c3fce8140afaf84e4d45fcb76fb280b and fixed in 6.1.43 with commit 89a4d1a89751a0fbd520e64091873e19cc0979e8
	Issue introduced in 6.2 with commit c9e6978e2725a7d4b6cd23b2facd3f11422c0643 and fixed in 6.4.8 with commit cd66733932399475fe933cb3ec03e687ed401462
	Issue introduced in 6.2 with commit c9e6978e2725a7d4b6cd23b2facd3f11422c0643 and fixed in 6.5 with commit f718863aca469a109895cb855e6b81fff4827d71

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53304
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/netfilter/nft_set_rbtree.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/8284a79136c384059e85e278da2210b809730287
	https://git.kernel.org/stable/c/acaee227cf79c45a5d2d49c3e9a66333a462802c
	https://git.kernel.org/stable/c/893cb3c3513cf661a0ff45fe0cfa83fe27131f76
	https://git.kernel.org/stable/c/50cbb9d195c197af671869c8cadce3bd483735a0
	https://git.kernel.org/stable/c/89a4d1a89751a0fbd520e64091873e19cc0979e8
	https://git.kernel.org/stable/c/cd66733932399475fe933cb3ec03e687ed401462
	https://git.kernel.org/stable/c/f718863aca469a109895cb855e6b81fff4827d71
