From bippy-4986f5686161 Mon Sep 17 00:00:00 2001
From: Lee Jones <lee@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-52493: bus: mhi: host: Drop chan lock before queuing buffers
X-Developer-Signature: v=1; a=openpgp-sha256; l=2747; i=lee@kernel.org;
 h=from:subject; bh=6UJH1uGg34usRQ5LYXA5a+sARxaN7verWEIGTz09xvY=;
 b=owEBbQKS/ZANAwAKAVGvii+H/HdhAcsmYgBl4KhOBF7G37oXhjktVHPWD6wDuayrQKSVEiSfR
 haLL3W7hAKJAjMEAAEKAB0WIQR2tsk1o74gmpTwh0hRr4ovh/x3YQUCZeCoTgAKCRBRr4ovh/x3
 YaLUD/41+NuuBtst3szwrmT/NHUf9qpbyv2s7AJ4alziXC9OF3XMHLSzoK0M+q8P7Zxnbp+KU+/
 AQqWn/A2/by+swq3581U1Po4kImLS7JGiWdralfboa9Hut0c0UC7640KCJN9V8jxOwvpADwvNAg
 dzn4MdBqIJVlLV6A8jWgAv8P/9PcK8KSMy1zBEMhCqACy2jzd3BmkPgjbl6pheqyGPi9JMRfT5X
 iaBDftUDGBzwJ7Jm3COtfOd9bKlqQrqjArKd6MwpL+YSA5I7kmJpn5fZ0TeS+ml3V2P02Mobgz7
 J3lCYB38/h5ymBXu5INAoLqdgIOIRFlnbteYkyh+KUkhsx4AEkP/b005Ww+9/A26ZXX26R7vs0J
 sp4wE7JThNpjkC/yxCoDea+cAErVitZI4GIxPajom2AfeKioVqHjJRQ1fD912PA1oHPLwxMNomP
 Ff7ol13P14/+/SUh8Mg4nn0nLk8drwRgDWIBKFTt7NgMj3MU2DcH86y8ItN5Gre4KmBnsxaVH9E
 NoHa2OM3AHT8g6T3AEtXNTOoBnzrCDk13YMAEBQHlVk8KexRfVOpdeLyRJyPxrPUif/uFaMvVuf
 SqqzgNDtfbtgkug4Hoykk5SxN+2fzVZtMU1DEbupsKKjK/tBLhMrOKhHKC1YUoALmoMnoPj7u0E
 MUGDfceYu8HuT0g==
X-Developer-Key: i=lee@kernel.org; a=openpgp;
 fpr=76B6C935A3BE209A94F0874851AF8A2F87FC7761

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

bus: mhi: host: Drop chan lock before queuing buffers

Ensure read and write locks for the channel are not taken in succession by
dropping the read lock from parse_xfer_event() such that a callback given
to client can potentially queue buffers and acquire the write lock in that
process. Any queueing of buffers should be done without channel read lock
acquired as it can result in multiple locks and a soft lockup.

[mani: added fixes tag and cc'ed stable]

The Linux kernel CVE team has assigned CVE-2023-52493 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.7 with commit 1d3173a3bae7 and fixed in 5.10.210 with commit 20a6dea2d1c6
	Issue introduced in 5.7 with commit 1d3173a3bae7 and fixed in 5.15.149 with commit 6e4c84316e2b
	Issue introduced in 5.7 with commit 1d3173a3bae7 and fixed in 6.1.76 with commit 3c5ec66b4b3f
	Issue introduced in 5.7 with commit 1d3173a3bae7 and fixed in 6.6.15 with commit eaefb9464031
	Issue introduced in 5.7 with commit 1d3173a3bae7 and fixed in 6.7.3 with commit b8eff20d8709
	Issue introduced in 5.7 with commit 1d3173a3bae7 and fixed in 6.8-rc1 with commit 01bd694ac2f6

Please see https://www.kernel.org or a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-52493
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/bus/mhi/host/main.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/20a6dea2d1c68d4e03c6bb50bc12e72e226b5c0e
	https://git.kernel.org/stable/c/6e4c84316e2b70709f0d00c33ba3358d9fc8eece
	https://git.kernel.org/stable/c/3c5ec66b4b3f6816f3a6161538672e389e537690
	https://git.kernel.org/stable/c/eaefb9464031215d63c0a8a7e2bfaa00736aa17e
	https://git.kernel.org/stable/c/b8eff20d87092e14cac976d057cb0aea2f1d0830
	https://git.kernel.org/stable/c/01bd694ac2f682fb8017e16148b928482bc8fa4b
