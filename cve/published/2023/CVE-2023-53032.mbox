From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53032: netfilter: ipset: Fix overflow before widen in the bitmap_ip_create() function.

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

netfilter: ipset: Fix overflow before widen in the bitmap_ip_create() function.

When first_ip is 0, last_ip is 0xFFFFFFFF, and netmask is 31, the value of
an arithmetic expression 2 << (netmask - mask_bits - 1) is subject
to overflow due to a failure casting operands to a larger data type
before performing the arithmetic.

Note that it's harmless since the value will be checked at the next step.

Found by InfoTeCS on behalf of Linux Verification Center
(linuxtesting.org) with SVACE.

The Linux kernel CVE team has assigned CVE-2023-53032 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.7 with commit b9fed748185a96b7cfe74afac4bd228e8af16f01 and fixed in 4.14.303 with commit e137d9bb26bd85ce07323a38e38ceb0b160db841
	Issue introduced in 3.7 with commit b9fed748185a96b7cfe74afac4bd228e8af16f01 and fixed in 4.19.270 with commit dfd834ccc1b88bbbab81b9046a3a539dd0c2d14f
	Issue introduced in 3.7 with commit b9fed748185a96b7cfe74afac4bd228e8af16f01 and fixed in 5.4.229 with commit feefb33eefa166fc3e0fd17547b0bc0cb3baced9
	Issue introduced in 3.7 with commit b9fed748185a96b7cfe74afac4bd228e8af16f01 and fixed in 5.10.164 with commit 4e6a70fd840400e3a2e784a6673968a3eb2431c0
	Issue introduced in 3.7 with commit b9fed748185a96b7cfe74afac4bd228e8af16f01 and fixed in 5.15.89 with commit 511cf17b2447fc41cfef8d71936e1fa53e395c1e
	Issue introduced in 3.7 with commit b9fed748185a96b7cfe74afac4bd228e8af16f01 and fixed in 6.1.7 with commit e88865876d47c790be0d5e23973499d75d034364
	Issue introduced in 3.7 with commit b9fed748185a96b7cfe74afac4bd228e8af16f01 and fixed in 6.2 with commit 9ea4b476cea1b7d461d16dda25ca3c7e616e2d15

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53032
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/netfilter/ipset/ip_set_bitmap_ip.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/e137d9bb26bd85ce07323a38e38ceb0b160db841
	https://git.kernel.org/stable/c/dfd834ccc1b88bbbab81b9046a3a539dd0c2d14f
	https://git.kernel.org/stable/c/feefb33eefa166fc3e0fd17547b0bc0cb3baced9
	https://git.kernel.org/stable/c/4e6a70fd840400e3a2e784a6673968a3eb2431c0
	https://git.kernel.org/stable/c/511cf17b2447fc41cfef8d71936e1fa53e395c1e
	https://git.kernel.org/stable/c/e88865876d47c790be0d5e23973499d75d034364
	https://git.kernel.org/stable/c/9ea4b476cea1b7d461d16dda25ca3c7e616e2d15
