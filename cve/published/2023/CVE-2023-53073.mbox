From bippy-1.1.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-53073: perf/x86/amd/core: Always clear status for idx

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

perf/x86/amd/core: Always clear status for idx

The variable 'status' (which contains the unhandled overflow bits) is
not being properly masked in some cases, displaying the following
warning:

  WARNING: CPU: 156 PID: 475601 at arch/x86/events/amd/core.c:972 amd_pmu_v2_handle_irq+0x216/0x270

This seems to be happening because the loop is being continued before
the status bit being unset, in case x86_perf_event_set_period()
returns 0. This is also causing an inconsistency because the "handled"
counter is incremented, but the status bit is not cleaned.

Move the bit cleaning together above, together when the "handled"
counter is incremented.

The Linux kernel CVE team has assigned CVE-2023-53073 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.19 with commit 7685665c390dc68c2d9a74e8445f41494cc8f6cf and fixed in 6.1.22 with commit ab33a8f7649b0324639a336e1081aaea51a4523e
	Issue introduced in 5.19 with commit 7685665c390dc68c2d9a74e8445f41494cc8f6cf and fixed in 6.2.9 with commit 9d4c7b1f12e101d6d6253092588b127416ddfb6c
	Issue introduced in 5.19 with commit 7685665c390dc68c2d9a74e8445f41494cc8f6cf and fixed in 6.3 with commit 263f5ecaf7080513efc248ec739b6d9e00f4129f

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-53073
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	arch/x86/events/amd/core.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/ab33a8f7649b0324639a336e1081aaea51a4523e
	https://git.kernel.org/stable/c/9d4c7b1f12e101d6d6253092588b127416ddfb6c
	https://git.kernel.org/stable/c/263f5ecaf7080513efc248ec739b6d9e00f4129f
