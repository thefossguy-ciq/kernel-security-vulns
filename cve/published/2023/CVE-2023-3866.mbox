From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-3866: ksmbd: validate session id and tree id in the compound request

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ksmbd: validate session id and tree id in the compound request

This patch validate session id and tree id in compound request.
If first operation in the compound is SMB2 ECHO request, ksmbd bypass
session and tree validation. So work->sess and work->tcon could be NULL.
If secound request in the compound access work->sess or tcon, It cause
NULL pointer dereferecing error.

The Linux kernel CVE team has assigned CVE-2023-3866 to this issue.


Affected and fixed versions
===========================

	Fixed in 5.15.121 with commit eb947403518ea3d93f6d89264bb1f5416bb0c7d0
	Fixed in 6.1.36 with commit 854156d12caa9d36de1cf5f084591c7686cc8a9d
	Fixed in 6.3.10 with commit d1066c1b3663401cd23c0d6e60cdae750ce00c0f
	Fixed in 6.4 with commit 5005bcb4219156f1bf7587b185080ec1da08518e

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-3866
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/smb/server/server.c
	fs/smb/server/smb2pdu.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/eb947403518ea3d93f6d89264bb1f5416bb0c7d0
	https://git.kernel.org/stable/c/854156d12caa9d36de1cf5f084591c7686cc8a9d
	https://git.kernel.org/stable/c/d1066c1b3663401cd23c0d6e60cdae750ce00c0f
	https://git.kernel.org/stable/c/5005bcb4219156f1bf7587b185080ec1da08518e
