From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2026-23138: tracing: Add recursion protection in kernel stack trace recording
Message-Id: <2026021429-CVE-2026-23138-9853@gregkh>
Content-Length: 2419
Lines: 61
X-Developer-Signature: v=1; a=openpgp-sha256; l=2481;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=YErbM083utbyHsx5lWxLo7HzaqyxA3nIT8TWrcjRdXE=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJkTJpsm7ClcFdJTqfLt4B+97eKTuNXP2ypMTerYYfMyV
 0JWSXdjRywLgyATg6yYIsuXbTxH91ccUvQytD0NM4eVCWQIAxenAEykfAfDgr1Lmz/rvjouubBn
 rub+w1bvvwbqzGWYK7TqorxbiPTltYV6t1eoPdkhdZdNAwA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

tracing: Add recursion protection in kernel stack trace recording

A bug was reported about an infinite recursion caused by tracing the rcu
events with the kernel stack trace trigger enabled. The stack trace code
called back into RCU which then called the stack trace again.

Expand the ftrace recursion protection to add a set of bits to protect
events from recursion. Each bit represents the context that the event is
in (normal, softirq, interrupt and NMI).

Have the stack trace code use the interrupt context to protect against
recursion.

Note, the bug showed an issue in both the RCU code as well as the tracing
stacktrace code. This only handles the tracing stack trace side of the
bug. The RCU fix will be handled separately.

The Linux kernel CVE team has assigned CVE-2026-23138 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.8 with commit 5f5fa7ea89dc82d34ed458f4d7a8634e8e9eefce and fixed in 6.18.6 with commit 5b7f91acffd2c4c000971553d22efa1e1bb4feae
	Issue introduced in 5.8 with commit 5f5fa7ea89dc82d34ed458f4d7a8634e8e9eefce and fixed in 6.19 with commit 5f1ef0dfcb5b7f4a91a9b0e0ba533efd9f7e2cdb

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2026-23138
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	include/linux/trace_recursion.h
	kernel/trace/trace.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/5b7f91acffd2c4c000971553d22efa1e1bb4feae
	https://git.kernel.org/stable/c/5f1ef0dfcb5b7f4a91a9b0e0ba533efd9f7e2cdb
