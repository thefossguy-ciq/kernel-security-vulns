From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2026-23124: ipv6: annotate data-race in ndisc_router_discovery()
Message-Id: <2026021409-CVE-2026-23124-2074@gregkh>
Content-Length: 4227
Lines: 94
X-Developer-Signature: v=1; a=openpgp-sha256; l=4322;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=MVV1lNIOaJ9BcoHPvRlP0YCipWc0EnXA9ds5rjPN18s=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJkTJgQm77P4dILb3OP7wptyuvNmPzu0Q493F4vB3MQvP
 76rlqokdcSyMAgyMciKKbJ82cZzdH/FIUUvQ9vTMHNYmUCGMHBxCsBEdkszzHfNviFVXprySP7c
 no6yqwLHKu6w1DDMZvu92cfGh/XdwstfTudZvTxyfYnUcwA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ipv6: annotate data-race in ndisc_router_discovery()

syzbot found that ndisc_router_discovery() could read and write
in6_dev->ra_mtu without holding a lock [1]

This looks fine, IFLA_INET6_RA_MTU is best effort.

Add READ_ONCE()/WRITE_ONCE() to document the race.

Note that we might also reject illegal MTU values
(mtu < IPV6_MIN_MTU || mtu > skb->dev->mtu) in a future patch.

[1]
BUG: KCSAN: data-race in ndisc_router_discovery / ndisc_router_discovery

read to 0xffff888119809c20 of 4 bytes by task 25817 on cpu 1:
  ndisc_router_discovery+0x151d/0x1c90 net/ipv6/ndisc.c:1558
  ndisc_rcv+0x2ad/0x3d0 net/ipv6/ndisc.c:1841
  icmpv6_rcv+0xe5a/0x12f0 net/ipv6/icmp.c:989
  ip6_protocol_deliver_rcu+0xb2a/0x10d0 net/ipv6/ip6_input.c:438
  ip6_input_finish+0xf0/0x1d0 net/ipv6/ip6_input.c:489
  NF_HOOK include/linux/netfilter.h:318 [inline]
  ip6_input+0x5e/0x140 net/ipv6/ip6_input.c:500
  ip6_mc_input+0x27c/0x470 net/ipv6/ip6_input.c:590
  dst_input include/net/dst.h:474 [inline]
  ip6_rcv_finish+0x336/0x340 net/ipv6/ip6_input.c:79
...

write to 0xffff888119809c20 of 4 bytes by task 25816 on cpu 0:
  ndisc_router_discovery+0x155a/0x1c90 net/ipv6/ndisc.c:1559
  ndisc_rcv+0x2ad/0x3d0 net/ipv6/ndisc.c:1841
  icmpv6_rcv+0xe5a/0x12f0 net/ipv6/icmp.c:989
  ip6_protocol_deliver_rcu+0xb2a/0x10d0 net/ipv6/ip6_input.c:438
  ip6_input_finish+0xf0/0x1d0 net/ipv6/ip6_input.c:489
  NF_HOOK include/linux/netfilter.h:318 [inline]
  ip6_input+0x5e/0x140 net/ipv6/ip6_input.c:500
  ip6_mc_input+0x27c/0x470 net/ipv6/ip6_input.c:590
  dst_input include/net/dst.h:474 [inline]
  ip6_rcv_finish+0x336/0x340 net/ipv6/ip6_input.c:79
...

value changed: 0x00000000 -> 0xe5400659

The Linux kernel CVE team has assigned CVE-2026-23124 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.15 with commit 49b99da2c9ce13ffcd93fe3a0f5670791c1d76f7 and fixed in 5.15.199 with commit 4630897eb1a039b5d7b737b8dc9521d9d4b568b5
	Issue introduced in 5.15 with commit 49b99da2c9ce13ffcd93fe3a0f5670791c1d76f7 and fixed in 6.1.162 with commit 2619499169fb1c2ac4974b0f2d87767fb543582b
	Issue introduced in 5.15 with commit 49b99da2c9ce13ffcd93fe3a0f5670791c1d76f7 and fixed in 6.6.122 with commit fad8f4ff7928f4d52a062ffdcffa484989c79c47
	Issue introduced in 5.15 with commit 49b99da2c9ce13ffcd93fe3a0f5670791c1d76f7 and fixed in 6.12.68 with commit 2a2b9d25f801afecf2f83cacce98afa8fd73e3c9
	Issue introduced in 5.15 with commit 49b99da2c9ce13ffcd93fe3a0f5670791c1d76f7 and fixed in 6.18.8 with commit e3c1040252e598f7b4e33a42dc7c38519bc22428
	Issue introduced in 5.15 with commit 49b99da2c9ce13ffcd93fe3a0f5670791c1d76f7 and fixed in 6.19 with commit 9a063f96d87efc3a6cc667f8de096a3d38d74bb5

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2026-23124
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/ipv6/ndisc.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/4630897eb1a039b5d7b737b8dc9521d9d4b568b5
	https://git.kernel.org/stable/c/2619499169fb1c2ac4974b0f2d87767fb543582b
	https://git.kernel.org/stable/c/fad8f4ff7928f4d52a062ffdcffa484989c79c47
	https://git.kernel.org/stable/c/2a2b9d25f801afecf2f83cacce98afa8fd73e3c9
	https://git.kernel.org/stable/c/e3c1040252e598f7b4e33a42dc7c38519bc22428
	https://git.kernel.org/stable/c/9a063f96d87efc3a6cc667f8de096a3d38d74bb5
