From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2026-23130: wifi: ath12k: fix dead lock while flushing management frames
Message-Id: <2026021411-CVE-2026-23130-4390@gregkh>
Content-Length: 3133
Lines: 74
X-Developer-Signature: v=1; a=openpgp-sha256; l=3208;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=4vVmXE144IsBoYVoruMe4kHybfrm/PAKyjF9QjKqx+Q=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJkTJgR/dbLbmWqpzai9IMJBS56Fw3hTS8OdzXPWMX2x7
 GyeeZqvI5aFQZCJQVZMkeXLNp6j+ysOKXoZ2p6GmcPKBDKEgYtTACZSZccwP/wX3yRFiXjzE49U
 DrXfSc5ftdQjm2HBumALv4QAs4fNb137he5NFdwj+PQyAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

wifi: ath12k: fix dead lock while flushing management frames

Commit [1] converted the management transmission work item into a
wiphy work. Since a wiphy work can only run under wiphy lock
protection, a race condition happens in below scenario:

1. a management frame is queued for transmission.
2. ath12k_mac_op_flush() gets called to flush pending frames associated
   with the hardware (i.e, vif being NULL). Then in ath12k_mac_flush()
   the process waits for the transmission done.
3. Since wiphy lock has been taken by the flush process, the transmission
   work item has no chance to run, hence the dead lock.

>From user view, this dead lock results in below issue:

 wlp8s0: authenticate with xxxxxx (local address=xxxxxx)
 wlp8s0: send auth to xxxxxx (try 1/3)
 wlp8s0: authenticate with xxxxxx (local address=xxxxxx)
 wlp8s0: send auth to xxxxxx (try 1/3)
 wlp8s0: authenticated
 wlp8s0: associate with xxxxxx (try 1/3)
 wlp8s0: aborting association with xxxxxx by local choice (Reason: 3=DEAUTH_LEAVING)
 ath12k_pci 0000:08:00.0: failed to flush mgmt transmit queue, mgmt pkts pending 1

The dead lock can be avoided by invoking wiphy_work_flush() to proactively
run the queued work item. Note actually it is already present in
ath12k_mac_op_flush(), however it does not protect the case where vif
being NULL. Hence move it ahead to cover this case as well.

Tested-on: WCN7850 hw2.0 PCI WLAN.HMT.1.1.c5-00302-QCAHMTSWPL_V1.0_V2.0_SILICONZ-1.115823.3

The Linux kernel CVE team has assigned CVE-2026-23130 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.14 with commit 56dcbf0b520796e26b2bbe5686bdd305ad924954 and fixed in 6.18.8 with commit 06ac2aa13f701a0296e92f5f54ae24224d426b28
	Issue introduced in 6.14 with commit 56dcbf0b520796e26b2bbe5686bdd305ad924954 and fixed in 6.19 with commit f88e9fc30a261d63946ddc6cc6a33405e6aa27c3

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2026-23130
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/wireless/ath/ath12k/mac.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/06ac2aa13f701a0296e92f5f54ae24224d426b28
	https://git.kernel.org/stable/c/f88e9fc30a261d63946ddc6cc6a33405e6aa27c3
