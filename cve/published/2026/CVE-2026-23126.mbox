From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2026-23126: netdevsim: fix a race issue related to the operation on bpf_bound_progs list
Message-Id: <2026021409-CVE-2026-23126-b259@gregkh>
Content-Length: 4911
Lines: 95
X-Developer-Signature: v=1; a=openpgp-sha256; l=5007;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=8WobH6uGAMQfU08N/YegvAsB9ssdR1gCvdlRJ06o380=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJkTJgR+td1rcj+6YaL1BDlrmUaFKZMjb3DN/pbCWb5kO
 eu3Q6c+dMSyMAgyMciKKbJ82cZzdH/FIUUvQ9vTMHNYmUCGMHBxCsBEZoQyLOh8f0o4sdT9RbTP
 KrXJYTvYM04VaDIsWL/RpS7m5fPmDM+w8y4C7CWzlrFtAgA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

netdevsim: fix a race issue related to the operation on bpf_bound_progs list

The netdevsim driver lacks a protection mechanism for operations on the
bpf_bound_progs list. When the nsim_bpf_create_prog() performs
list_add_tail, it is possible that nsim_bpf_destroy_prog() is
simultaneously performs list_del. Concurrent operations on the list may
lead to list corruption and trigger a kernel crash as follows:

[  417.290971] kernel BUG at lib/list_debug.c:62!
[  417.290983] invalid opcode: 0000 [#1] PREEMPT SMP NOPTI
[  417.290992] CPU: 10 PID: 168 Comm: kworker/10:1 Kdump: loaded Not tainted 6.19.0-rc5 #1
[  417.291003] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-debian-1.16.3-2 04/01/2014
[  417.291007] Workqueue: events bpf_prog_free_deferred
[  417.291021] RIP: 0010:__list_del_entry_valid_or_report+0xa7/0xc0
[  417.291034] Code: a8 ff 0f 0b 48 89 fe 48 89 ca 48 c7 c7 48 a1 eb ae e8 ed fb a8 ff 0f 0b 48 89 fe 48 89 c2 48 c7 c7 80 a1 eb ae e8 d9 fb a8 ff <0f> 0b 48 89 d1 48 c7 c7 d0 a1 eb ae 48 89 f2 48 89 c6 e8 c2 fb a8
[  417.291040] RSP: 0018:ffffb16a40807df8 EFLAGS: 00010246
[  417.291046] RAX: 000000000000006d RBX: ffff8e589866f500 RCX: 0000000000000000
[  417.291051] RDX: 0000000000000000 RSI: ffff8e59f7b23180 RDI: ffff8e59f7b23180
[  417.291055] RBP: ffffb16a412c9000 R08: 0000000000000000 R09: 0000000000000003
[  417.291059] R10: ffffb16a40807c80 R11: ffffffffaf9edce8 R12: ffff8e594427ac20
[  417.291063] R13: ffff8e59f7b44780 R14: ffff8e58800b7a05 R15: 0000000000000000
[  417.291074] FS:  0000000000000000(0000) GS:ffff8e59f7b00000(0000) knlGS:0000000000000000
[  417.291079] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[  417.291083] CR2: 00007fc4083efe08 CR3: 00000001c3626006 CR4: 0000000000770ee0
[  417.291088] PKRU: 55555554
[  417.291091] Call Trace:
[  417.291096]  <TASK>
[  417.291103]  nsim_bpf_destroy_prog+0x31/0x80 [netdevsim]
[  417.291154]  __bpf_prog_offload_destroy+0x2a/0x80
[  417.291163]  bpf_prog_dev_bound_destroy+0x6f/0xb0
[  417.291171]  bpf_prog_free_deferred+0x18e/0x1a0
[  417.291178]  process_one_work+0x18a/0x3a0
[  417.291188]  worker_thread+0x27b/0x3a0
[  417.291197]  ? __pfx_worker_thread+0x10/0x10
[  417.291207]  kthread+0xe5/0x120
[  417.291214]  ? __pfx_kthread+0x10/0x10
[  417.291221]  ret_from_fork+0x31/0x50
[  417.291230]  ? __pfx_kthread+0x10/0x10
[  417.291236]  ret_from_fork_asm+0x1a/0x30
[  417.291246]  </TASK>

Add a mutex lock, to prevent simultaneous addition and deletion operations
on the list.

The Linux kernel CVE team has assigned CVE-2026-23126 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.16 with commit 31d3ad832948c75139b0e5b653912f7898a1d5d5 and fixed in 6.1.162 with commit 3f560cfc7706029294132482fff5d1bc7884b70d
	Issue introduced in 4.16 with commit 31d3ad832948c75139b0e5b653912f7898a1d5d5 and fixed in 6.6.122 with commit f1f9cfd2f46a73b7de2982d01be822eac3a0efaa
	Issue introduced in 4.16 with commit 31d3ad832948c75139b0e5b653912f7898a1d5d5 and fixed in 6.12.68 with commit d77379ca82efcb2fe563359cc795027d680410db
	Issue introduced in 4.16 with commit 31d3ad832948c75139b0e5b653912f7898a1d5d5 and fixed in 6.18.8 with commit 68462ecc40ea8f780fb3c74ebfddd05506bb731b
	Issue introduced in 4.16 with commit 31d3ad832948c75139b0e5b653912f7898a1d5d5 and fixed in 6.19 with commit b97d5eedf4976cc94321243be83b39efe81a0e15

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2026-23126
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/netdevsim/bpf.c
	drivers/net/netdevsim/dev.c
	drivers/net/netdevsim/netdevsim.h


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/3f560cfc7706029294132482fff5d1bc7884b70d
	https://git.kernel.org/stable/c/f1f9cfd2f46a73b7de2982d01be822eac3a0efaa
	https://git.kernel.org/stable/c/d77379ca82efcb2fe563359cc795027d680410db
	https://git.kernel.org/stable/c/68462ecc40ea8f780fb3c74ebfddd05506bb731b
	https://git.kernel.org/stable/c/b97d5eedf4976cc94321243be83b39efe81a0e15
