From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2026-23140: bpf, test_run: Subtract size of xdp_frame from allowed metadata size

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

bpf, test_run: Subtract size of xdp_frame from allowed metadata size

The xdp_frame structure takes up part of the XDP frame headroom,
limiting the size of the metadata. However, in bpf_test_run, we don't
take this into account, which makes it possible for userspace to supply
a metadata size that is too large (taking up the entire headroom).

If userspace supplies such a large metadata size in live packet mode,
the xdp_update_frame_from_buff() call in xdp_test_run_init_page() call
will fail, after which packet transmission proceeds with an
uninitialised frame structure, leading to the usual Bad Stuff.

The commit in the Fixes tag fixed a related bug where the second check
in xdp_update_frame_from_buff() could fail, but did not add any
additional constraints on the metadata size. Complete the fix by adding
an additional check on the metadata size. Reorder the checks slightly to
make the logic clearer and add a comment.

The Linux kernel CVE team has assigned CVE-2026-23140 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.18 with commit b6f1f780b3932ae497ed85e79bc8a1e513883624 and fixed in 6.1.161 with commit e7440935063949d6f2c10f7328d960d0ff4bce90
	Issue introduced in 5.18 with commit b6f1f780b3932ae497ed85e79bc8a1e513883624 and fixed in 6.6.121 with commit 7c81ad5e580bd8441f8a521a8d34824ce6582ae5
	Issue introduced in 5.18 with commit b6f1f780b3932ae497ed85e79bc8a1e513883624 and fixed in 6.12.66 with commit 6447e697cfa8a43a8e491cb81bcc390d0f28f8ba
	Issue introduced in 5.18 with commit b6f1f780b3932ae497ed85e79bc8a1e513883624 and fixed in 6.18.6 with commit 31e37f44b60679d90b9f999c91371b15291be8e0
	Issue introduced in 5.18 with commit b6f1f780b3932ae497ed85e79bc8a1e513883624 and fixed in 6.19 with commit e558cca217790286e799a8baacd1610bda31b261

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2026-23140
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/bpf/test_run.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/e7440935063949d6f2c10f7328d960d0ff4bce90
	https://git.kernel.org/stable/c/7c81ad5e580bd8441f8a521a8d34824ce6582ae5
	https://git.kernel.org/stable/c/6447e697cfa8a43a8e491cb81bcc390d0f28f8ba
	https://git.kernel.org/stable/c/31e37f44b60679d90b9f999c91371b15291be8e0
	https://git.kernel.org/stable/c/e558cca217790286e799a8baacd1610bda31b261
