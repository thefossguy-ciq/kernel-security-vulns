From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2026-22983: net: do not write to msg_get_inq in callee
Message-Id: <2026012348-CVE-2026-22983-db37@gregkh>
Content-Length: 2837
Lines: 72
X-Developer-Signature: v=1; a=openpgp-sha256; l=2910;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=tQVja9J5edRp8oovRIgQOia7B3umIO3p2gw+5OMrTwE=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJnFkw5q79+37faXP3v/GsUulhX7luSS//ZUte7p97M0R
 RJerXO60BHLwiDIxCArpsjyZRvP0f0VhxS9DG1Pw8xhZQIZwsDFKQAT+W/PME9LZVbM8lwH32lN
 McnyuerdURs37mRYsGyP644c0XQGr49l1Qt3Ovz2OzNhPwA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net: do not write to msg_get_inq in callee

NULL pointer dereference fix.

msg_get_inq is an input field from caller to callee. Don't set it in
the callee, as the caller may not clear it on struct reuse.

This is a kernel-internal variant of msghdr only, and the only user
does reinitialize the field. So this is not critical for that reason.
But it is more robust to avoid the write, and slightly simpler code.
And it fixes a bug, see below.

Callers set msg_get_inq to request the input queue length to be
returned in msg_inq. This is equivalent to but independent from the
SO_INQ request to return that same info as a cmsg (tp->recvmsg_inq).
To reduce branching in the hot path the second also sets the msg_inq.
That is WAI.

This is a fix to commit 4d1442979e4a ("af_unix: don't post cmsg for
SO_INQ unless explicitly asked for"), which fixed the inverse.

Also avoid NULL pointer dereference in unix_stream_read_generic if
state->msg is NULL and msg->msg_get_inq is written. A NULL state->msg
can happen when splicing as of commit 2b514574f7e8 ("net: af_unix:
implement splice for stream af_unix sockets").

Also collapse two branches using a bitwise or.

The Linux kernel CVE team has assigned CVE-2026-22983 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.18.4 with commit 089e50f29eeec8eef6ae1450fc88138d719291cb and fixed in 6.18.6 with commit ffa2be496ef65055b28b39c6bd9a7d66943ee89a
	Issue introduced in 6.19-rc4 with commit 4d1442979e4a53b9457ce1e373e187e1511ff688 and fixed in 6.19-rc5 with commit 7d11e047eda5f98514ae62507065ac961981c025

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2026-22983
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/ipv4/tcp.c
	net/unix/af_unix.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/ffa2be496ef65055b28b39c6bd9a7d66943ee89a
	https://git.kernel.org/stable/c/7d11e047eda5f98514ae62507065ac961981c025
