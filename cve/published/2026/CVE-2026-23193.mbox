From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2026-23193: scsi: target: iscsi: Fix use-after-free in iscsit_dec_session_usage_count()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

scsi: target: iscsi: Fix use-after-free in iscsit_dec_session_usage_count()

In iscsit_dec_session_usage_count(), the function calls complete() while
holding the sess->session_usage_lock. Similar to the connection usage count
logic, the waiter signaled by complete() (e.g., in the session release
path) may wake up and free the iscsit_session structure immediately.

This creates a race condition where the current thread may attempt to
execute spin_unlock_bh() on a session structure that has already been
deallocated, resulting in a KASAN slab-use-after-free.

To resolve this, release the session_usage_lock before calling complete()
to ensure all dereferences of the sess pointer are finished before the
waiter is allowed to proceed with deallocation.

The Linux kernel CVE team has assigned CVE-2026-23193 to this issue.


Affected and fixed versions
===========================

	Fixed in 5.10.250 with commit 2b64015550a13bcc72910be0565548d9a754d46d
	Fixed in 5.15.200 with commit fd8b0900173307039d3a84644c2fee041a7ed4fb
	Fixed in 6.1.163 with commit d8dbdc146e9e9a976931b78715be2e91299049f9
	Fixed in 6.6.124 with commit 11ebafffce31efc6abeb28c509017976fc49f1ca
	Fixed in 6.12.70 with commit 41b86a9ec037bd3435d68dd3692f0891a207e7e7
	Fixed in 6.18.10 with commit 4530f4e4d0e6a207110b0ffed0c911bca43531a4
	Fixed in 6.19 with commit 84dc6037390b8607c5551047d3970336cb51ba9a

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2026-23193
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/target/iscsi/iscsi_target_util.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/2b64015550a13bcc72910be0565548d9a754d46d
	https://git.kernel.org/stable/c/fd8b0900173307039d3a84644c2fee041a7ed4fb
	https://git.kernel.org/stable/c/d8dbdc146e9e9a976931b78715be2e91299049f9
	https://git.kernel.org/stable/c/11ebafffce31efc6abeb28c509017976fc49f1ca
	https://git.kernel.org/stable/c/41b86a9ec037bd3435d68dd3692f0891a207e7e7
	https://git.kernel.org/stable/c/4530f4e4d0e6a207110b0ffed0c911bca43531a4
	https://git.kernel.org/stable/c/84dc6037390b8607c5551047d3970336cb51ba9a
