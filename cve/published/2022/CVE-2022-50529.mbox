From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50529: test_firmware: fix memory leak in test_firmware_init()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

test_firmware: fix memory leak in test_firmware_init()

When misc_register() failed in test_firmware_init(), the memory pointed
by test_fw_config->name is not released. The memory leak information is
as follows:
unreferenced object 0xffff88810a34cb00 (size 32):
  comm "insmod", pid 7952, jiffies 4294948236 (age 49.060s)
  hex dump (first 32 bytes):
    74 65 73 74 2d 66 69 72 6d 77 61 72 65 2e 62 69  test-firmware.bi
    6e 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  n...............
  backtrace:
    [<ffffffff81b21fcb>] __kmalloc_node_track_caller+0x4b/0xc0
    [<ffffffff81affb96>] kstrndup+0x46/0xc0
    [<ffffffffa0403a49>] __test_firmware_config_init+0x29/0x380 [test_firmware]
    [<ffffffffa040f068>] 0xffffffffa040f068
    [<ffffffff81002c41>] do_one_initcall+0x141/0x780
    [<ffffffff816a72c3>] do_init_module+0x1c3/0x630
    [<ffffffff816adb9e>] load_module+0x623e/0x76a0
    [<ffffffff816af471>] __do_sys_finit_module+0x181/0x240
    [<ffffffff89978f99>] do_syscall_64+0x39/0xb0
    [<ffffffff89a0008b>] entry_SYSCALL_64_after_hwframe+0x63/0xcd

The Linux kernel CVE team has assigned CVE-2022-50529 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.14 with commit c92316bf8e94830a0225f2e904cbdbd173768419 and fixed in 4.14.303 with commit ed5cbafaf7ce8b86f19998c00eb020c8d49b017f
	Issue introduced in 4.14 with commit c92316bf8e94830a0225f2e904cbdbd173768419 and fixed in 4.19.270 with commit 04dd47a2e169f2d4489636afa07ff0469aab49ab
	Issue introduced in 4.14 with commit c92316bf8e94830a0225f2e904cbdbd173768419 and fixed in 5.4.229 with commit 628de998a3abfffb3f9677d2fb39a1d5dcb32fdb
	Issue introduced in 4.14 with commit c92316bf8e94830a0225f2e904cbdbd173768419 and fixed in 5.10.163 with commit 0b5a89e8bce1ea43687742b4de8e216189ff94ac
	Issue introduced in 4.14 with commit c92316bf8e94830a0225f2e904cbdbd173768419 and fixed in 5.15.86 with commit 357379d504c0c8b0834e206ad8c49e4b3c98ed4d
	Issue introduced in 4.14 with commit c92316bf8e94830a0225f2e904cbdbd173768419 and fixed in 6.0.16 with commit 8d8c1d6a430f0aadb80036e2b1bc0a05f9fad247
	Issue introduced in 4.14 with commit c92316bf8e94830a0225f2e904cbdbd173768419 and fixed in 6.1.2 with commit 6dd5fbd243f19f087dc79481acb7d69fb57fea2c
	Issue introduced in 4.14 with commit c92316bf8e94830a0225f2e904cbdbd173768419 and fixed in 6.2 with commit 7610615e8cdb3f6f5bbd9d8e7a5d8a63e3cabf2e

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50529
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	lib/test_firmware.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/ed5cbafaf7ce8b86f19998c00eb020c8d49b017f
	https://git.kernel.org/stable/c/04dd47a2e169f2d4489636afa07ff0469aab49ab
	https://git.kernel.org/stable/c/628de998a3abfffb3f9677d2fb39a1d5dcb32fdb
	https://git.kernel.org/stable/c/0b5a89e8bce1ea43687742b4de8e216189ff94ac
	https://git.kernel.org/stable/c/357379d504c0c8b0834e206ad8c49e4b3c98ed4d
	https://git.kernel.org/stable/c/8d8c1d6a430f0aadb80036e2b1bc0a05f9fad247
	https://git.kernel.org/stable/c/6dd5fbd243f19f087dc79481acb7d69fb57fea2c
	https://git.kernel.org/stable/c/7610615e8cdb3f6f5bbd9d8e7a5d8a63e3cabf2e
