From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50353: mmc: wmt-sdmmc: fix return value check of mmc_add_host()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

mmc: wmt-sdmmc: fix return value check of mmc_add_host()

mmc_add_host() may return error, if we ignore its return value, the memory
that allocated in mmc_alloc_host() will be leaked and it will lead a kernel
crash because of deleting not added device in the remove path.

So fix this by checking the return value and goto error path which will call
mmc_free_host(), besides, clk_disable_unprepare() also needs be called.

The Linux kernel CVE team has assigned CVE-2022-50353 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.8 with commit 3a96dff0f828ae9dfb43efd49a9b67a74c6dc360 and fixed in 4.14.303 with commit 70b0620afab3c69d95a7e2dd7ceff162a21c4009
	Issue introduced in 3.8 with commit 3a96dff0f828ae9dfb43efd49a9b67a74c6dc360 and fixed in 4.19.270 with commit ecd6f77af3478f5223aa4011642a891b7dc91228
	Issue introduced in 3.8 with commit 3a96dff0f828ae9dfb43efd49a9b67a74c6dc360 and fixed in 5.4.229 with commit c7a328cea791cc2769b6417943939420913b4a46
	Issue introduced in 3.8 with commit 3a96dff0f828ae9dfb43efd49a9b67a74c6dc360 and fixed in 5.10.163 with commit 9bedf64dda84b29151e41591d8ded9ff0e6d336a
	Issue introduced in 3.8 with commit 3a96dff0f828ae9dfb43efd49a9b67a74c6dc360 and fixed in 5.15.86 with commit 58c3a8d0f1abeb1ca5c2df948be58ad4f7bb6f67
	Issue introduced in 3.8 with commit 3a96dff0f828ae9dfb43efd49a9b67a74c6dc360 and fixed in 6.0.16 with commit b40ac3b696a9c84b36211ef0c3f5a422650c101b
	Issue introduced in 3.8 with commit 3a96dff0f828ae9dfb43efd49a9b67a74c6dc360 and fixed in 6.1.2 with commit eb7a2d516d4fbd165c07877a20feccb047342b1f
	Issue introduced in 3.8 with commit 3a96dff0f828ae9dfb43efd49a9b67a74c6dc360 and fixed in 6.2 with commit 29276d56f6ed138db0f38cd31aedc0b725c8c76c

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50353
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/mmc/host/wmt-sdmmc.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/70b0620afab3c69d95a7e2dd7ceff162a21c4009
	https://git.kernel.org/stable/c/ecd6f77af3478f5223aa4011642a891b7dc91228
	https://git.kernel.org/stable/c/c7a328cea791cc2769b6417943939420913b4a46
	https://git.kernel.org/stable/c/9bedf64dda84b29151e41591d8ded9ff0e6d336a
	https://git.kernel.org/stable/c/58c3a8d0f1abeb1ca5c2df948be58ad4f7bb6f67
	https://git.kernel.org/stable/c/b40ac3b696a9c84b36211ef0c3f5a422650c101b
	https://git.kernel.org/stable/c/eb7a2d516d4fbd165c07877a20feccb047342b1f
	https://git.kernel.org/stable/c/29276d56f6ed138db0f38cd31aedc0b725c8c76c
