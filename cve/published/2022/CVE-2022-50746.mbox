From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50746: erofs: validate the extent length for uncompressed pclusters

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

erofs: validate the extent length for uncompressed pclusters

syzkaller reported a KASAN use-after-free:
https://syzkaller.appspot.com/bug?extid=2ae90e873e97f1faf6f2

The referenced fuzzed image actually has two issues:
 - m_pa == 0 as a non-inlined pcluster;
 - The logical length is longer than its physical length.

The first issue has already been addressed.  This patch addresses
the second issue by checking the extent length validity.

The Linux kernel CVE team has assigned CVE-2022-50746 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.19 with commit 02827e1796b33f1794966f5c3101f8da2dfa9c1d and fixed in 6.0.16 with commit dc8b6bd587b13b85aff6e9d36cdfcd3f955cac9e
	Issue introduced in 4.19 with commit 02827e1796b33f1794966f5c3101f8da2dfa9c1d and fixed in 6.1.2 with commit 40c73b2ea9611b5388807be406f30f5e4e1162da
	Issue introduced in 4.19 with commit 02827e1796b33f1794966f5c3101f8da2dfa9c1d and fixed in 6.2 with commit c505feba4c0d76084e56ec498ce819f02a7043ae

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50746
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/erofs/zmap.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/dc8b6bd587b13b85aff6e9d36cdfcd3f955cac9e
	https://git.kernel.org/stable/c/40c73b2ea9611b5388807be406f30f5e4e1162da
	https://git.kernel.org/stable/c/c505feba4c0d76084e56ec498ce819f02a7043ae
