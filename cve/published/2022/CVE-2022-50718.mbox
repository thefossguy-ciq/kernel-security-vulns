From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50718: drm/amdgpu: fix pci device refcount leak
Message-Id: <2025122416-CVE-2022-50718-a890@gregkh>
Content-Length: 2704
Lines: 59
X-Developer-Signature: v=1; a=openpgp-sha256; l=2764;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=F1I6Y/BfvbCMVhikBpiW5T3JrA79W0YI/wJNhLU8o7o=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJnet1889pUTE3v8meE/26KXO/i9M1Zw2Yk+e7uzmkPEm
 f8918rkjlgWBkEmBlkxRZYv23iO7q84pOhlaHsaZg4rE8gQBi5OAZgIx2qGuRKHJjRNlZnFEGaa
 EqVwLou9PmWNA8N8r6Xbk1g3XK4NvTipLaAyfKb6waNSAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/amdgpu: fix pci device refcount leak

As comment of pci_get_domain_bus_and_slot() says, it returns
a pci device with refcount increment, when finish using it,
the caller must decrement the reference count by calling
pci_dev_put().

So before returning from amdgpu_device_resume|suspend_display_audio(),
pci_dev_put() is called to avoid refcount leak.

The Linux kernel CVE team has assigned CVE-2022-50718 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.8 with commit 3f12acc8d6d4b2e62fab8f652d7075a859d80b42 and fixed in 5.10.163 with commit 3725a8f26bdbc38dfdf545836117f1e069277c91
	Issue introduced in 5.8 with commit 3f12acc8d6d4b2e62fab8f652d7075a859d80b42 and fixed in 5.15.86 with commit 02105f0b3021ee5853b2fa50853c42f35fc01cfd
	Issue introduced in 5.8 with commit 3f12acc8d6d4b2e62fab8f652d7075a859d80b42 and fixed in 6.0.16 with commit f13661b72a61708cecb06562f8acff068a4f31f7
	Issue introduced in 5.8 with commit 3f12acc8d6d4b2e62fab8f652d7075a859d80b42 and fixed in 6.1.2 with commit d7352b410471cbebf6350b2990bae82bb0d59a76
	Issue introduced in 5.8 with commit 3f12acc8d6d4b2e62fab8f652d7075a859d80b42 and fixed in 6.2 with commit b85e285e3d6352b02947fc1b72303673dfacb0aa

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50718
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/amd/amdgpu/amdgpu_device.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/3725a8f26bdbc38dfdf545836117f1e069277c91
	https://git.kernel.org/stable/c/02105f0b3021ee5853b2fa50853c42f35fc01cfd
	https://git.kernel.org/stable/c/f13661b72a61708cecb06562f8acff068a4f31f7
	https://git.kernel.org/stable/c/d7352b410471cbebf6350b2990bae82bb0d59a76
	https://git.kernel.org/stable/c/b85e285e3d6352b02947fc1b72303673dfacb0aa
