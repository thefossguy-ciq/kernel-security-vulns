From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50365: skbuff: Account for tail adjustment during pull operations

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

skbuff: Account for tail adjustment during pull operations

Extending the tail can have some unexpected side effects if a program uses
a helper like BPF_FUNC_skb_pull_data to read partial content beyond the
head skb headlen when all the skbs in the gso frag_list are linear with no
head_frag -

  kernel BUG at net/core/skbuff.c:4219!
  pc : skb_segment+0xcf4/0xd2c
  lr : skb_segment+0x63c/0xd2c
  Call trace:
   skb_segment+0xcf4/0xd2c
   __udp_gso_segment+0xa4/0x544
   udp4_ufo_fragment+0x184/0x1c0
   inet_gso_segment+0x16c/0x3a4
   skb_mac_gso_segment+0xd4/0x1b0
   __skb_gso_segment+0xcc/0x12c
   udp_rcv_segment+0x54/0x16c
   udp_queue_rcv_skb+0x78/0x144
   udp_unicast_rcv_skb+0x8c/0xa4
   __udp4_lib_rcv+0x490/0x68c
   udp_rcv+0x20/0x30
   ip_protocol_deliver_rcu+0x1b0/0x33c
   ip_local_deliver+0xd8/0x1f0
   ip_rcv+0x98/0x1a4
   deliver_ptype_list_skb+0x98/0x1ec
   __netif_receive_skb_core+0x978/0xc60

Fix this by marking these skbs as GSO_DODGY so segmentation can handle
the tail updates accordingly.

The Linux kernel CVE team has assigned CVE-2022-50365 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.9.194 with commit 162a5a8c3aff15c449e6b38355cdf80ab4f77a5a and fixed in 4.9.337 with commit ff3743d00f41d803e6ab9334962b674f3b7fd0cb
	Issue introduced in 4.14.145 with commit 55fb612bef7fd237fb70068e2b6ff1cd1543a8ef and fixed in 4.14.303 with commit 6ac417d71b80e74b002313fcd73f7e9008e8e457
	Issue introduced in 4.19.74 with commit 821302dd0c51d29269ef73a595bdff294419e2cd and fixed in 4.19.270 with commit 2d59f0ca153e9573ec4f140988c0ccca0eb4181b
	Issue introduced in 5.3 with commit 3dcbdb134f329842a38f0e6797191b885ab00a00 and fixed in 5.4.229 with commit 668dc454bcbd1da73605201ff43f988c70848215
	Issue introduced in 5.3 with commit 3dcbdb134f329842a38f0e6797191b885ab00a00 and fixed in 5.10.163 with commit 821be5a5ab09a40ba09cb5ba354f18cf7996fea0
	Issue introduced in 5.3 with commit 3dcbdb134f329842a38f0e6797191b885ab00a00 and fixed in 5.15.86 with commit 8fb773eed4909ef5dc1bbeb3629a337d3336df7e
	Issue introduced in 5.3 with commit 3dcbdb134f329842a38f0e6797191b885ab00a00 and fixed in 6.0.16 with commit 946dd5dc4fcc4123cdfe3942b20012c4448cf89a
	Issue introduced in 5.3 with commit 3dcbdb134f329842a38f0e6797191b885ab00a00 and fixed in 6.1.2 with commit 331615d837f4979eb91a336a223a5c7f7886ecd5
	Issue introduced in 5.3 with commit 3dcbdb134f329842a38f0e6797191b885ab00a00 and fixed in 6.2 with commit 2d7afdcbc9d32423f177ee12b7c93783aea338fb
	Issue introduced in 5.2.16 with commit 92984818ff8cfd97311a5e0ac27f148a00df2b54

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50365
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/core/skbuff.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/ff3743d00f41d803e6ab9334962b674f3b7fd0cb
	https://git.kernel.org/stable/c/6ac417d71b80e74b002313fcd73f7e9008e8e457
	https://git.kernel.org/stable/c/2d59f0ca153e9573ec4f140988c0ccca0eb4181b
	https://git.kernel.org/stable/c/668dc454bcbd1da73605201ff43f988c70848215
	https://git.kernel.org/stable/c/821be5a5ab09a40ba09cb5ba354f18cf7996fea0
	https://git.kernel.org/stable/c/8fb773eed4909ef5dc1bbeb3629a337d3336df7e
	https://git.kernel.org/stable/c/946dd5dc4fcc4123cdfe3942b20012c4448cf89a
	https://git.kernel.org/stable/c/331615d837f4979eb91a336a223a5c7f7886ecd5
	https://git.kernel.org/stable/c/2d7afdcbc9d32423f177ee12b7c93783aea338fb
