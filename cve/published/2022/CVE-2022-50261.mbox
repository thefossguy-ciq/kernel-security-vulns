From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50261: drm/sti: Fix return type of sti_{dvo,hda,hdmi}_connector_mode_valid()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/sti: Fix return type of sti_{dvo,hda,hdmi}_connector_mode_valid()

With clang's kernel control flow integrity (kCFI, CONFIG_CFI_CLANG),
indirect call targets are validated against the expected function
pointer prototype to make sure the call target is valid to help mitigate
ROP attacks. If they are not identical, there is a failure at run time,
which manifests as either a kernel panic or thread getting killed. A
proposed warning in clang aims to catch these at compile time, which
reveals:

  drivers/gpu/drm/sti/sti_hda.c:637:16: error: incompatible function pointer types initializing 'enum drm_mode_status (*)(struct drm_connector *, struct drm_display_mode *)' with an expression of type 'int (struct drm_connector *, struct drm_display_mode *)' [-Werror,-Wincompatible-function-pointer-types-strict]
          .mode_valid = sti_hda_connector_mode_valid,
                        ^~~~~~~~~~~~~~~~~~~~~~~~~~~~
  drivers/gpu/drm/sti/sti_dvo.c:376:16: error: incompatible function pointer types initializing 'enum drm_mode_status (*)(struct drm_connector *, struct drm_display_mode *)' with an expression of type 'int (struct drm_connector *, struct drm_display_mode *)' [-Werror,-Wincompatible-function-pointer-types-strict]
          .mode_valid = sti_dvo_connector_mode_valid,
                        ^~~~~~~~~~~~~~~~~~~~~~~~~~~~
  drivers/gpu/drm/sti/sti_hdmi.c:1035:16: error: incompatible function pointer types initializing 'enum drm_mode_status (*)(struct drm_connector *, struct drm_display_mode *)' with an expression of type 'int (struct drm_connector *, struct drm_display_mode *)' [-Werror,-Wincompatible-function-pointer-types-strict]
          .mode_valid = sti_hdmi_connector_mode_valid,
                        ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~

->mode_valid() in 'struct drm_connector_helper_funcs' expects a return
type of 'enum drm_mode_status', not 'int'. Adjust the return type of
sti_{dvo,hda,hdmi}_connector_mode_valid() to match the prototype's to
resolve the warning and CFI failure.

The Linux kernel CVE team has assigned CVE-2022-50261 to this issue.


Affected and fixed versions
===========================

	Fixed in 4.9.337 with commit b2c92b2a3801b09b709cbefd9a9e4944b72400bf
	Fixed in 4.14.303 with commit b4307c7d35e346b909edfdc1f280902150570bb6
	Fixed in 4.19.270 with commit 8f9941dea3a70b73f2063f9dcc4aaae6af03c5ba
	Fixed in 5.4.229 with commit 511b48ee8e4aec2d03d2af06b363d9eb3230b017
	Fixed in 5.10.163 with commit 6e3c4d3fa5d458d685561ecbaf8daa9dba14979e
	Fixed in 5.15.86 with commit a075c21ee026f4a74f9fce5928ea3c8d18a8af13
	Fixed in 6.0.16 with commit e578b0906b6a81479cd5b5b6c848a7096addf5e9
	Fixed in 6.1.2 with commit 04371a75a58422a301a9ff9ae3babd310ac3bb3f
	Fixed in 6.2 with commit 0ad811cc08a937d875cbad0149c1bab17f84ba05

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50261
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/sti/sti_dvo.c
	drivers/gpu/drm/sti/sti_hda.c
	drivers/gpu/drm/sti/sti_hdmi.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/b2c92b2a3801b09b709cbefd9a9e4944b72400bf
	https://git.kernel.org/stable/c/b4307c7d35e346b909edfdc1f280902150570bb6
	https://git.kernel.org/stable/c/8f9941dea3a70b73f2063f9dcc4aaae6af03c5ba
	https://git.kernel.org/stable/c/511b48ee8e4aec2d03d2af06b363d9eb3230b017
	https://git.kernel.org/stable/c/6e3c4d3fa5d458d685561ecbaf8daa9dba14979e
	https://git.kernel.org/stable/c/a075c21ee026f4a74f9fce5928ea3c8d18a8af13
	https://git.kernel.org/stable/c/e578b0906b6a81479cd5b5b6c848a7096addf5e9
	https://git.kernel.org/stable/c/04371a75a58422a301a9ff9ae3babd310ac3bb3f
	https://git.kernel.org/stable/c/0ad811cc08a937d875cbad0149c1bab17f84ba05
