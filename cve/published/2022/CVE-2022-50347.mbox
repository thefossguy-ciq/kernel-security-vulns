From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50347: mmc: rtsx_usb_sdmmc: fix return value check of mmc_add_host()
Message-Id: <2025091640-CVE-2022-50347-33c3@gregkh>
Content-Length: 3702
Lines: 67
X-Developer-Signature: v=1; a=openpgp-sha256; l=3770;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=2N7uwhrPCt4q1QFPl5cIgeEaHS+jnNtwZUkQ13u4crI=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBkne2xWbTzsc/3OyVK+6taDxgvy0ndZrgxynOVXOc/rR
 qfr7RnfO2JZGASZGGTFFFm+bOM5ur/ikKKXoe1pmDmsTCBDGLg4BWAiszcyzC/pc9i4sqZHOcQn
 8DHXtpkRrSxGGxkWTFq2VL7KOCVq5eXKGFfOUhYu2dqFAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

mmc: rtsx_usb_sdmmc: fix return value check of mmc_add_host()

mmc_add_host() may return error, if we ignore its return value, the memory
that allocated in mmc_alloc_host() will be leaked and it will lead a kernel
crash because of deleting not added device in the remove path.

So fix this by checking the return value and calling mmc_free_host() in the
error path, besides, led_classdev_unregister() and pm_runtime_disable() also
need be called.

The Linux kernel CVE team has assigned CVE-2022-50347 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.16 with commit c7f6558d84afe60016b8103c0737df6e376a1c2d and fixed in 4.9.337 with commit d7ad7278be401b09c9f9a9f522cf4c449c7fd489
	Issue introduced in 3.16 with commit c7f6558d84afe60016b8103c0737df6e376a1c2d and fixed in 4.14.303 with commit e598c9683fe1cf97c2b11b800cc3cee072108220
	Issue introduced in 3.16 with commit c7f6558d84afe60016b8103c0737df6e376a1c2d and fixed in 4.19.270 with commit 89303ddbb502c3bc8edbf864f9f85500c8fe07e9
	Issue introduced in 3.16 with commit c7f6558d84afe60016b8103c0737df6e376a1c2d and fixed in 5.4.229 with commit 937112e991ed25d1727d878734adcbef3b900274
	Issue introduced in 3.16 with commit c7f6558d84afe60016b8103c0737df6e376a1c2d and fixed in 5.10.163 with commit 7fa922c7a3dd623fd59f1af50e8896fd9ca7f654
	Issue introduced in 3.16 with commit c7f6558d84afe60016b8103c0737df6e376a1c2d and fixed in 5.15.86 with commit df683201c7ffbd21a806a7cad657b661c5ebfb6f
	Issue introduced in 3.16 with commit c7f6558d84afe60016b8103c0737df6e376a1c2d and fixed in 6.0.16 with commit 1491667d5450778a265eddddd294219acfd648cb
	Issue introduced in 3.16 with commit c7f6558d84afe60016b8103c0737df6e376a1c2d and fixed in 6.1.2 with commit a522e26a20a43dcfbef9ee9f71ed803290e852b0
	Issue introduced in 3.16 with commit c7f6558d84afe60016b8103c0737df6e376a1c2d and fixed in 6.2 with commit fc38a5a10e9e5a75eb9189854abeb8405b214cc9

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50347
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/mmc/host/rtsx_usb_sdmmc.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d7ad7278be401b09c9f9a9f522cf4c449c7fd489
	https://git.kernel.org/stable/c/e598c9683fe1cf97c2b11b800cc3cee072108220
	https://git.kernel.org/stable/c/89303ddbb502c3bc8edbf864f9f85500c8fe07e9
	https://git.kernel.org/stable/c/937112e991ed25d1727d878734adcbef3b900274
	https://git.kernel.org/stable/c/7fa922c7a3dd623fd59f1af50e8896fd9ca7f654
	https://git.kernel.org/stable/c/df683201c7ffbd21a806a7cad657b661c5ebfb6f
	https://git.kernel.org/stable/c/1491667d5450778a265eddddd294219acfd648cb
	https://git.kernel.org/stable/c/a522e26a20a43dcfbef9ee9f71ed803290e852b0
	https://git.kernel.org/stable/c/fc38a5a10e9e5a75eb9189854abeb8405b214cc9
