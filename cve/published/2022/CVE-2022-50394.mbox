From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50394: i2c: ismt: Fix an out-of-bounds bug in ismt_access()
Message-Id: <2025091853-CVE-2022-50394-fcaa@gregkh>
Content-Length: 4192
Lines: 79
X-Developer-Signature: v=1; a=openpgp-sha256; l=4272;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=5HW0ieTWkvYCDM8WlanLFHwpQ/CdIWKzAWFSrfZWdSI=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBlnuBxP+xT07fzvo77iIf/mgMWnY7+2db39kS2robt7A
 c9e56KEjlgWBkEmBlkxRZYv23iO7q84pOhlaHsaZg4rE8gQBi5OAZhIoR/D/LD/T1Tu3a8q27eL
 adr6rJIXFn/jrjMsaPhRJx4wd570ueRKkfutm44I7EznAwA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

i2c: ismt: Fix an out-of-bounds bug in ismt_access()

When the driver does not check the data from the user, the variable
'data->block[0]' may be very large to cause an out-of-bounds bug.

The following log can reveal it:

[   33.995542] i2c i2c-1: ioctl, cmd=0x720, arg=0x7ffcb3dc3a20
[   33.995978] ismt_smbus 0000:00:05.0: I2C_SMBUS_BLOCK_DATA:  WRITE
[   33.996475] ==================================================================
[   33.996995] BUG: KASAN: out-of-bounds in ismt_access.cold+0x374/0x214b
[   33.997473] Read of size 18446744073709551615 at addr ffff88810efcfdb1 by task ismt_poc/485
[   33.999450] Call Trace:
[   34.001849]  memcpy+0x20/0x60
[   34.002077]  ismt_access.cold+0x374/0x214b
[   34.003382]  __i2c_smbus_xfer+0x44f/0xfb0
[   34.004007]  i2c_smbus_xfer+0x10a/0x390
[   34.004291]  i2cdev_ioctl_smbus+0x2c8/0x710
[   34.005196]  i2cdev_ioctl+0x5ec/0x74c

Fix this bug by checking the size of 'data->block[0]' first.

The Linux kernel CVE team has assigned CVE-2022-50394 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.9 with commit 13f35ac14cd0a9a1c4f0034c4c40d0ae98844ce9 and fixed in 4.9.337 with commit 4a7bb1d93addb2f67e36fed00a53cb7f270d7b7a
	Issue introduced in 3.9 with commit 13f35ac14cd0a9a1c4f0034c4c40d0ae98844ce9 and fixed in 4.14.303 with commit 03b7ef7a6c5ca1ff553470166b4919db88b810f6
	Issue introduced in 3.9 with commit 13f35ac14cd0a9a1c4f0034c4c40d0ae98844ce9 and fixed in 4.19.270 with commit bfe41d966c860a8ad4c735639d616da270c92735
	Issue introduced in 3.9 with commit 13f35ac14cd0a9a1c4f0034c4c40d0ae98844ce9 and fixed in 5.4.229 with commit cdcbae2c5003747ddfd14e29db9c1d5d7e7c44dd
	Issue introduced in 3.9 with commit 13f35ac14cd0a9a1c4f0034c4c40d0ae98844ce9 and fixed in 5.10.163 with commit 9ac541a0898e8ec187a3fa7024b9701cffae6bf2
	Issue introduced in 3.9 with commit 13f35ac14cd0a9a1c4f0034c4c40d0ae98844ce9 and fixed in 5.15.86 with commit 96c12fd0ec74641295e1c3c34dea3dce1b6c3422
	Issue introduced in 3.9 with commit 13f35ac14cd0a9a1c4f0034c4c40d0ae98844ce9 and fixed in 6.0.16 with commit a642469d464b2780a25a49b51ae56623c65eac34
	Issue introduced in 3.9 with commit 13f35ac14cd0a9a1c4f0034c4c40d0ae98844ce9 and fixed in 6.1.2 with commit 233348a04becf133283f0076e20b317302de21d9
	Issue introduced in 3.9 with commit 13f35ac14cd0a9a1c4f0034c4c40d0ae98844ce9 and fixed in 6.2 with commit 39244cc754829bf707dccd12e2ce37510f5b1f8d

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50394
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/i2c/busses/i2c-ismt.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/4a7bb1d93addb2f67e36fed00a53cb7f270d7b7a
	https://git.kernel.org/stable/c/03b7ef7a6c5ca1ff553470166b4919db88b810f6
	https://git.kernel.org/stable/c/bfe41d966c860a8ad4c735639d616da270c92735
	https://git.kernel.org/stable/c/cdcbae2c5003747ddfd14e29db9c1d5d7e7c44dd
	https://git.kernel.org/stable/c/9ac541a0898e8ec187a3fa7024b9701cffae6bf2
	https://git.kernel.org/stable/c/96c12fd0ec74641295e1c3c34dea3dce1b6c3422
	https://git.kernel.org/stable/c/a642469d464b2780a25a49b51ae56623c65eac34
	https://git.kernel.org/stable/c/233348a04becf133283f0076e20b317302de21d9
	https://git.kernel.org/stable/c/39244cc754829bf707dccd12e2ce37510f5b1f8d
