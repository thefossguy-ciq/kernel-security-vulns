From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50760: drm/amdgpu: Fix PCI device refcount leak in amdgpu_atrm_get_bios()
Message-Id: <2025122455-CVE-2022-50760-b793@gregkh>
Content-Length: 3665
Lines: 67
X-Developer-Signature: v=1; a=openpgp-sha256; l=3733;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=8B8JEeh+4Fut2Z+/7n9i4pp1NKtI8K2MxzmDJJoYzvM=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJneT43bmnTqSntW2FzObDh+OPhd2KW37NOyrXKC+htiP
 By3xmzviGVhEGRikBVTZPmyjefo/opDil6Gtqdh5rAygQxh4OIUgImw/WCYp7y3+eR+k97CDRem
 Bl1aJs3aI3O2kGHBjs8yDWcrLu5oajqTP3v5/gSGF09fAwA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/amdgpu: Fix PCI device refcount leak in amdgpu_atrm_get_bios()

As comment of pci_get_class() says, it returns a pci_device with its
refcount increased and decreased the refcount for the input parameter
@from if it is not NULL.

If we break the loop in amdgpu_atrm_get_bios() with 'pdev' not NULL, we
need to call pci_dev_put() to decrease the refcount. Add the missing
pci_dev_put() to avoid refcount leak.

The Linux kernel CVE team has assigned CVE-2022-50760 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.2 with commit d38ceaf99ed015f2a0b9af3499791bd3a3daae21 and fixed in 4.9.337 with commit 6611feef35c0c8c4d297b28a7fc6ab3a2c47eca7
	Issue introduced in 4.2 with commit d38ceaf99ed015f2a0b9af3499791bd3a3daae21 and fixed in 4.14.303 with commit da7c78ea9e62bb65273d3ff19a3866ec205bfe18
	Issue introduced in 4.2 with commit d38ceaf99ed015f2a0b9af3499791bd3a3daae21 and fixed in 4.19.270 with commit 3360125d721c91d697c71201f18f042ff743e936
	Issue introduced in 4.2 with commit d38ceaf99ed015f2a0b9af3499791bd3a3daae21 and fixed in 5.4.229 with commit 981024abf5fe605c94d4f906f65d1b3408d628be
	Issue introduced in 4.2 with commit d38ceaf99ed015f2a0b9af3499791bd3a3daae21 and fixed in 5.10.163 with commit 7c1ddf7c664b5bc91f14b1bdeaa45520ef1760e4
	Issue introduced in 4.2 with commit d38ceaf99ed015f2a0b9af3499791bd3a3daae21 and fixed in 5.15.86 with commit 8f2d2badf8ca5e7e7c30d88840b695c8af7286f3
	Issue introduced in 4.2 with commit d38ceaf99ed015f2a0b9af3499791bd3a3daae21 and fixed in 6.0.16 with commit 9d4057d0452243917e12eb19f1599c96f2f05b14
	Issue introduced in 4.2 with commit d38ceaf99ed015f2a0b9af3499791bd3a3daae21 and fixed in 6.1.2 with commit a8b54ad7106c0604c4adc4933138b3557739bce0
	Issue introduced in 4.2 with commit d38ceaf99ed015f2a0b9af3499791bd3a3daae21 and fixed in 6.2 with commit ca54639c7752edf1304d92ff4d0c049d4efc9ba0

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50760
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/amd/amdgpu/amdgpu_bios.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/6611feef35c0c8c4d297b28a7fc6ab3a2c47eca7
	https://git.kernel.org/stable/c/da7c78ea9e62bb65273d3ff19a3866ec205bfe18
	https://git.kernel.org/stable/c/3360125d721c91d697c71201f18f042ff743e936
	https://git.kernel.org/stable/c/981024abf5fe605c94d4f906f65d1b3408d628be
	https://git.kernel.org/stable/c/7c1ddf7c664b5bc91f14b1bdeaa45520ef1760e4
	https://git.kernel.org/stable/c/8f2d2badf8ca5e7e7c30d88840b695c8af7286f3
	https://git.kernel.org/stable/c/9d4057d0452243917e12eb19f1599c96f2f05b14
	https://git.kernel.org/stable/c/a8b54ad7106c0604c4adc4933138b3557739bce0
	https://git.kernel.org/stable/c/ca54639c7752edf1304d92ff4d0c049d4efc9ba0
