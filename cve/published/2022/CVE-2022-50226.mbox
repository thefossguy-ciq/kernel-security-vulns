From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50226: crypto: ccp - Use kzalloc for sev ioctl interfaces to prevent kernel memory leak
Message-Id: <2025061849-CVE-2022-50226-9c73@gregkh>
Content-Length: 3064
Lines: 63
X-Developer-Signature: v=1; a=openpgp-sha256; l=3128;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=GOOwRlUmSRU8YsS7fGUpKEx51xLS/RZDxctJttcEG+o=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBlBc+bOiylgDV7uzral2uxA9FQXBts7yYtYWdjuzN/i2
 b+GX465I5aFQZCJQVZMkeXLNp6j+ysOKXoZ2p6GmcPKBDKEgYtTACbCzc6woG9r2AuBb1aX9ZhW
 b2h1XzL7sLMhB8OC3jcsXbf8g5KvXbEQ9NFhrDurwbQXAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

crypto: ccp - Use kzalloc for sev ioctl interfaces to prevent kernel memory leak

For some sev ioctl interfaces, input may be passed that is less than or
equal to SEV_FW_BLOB_MAX_SIZE, but larger than the data that PSP
firmware returns. In this case, kmalloc will allocate memory that is the
size of the input rather than the size of the data. Since PSP firmware
doesn't fully overwrite the buffer, the sev ioctl interfaces with the
issue may return uninitialized slab memory.

Currently, all of the ioctl interfaces in the ccp driver are safe, but
to prevent future problems, change all ioctl interfaces that allocate
memory with kmalloc to use kzalloc and memset the data buffer to zero
in sev_ioctl_do_platform_status.

The Linux kernel CVE team has assigned CVE-2022-50226 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.16 with commit e799035609e1526761aa2f896a974b233d04d36d and fixed in 5.10.173 with commit 4c5300f6f5e18b11c02a92f136e69b98fddba15e
	Issue introduced in 4.16 with commit e799035609e1526761aa2f896a974b233d04d36d and fixed in 5.15.61 with commit f2a920daa780956b987c14b9f23de7c3c8915bf2
	Issue introduced in 4.16 with commit e799035609e1526761aa2f896a974b233d04d36d and fixed in 5.18.18 with commit caa395aa16e7c9193fd7fa6cde462dd8229d4953
	Issue introduced in 4.16 with commit e799035609e1526761aa2f896a974b233d04d36d and fixed in 5.19.2 with commit e11fb0a3a39bb42da35fa662c46ce7391f277436
	Issue introduced in 4.16 with commit e799035609e1526761aa2f896a974b233d04d36d and fixed in 6.0 with commit 13dc15a3f5fd7f884e4bfa8c011a0ae868df12ae

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50226
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/crypto/ccp/sev-dev.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/4c5300f6f5e18b11c02a92f136e69b98fddba15e
	https://git.kernel.org/stable/c/f2a920daa780956b987c14b9f23de7c3c8915bf2
	https://git.kernel.org/stable/c/caa395aa16e7c9193fd7fa6cde462dd8229d4953
	https://git.kernel.org/stable/c/e11fb0a3a39bb42da35fa662c46ce7391f277436
	https://git.kernel.org/stable/c/13dc15a3f5fd7f884e4bfa8c011a0ae868df12ae
