From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-49978: fbdev: fb_pm2fb: Avoid potential divide by zero error

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

fbdev: fb_pm2fb: Avoid potential divide by zero error

In `do_fb_ioctl()` of fbmem.c, if cmd is FBIOPUT_VSCREENINFO, var will be
copied from user, then go through `fb_set_var()` and
`info->fbops->fb_check_var()` which could may be `pm2fb_check_var()`.
Along the path, `var->pixclock` won't be modified. This function checks
whether reciprocal of `var->pixclock` is too high. If `var->pixclock` is
zero, there will be a divide by zero error. So, it is necessary to check
whether denominator is zero to avoid crash. As this bug is found by
Syzkaller, logs are listed below.

divide error in pm2fb_check_var
Call Trace:
 <TASK>
 fb_set_var+0x367/0xeb0 drivers/video/fbdev/core/fbmem.c:1015
 do_fb_ioctl+0x234/0x670 drivers/video/fbdev/core/fbmem.c:1110
 fb_ioctl+0xdd/0x130 drivers/video/fbdev/core/fbmem.c:1189

The Linux kernel CVE team has assigned CVE-2022-49978 to this issue.


Affected and fixed versions
===========================

	Fixed in 4.9.327 with commit 0f1174f4972ea9fad6becf8881d71adca8e9ca91
	Fixed in 4.14.292 with commit 3ec326a6a0d4667585ca595f438c7293e5ced7c4
	Fixed in 4.19.257 with commit 7f88cdfea8d7f4dbaf423d808241403b2bb945e4
	Fixed in 5.4.212 with commit 7d9591b32a9092fc6391a316b56e8016c6181c3d
	Fixed in 5.10.141 with commit 8fc778ee2fb2853f7a3531fa7273349640d8e4e9
	Fixed in 5.15.65 with commit 34c3dea1189525cd533071ed5c176fc4ea8d982b
	Fixed in 5.19.7 with commit cb4bb011a683532841344ca7f281b5e04389b4f8
	Fixed in 6.0 with commit 19f953e7435644b81332dd632ba1b2d80b1e37af

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-49978
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/video/fbdev/pm2fb.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/0f1174f4972ea9fad6becf8881d71adca8e9ca91
	https://git.kernel.org/stable/c/3ec326a6a0d4667585ca595f438c7293e5ced7c4
	https://git.kernel.org/stable/c/7f88cdfea8d7f4dbaf423d808241403b2bb945e4
	https://git.kernel.org/stable/c/7d9591b32a9092fc6391a316b56e8016c6181c3d
	https://git.kernel.org/stable/c/8fc778ee2fb2853f7a3531fa7273349640d8e4e9
	https://git.kernel.org/stable/c/34c3dea1189525cd533071ed5c176fc4ea8d982b
	https://git.kernel.org/stable/c/cb4bb011a683532841344ca7f281b5e04389b4f8
	https://git.kernel.org/stable/c/19f953e7435644b81332dd632ba1b2d80b1e37af
