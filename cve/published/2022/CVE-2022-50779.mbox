From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50779: orangefs: Fix kmemleak in orangefs_prepare_debugfs_help_string()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

orangefs: Fix kmemleak in orangefs_prepare_debugfs_help_string()

When insert and remove the orangefs module, then debug_help_string will
be leaked:

  unreferenced object 0xffff8881652ba000 (size 4096):
    comm "insmod", pid 1701, jiffies 4294893639 (age 13218.530s)
    hex dump (first 32 bytes):
      43 6c 69 65 6e 74 20 44 65 62 75 67 20 4b 65 79  Client Debug Key
      77 6f 72 64 73 20 61 72 65 20 75 6e 6b 6e 6f 77  words are unknow
    backtrace:
      [<0000000004e6f8e3>] kmalloc_trace+0x27/0xa0
      [<0000000006f75d85>] orangefs_prepare_debugfs_help_string+0x5e/0x480 [orangefs]
      [<0000000091270a2a>] _sub_I_65535_1+0x57/0xf70 [crc_itu_t]
      [<000000004b1ee1a3>] do_one_initcall+0x87/0x2a0
      [<000000001d0614ae>] do_init_module+0xdf/0x320
      [<00000000efef068c>] load_module+0x2f98/0x3330
      [<000000006533b44d>] __do_sys_finit_module+0x113/0x1b0
      [<00000000a0da6f99>] do_syscall_64+0x35/0x80
      [<000000007790b19b>] entry_SYSCALL_64_after_hwframe+0x46/0xb0

When remove the module, should always free debug_help_string. Should
always free the allocated buffer when change the free_debug_help_string.

The Linux kernel CVE team has assigned CVE-2022-50779 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.9 with commit dc0336214eb07ee9de2a41dd4c81c744ffa419ac and fixed in 4.9.337 with commit 44d3eac26a5e5268d11cc342dc202b0d31505c0a
	Issue introduced in 4.9 with commit dc0336214eb07ee9de2a41dd4c81c744ffa419ac and fixed in 4.14.303 with commit f2b8a6aac561a49fe02c99683c40a8b87a9f68fc
	Issue introduced in 4.9 with commit dc0336214eb07ee9de2a41dd4c81c744ffa419ac and fixed in 4.19.270 with commit ba9d3b9cec20957fd86bb1bf525b4ea8b64b2dea
	Issue introduced in 4.9 with commit dc0336214eb07ee9de2a41dd4c81c744ffa419ac and fixed in 5.4.229 with commit 2e7c09121064df93c58bbc49d3d0f608d3f584bd
	Issue introduced in 4.9 with commit dc0336214eb07ee9de2a41dd4c81c744ffa419ac and fixed in 5.10.163 with commit b8affa0c6405ee968dcb6030bee2cf719a464752
	Issue introduced in 4.9 with commit dc0336214eb07ee9de2a41dd4c81c744ffa419ac and fixed in 5.15.86 with commit 39529b79b023713d4f2d3479dc0ca43ba99df726
	Issue introduced in 4.9 with commit dc0336214eb07ee9de2a41dd4c81c744ffa419ac and fixed in 6.0.16 with commit 3fc221d9a16339a913a0341d3efc7fef339073e1
	Issue introduced in 4.9 with commit dc0336214eb07ee9de2a41dd4c81c744ffa419ac and fixed in 6.1.2 with commit 19be31668552a198e887762e25bdcc560800ecb4
	Issue introduced in 4.9 with commit dc0336214eb07ee9de2a41dd4c81c744ffa419ac and fixed in 6.2 with commit d23417a5bf3a3afc55de5442eb46e1e60458b0a1

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50779
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/orangefs/orangefs-debugfs.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/44d3eac26a5e5268d11cc342dc202b0d31505c0a
	https://git.kernel.org/stable/c/f2b8a6aac561a49fe02c99683c40a8b87a9f68fc
	https://git.kernel.org/stable/c/ba9d3b9cec20957fd86bb1bf525b4ea8b64b2dea
	https://git.kernel.org/stable/c/2e7c09121064df93c58bbc49d3d0f608d3f584bd
	https://git.kernel.org/stable/c/b8affa0c6405ee968dcb6030bee2cf719a464752
	https://git.kernel.org/stable/c/39529b79b023713d4f2d3479dc0ca43ba99df726
	https://git.kernel.org/stable/c/3fc221d9a16339a913a0341d3efc7fef339073e1
	https://git.kernel.org/stable/c/19be31668552a198e887762e25bdcc560800ecb4
	https://git.kernel.org/stable/c/d23417a5bf3a3afc55de5442eb46e1e60458b0a1
