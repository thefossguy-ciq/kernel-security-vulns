From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50337: ocxl: fix pci device refcount leak when calling get_function_0()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ocxl: fix pci device refcount leak when calling get_function_0()

get_function_0() calls pci_get_domain_bus_and_slot(), as comment
says, it returns a pci device with refcount increment, so after
using it, pci_dev_put() needs be called.

Get the device reference when get_function_0() is not called, so
pci_dev_put() can be called in the error path and callers
unconditionally. And add comment above get_dvsec_vendor0() to tell
callers to call pci_dev_put().

The Linux kernel CVE team has assigned CVE-2022-50337 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.9 with commit 87db7579ebd5ded337056eb765542eb2608f16e3 and fixed in 5.10.163 with commit a40e1b0a922a53fa925ea8b296e3de30a31ed028
	Issue introduced in 5.9 with commit 87db7579ebd5ded337056eb765542eb2608f16e3 and fixed in 5.15.86 with commit 37a13b274e4513c757e50c002ddcbf4bc89adbb2
	Issue introduced in 5.9 with commit 87db7579ebd5ded337056eb765542eb2608f16e3 and fixed in 6.0.16 with commit 9a1b3148975b71fdc194e62612478346bbe618cd
	Issue introduced in 5.9 with commit 87db7579ebd5ded337056eb765542eb2608f16e3 and fixed in 6.1.2 with commit 40ff4c2335a98f0ee96b099bfd70b8e6644f321f
	Issue introduced in 5.9 with commit 87db7579ebd5ded337056eb765542eb2608f16e3 and fixed in 6.2 with commit 27158c72678b39ee01cc01de1aba6b51c71abe2f

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50337
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/misc/ocxl/config.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/a40e1b0a922a53fa925ea8b296e3de30a31ed028
	https://git.kernel.org/stable/c/37a13b274e4513c757e50c002ddcbf4bc89adbb2
	https://git.kernel.org/stable/c/9a1b3148975b71fdc194e62612478346bbe618cd
	https://git.kernel.org/stable/c/40ff4c2335a98f0ee96b099bfd70b8e6644f321f
	https://git.kernel.org/stable/c/27158c72678b39ee01cc01de1aba6b51c71abe2f
