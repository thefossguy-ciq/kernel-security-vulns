From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50577: ima: Fix memory leak in __ima_inode_hash()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ima: Fix memory leak in __ima_inode_hash()

Commit f3cc6b25dcc5 ("ima: always measure and audit files in policy") lets
measurement or audit happen even if the file digest cannot be calculated.

As a result, iint->ima_hash could have been allocated despite
ima_collect_measurement() returning an error.

Since ima_hash belongs to a temporary inode metadata structure, declared
at the beginning of __ima_inode_hash(), just add a kfree() call if
ima_collect_measurement() returns an error different from -ENOMEM (in that
case, ima_hash should not have been allocated).

The Linux kernel CVE team has assigned CVE-2022-50577 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.18 with commit 280fe8367b0dc45b6ac5e04fad03e16e99540c0c and fixed in 6.0.18 with commit c4df8cb38f139ed9f4296868c0a6f15a26e8c491
	Issue introduced in 5.18 with commit 280fe8367b0dc45b6ac5e04fad03e16e99540c0c and fixed in 6.1.4 with commit f375bcf69f58fd0744c9dfd1b6b891a27301d67b
	Issue introduced in 5.18 with commit 280fe8367b0dc45b6ac5e04fad03e16e99540c0c and fixed in 6.2 with commit 8c1d6a050a0f16e0a9d32eaf53b965c77279c6f8

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50577
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	security/integrity/ima/ima_main.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/c4df8cb38f139ed9f4296868c0a6f15a26e8c491
	https://git.kernel.org/stable/c/f375bcf69f58fd0744c9dfd1b6b891a27301d67b
	https://git.kernel.org/stable/c/8c1d6a050a0f16e0a9d32eaf53b965c77279c6f8
