From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-49940: tty: n_gsm: add sanity check for gsm->receive in gsm_receive_buf()
Message-Id: <2025061848-CVE-2022-49940-181b@gregkh>
Content-Length: 2933
Lines: 71
X-Developer-Signature: v=1; a=openpgp-sha256; l=3005;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=gk7+aHXwauHcHXAxgFN4wo4vKOvVQP/PZfuEizs82Mw=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBlBs34esfS20X9ppvhYs+PBPsWNTv2OP/5evMSwOf3eg
 m7jJ3t3d8SyMAgyMciKKbJ82cZzdH/FIUUvQ9vTMHNYmUCGMHBxCsBEtgUxLFj8T28Rn+8UEWHv
 e1rVe/45LC6+lscwP6LsVPKpmvK9UkKvTORa1eUydtVXAQA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

tty: n_gsm: add sanity check for gsm->receive in gsm_receive_buf()

A null pointer dereference can happen when attempting to access the
"gsm->receive()" function in gsmld_receive_buf(). Currently, the code
assumes that gsm->recieve is only called after MUX activation.
Since the gsmld_receive_buf() function can be accessed without the need to
initialize the MUX, the gsm->receive() function will not be set and a
NULL pointer dereference will occur.

Fix this by avoiding the call to "gsm->receive()" in case the function is
not initialized by adding a sanity check.

Call Trace:
 <TASK>
 gsmld_receive_buf+0x1c2/0x2f0 drivers/tty/n_gsm.c:2861
 tiocsti drivers/tty/tty_io.c:2293 [inline]
 tty_ioctl+0xa75/0x15d0 drivers/tty/tty_io.c:2692
 vfs_ioctl fs/ioctl.c:51 [inline]
 __do_sys_ioctl fs/ioctl.c:870 [inline]
 __se_sys_ioctl fs/ioctl.c:856 [inline]
 __x64_sys_ioctl+0x193/0x200 fs/ioctl.c:856
 do_syscall_x64 arch/x86/entry/common.c:50 [inline]
 do_syscall_64+0x35/0xb0 arch/x86/entry/common.c:80
 entry_SYSCALL_64_after_hwframe+0x63/0xcd

The Linux kernel CVE team has assigned CVE-2022-49940 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.15.61 with commit dfa9b6d34aac2154b5e926d7a7a061123bf137c6 and fixed in 5.15.66 with commit 309aea4b6b813f6678c3a547cfd7fe3a76ffa976
	Issue introduced in 5.19.2 with commit 5e59c010c6862da329db17acca086afd8bea1aa8 and fixed in 5.19.8 with commit 5aa37f9510345a812c0998bcbbc4d88d1dcc4d8b
	Issue introduced in 5.18.18 with commit 2dc1be365a70699f7dda92fd9e48b84546086070

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-49940
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/tty/n_gsm.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/5a82cf64f8ad63caf6bf115642ce44ddbc64311e
	https://git.kernel.org/stable/c/309aea4b6b813f6678c3a547cfd7fe3a76ffa976
	https://git.kernel.org/stable/c/5aa37f9510345a812c0998bcbbc4d88d1dcc4d8b
	https://git.kernel.org/stable/c/f16c6d2e58a4c2b972efcf9eb12390ee0ba3befb
