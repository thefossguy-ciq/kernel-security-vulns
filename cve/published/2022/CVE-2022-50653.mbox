From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50653: mmc: atmel-mci: fix return value check of mmc_add_host()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

mmc: atmel-mci: fix return value check of mmc_add_host()

mmc_add_host() may return error, if we ignore its return value,
it will lead two issues:
1. The memory that allocated in mmc_alloc_host() is leaked.
2. In the remove() path, mmc_remove_host() will be called to
   delete device, but it's not added yet, it will lead a kernel
   crash because of null-ptr-deref in device_del().

So fix this by checking the return value and calling mmc_free_host()
in the error path.

The Linux kernel CVE team has assigned CVE-2022-50653 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.27 with commit 7d2be0749a59096a334c94dc48f43294193cb8ed and fixed in 4.19.270 with commit 99a6cdfa2cf05028b52f6d8ee85ccc5f8b71b4a2
	Issue introduced in 2.6.27 with commit 7d2be0749a59096a334c94dc48f43294193cb8ed and fixed in 5.4.229 with commit 6bb26abb92f25e582a0976091a10b539fe3796db
	Issue introduced in 2.6.27 with commit 7d2be0749a59096a334c94dc48f43294193cb8ed and fixed in 5.10.163 with commit 00ac0f5f95920f003cd6ece53cdc759549b69118
	Issue introduced in 2.6.27 with commit 7d2be0749a59096a334c94dc48f43294193cb8ed and fixed in 5.15.86 with commit 1925472dec31ec061d57412b3a65a056ea24f340
	Issue introduced in 2.6.27 with commit 7d2be0749a59096a334c94dc48f43294193cb8ed and fixed in 6.0.16 with commit cc8bb436f3c842a86b9082d97933582120d180e2
	Issue introduced in 2.6.27 with commit 7d2be0749a59096a334c94dc48f43294193cb8ed and fixed in 6.1.2 with commit 85946ceb0fac20ab39cdb85333086daf0291a553
	Issue introduced in 2.6.27 with commit 7d2be0749a59096a334c94dc48f43294193cb8ed and fixed in 6.2 with commit 9e6e8c43726673ca2abcaac87640b9215fd72f4c

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50653
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/mmc/host/atmel-mci.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/99a6cdfa2cf05028b52f6d8ee85ccc5f8b71b4a2
	https://git.kernel.org/stable/c/6bb26abb92f25e582a0976091a10b539fe3796db
	https://git.kernel.org/stable/c/00ac0f5f95920f003cd6ece53cdc759549b69118
	https://git.kernel.org/stable/c/1925472dec31ec061d57412b3a65a056ea24f340
	https://git.kernel.org/stable/c/cc8bb436f3c842a86b9082d97933582120d180e2
	https://git.kernel.org/stable/c/85946ceb0fac20ab39cdb85333086daf0291a553
	https://git.kernel.org/stable/c/9e6e8c43726673ca2abcaac87640b9215fd72f4c
