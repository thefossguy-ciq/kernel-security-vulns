From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50039: stmmac: intel: Add a missing clk_disable_unprepare() call in intel_eth_pci_remove()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

stmmac: intel: Add a missing clk_disable_unprepare() call in intel_eth_pci_remove()

Commit 09f012e64e4b ("stmmac: intel: Fix clock handling on error and remove
paths") removed this clk_disable_unprepare()

This was partly revert by commit ac322f86b56c ("net: stmmac: Fix clock
handling on remove path") which removed this clk_disable_unprepare()
because:
"
   While unloading the dwmac-intel driver, clk_disable_unprepare() is
   being called twice in stmmac_dvr_remove() and
   intel_eth_pci_remove(). This causes kernel panic on the second call.
"

However later on, commit 5ec55823438e8 ("net: stmmac: add clocks management
for gmac driver") has updated stmmac_dvr_remove() which do not call
clk_disable_unprepare() anymore.

So this call should now be called from intel_eth_pci_remove().

The Linux kernel CVE team has assigned CVE-2022-50039 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.10.81 with commit 3afe11be6435e126f1507ddf1a9d0e5a0d90b336 and fixed in 5.10.138 with commit 02f3642d8e657c05f382729c165bed46745dc18c
	Issue introduced in 5.13 with commit 5ec55823438e850c91c6b92aec93fb04ebde29e2 and fixed in 5.15.63 with commit 47129531196054b374017555165b47a43cdb6f41
	Issue introduced in 5.13 with commit 5ec55823438e850c91c6b92aec93fb04ebde29e2 and fixed in 5.19.4 with commit 9400aeb419d35e718e90aa14a97c11229d0a40bc
	Issue introduced in 5.13 with commit 5ec55823438e850c91c6b92aec93fb04ebde29e2 and fixed in 6.0 with commit 5c23d6b717e4e956376f3852b90f58e262946b50

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50039
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/ethernet/stmicro/stmmac/dwmac-intel.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/02f3642d8e657c05f382729c165bed46745dc18c
	https://git.kernel.org/stable/c/47129531196054b374017555165b47a43cdb6f41
	https://git.kernel.org/stable/c/9400aeb419d35e718e90aa14a97c11229d0a40bc
	https://git.kernel.org/stable/c/5c23d6b717e4e956376f3852b90f58e262946b50
