From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-49751: w1: fix WARNING after calling w1_process()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

w1: fix WARNING after calling w1_process()

I got the following WARNING message while removing driver(ds2482):

------------[ cut here ]------------
do not call blocking ops when !TASK_RUNNING; state=1 set at [<000000002d50bfb6>] w1_process+0x9e/0x1d0 [wire]
WARNING: CPU: 0 PID: 262 at kernel/sched/core.c:9817 __might_sleep+0x98/0xa0
CPU: 0 PID: 262 Comm: w1_bus_master1 Tainted: G                 N 6.1.0-rc3+ #307
RIP: 0010:__might_sleep+0x98/0xa0
Call Trace:
 exit_signals+0x6c/0x550
 do_exit+0x2b4/0x17e0
 kthread_exit+0x52/0x60
 kthread+0x16d/0x1e0
 ret_from_fork+0x1f/0x30

The state of task is set to TASK_INTERRUPTIBLE in loop in w1_process(),
set it to TASK_RUNNING when it breaks out of the loop to avoid the
warning.

The Linux kernel CVE team has assigned CVE-2022-49751 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.28 with commit 3c52e4e627896b42152cc6ff98216c302932227e and fixed in 4.14.305 with commit 190b5c3bbd5df685bb1063bda048831d72b8f1d4
	Issue introduced in 2.6.28 with commit 3c52e4e627896b42152cc6ff98216c302932227e and fixed in 4.19.272 with commit bccd6df4c177b1ad766f16565ccc298653d027d0
	Issue introduced in 2.6.28 with commit 3c52e4e627896b42152cc6ff98216c302932227e and fixed in 5.4.231 with commit 276052159ba94d4d9f5b453fb4707d6798c6b845
	Issue introduced in 2.6.28 with commit 3c52e4e627896b42152cc6ff98216c302932227e and fixed in 5.10.166 with commit 216f35db6ec6a667cd9db4838d657c1d2f4684da
	Issue introduced in 2.6.28 with commit 3c52e4e627896b42152cc6ff98216c302932227e and fixed in 5.15.91 with commit 89c62cee5d4d65ac75d99b5f986f7f94290e888f
	Issue introduced in 2.6.28 with commit 3c52e4e627896b42152cc6ff98216c302932227e and fixed in 6.1.9 with commit cfc7462ff824ed6718ed0272ee9aae88e20d469a
	Issue introduced in 2.6.28 with commit 3c52e4e627896b42152cc6ff98216c302932227e and fixed in 6.2 with commit 36225a7c72e9e3e1ce4001b6ce72849f5c9a2d3b

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-49751
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/w1/w1.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/190b5c3bbd5df685bb1063bda048831d72b8f1d4
	https://git.kernel.org/stable/c/bccd6df4c177b1ad766f16565ccc298653d027d0
	https://git.kernel.org/stable/c/276052159ba94d4d9f5b453fb4707d6798c6b845
	https://git.kernel.org/stable/c/216f35db6ec6a667cd9db4838d657c1d2f4684da
	https://git.kernel.org/stable/c/89c62cee5d4d65ac75d99b5f986f7f94290e888f
	https://git.kernel.org/stable/c/cfc7462ff824ed6718ed0272ee9aae88e20d469a
	https://git.kernel.org/stable/c/36225a7c72e9e3e1ce4001b6ce72849f5c9a2d3b
