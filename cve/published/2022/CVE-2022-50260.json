{
   "containers": {
      "cna": {
         "providerMetadata": {
            "orgId": "f4215fc3-5b6b-47ff-a258-f7189bd81038"
         },
         "descriptions": [
            {
               "lang": "en",
               "value": "In the Linux kernel, the following vulnerability has been resolved:\n\ndrm/msm: Make .remove and .shutdown HW shutdown consistent\n\nDrivers' .remove and .shutdown callbacks are executed on different code\npaths. The former is called when a device is removed from the bus, while\nthe latter is called at system shutdown time to quiesce the device.\n\nThis means that some overlap exists between the two, because both have to\ntake care of properly shutting down the hardware. But currently the logic\nused in these two callbacks isn't consistent in msm drivers, which could\nlead to kernel panic.\n\nFor example, on .remove the component is deleted and its .unbind callback\nleads to the hardware being shutdown but only if the DRM device has been\nmarked as registered.\n\nThat check doesn't exist in the .shutdown logic and this can lead to the\ndriver calling drm_atomic_helper_shutdown() for a DRM device that hasn't\nbeen properly initialized.\n\nA situation like this can happen if drivers for expected sub-devices fail\nto probe, since the .bind callback will never be executed. If that is the\ncase, drm_atomic_helper_shutdown() will attempt to take mutexes that are\nonly initialized if drm_mode_config_init() is called during a device bind.\n\nThis bug was attempted to be fixed in commit 623f279c7781 (\"drm/msm: fix\nshutdown hook in case GPU components failed to bind\"), but unfortunately\nit still happens in some cases as the one mentioned above, i.e:\n\n  systemd-shutdown[1]: Powering off.\n  kvm: exiting hardware virtualization\n  platform wifi-firmware.0: Removing from iommu group 12\n  platform video-firmware.0: Removing from iommu group 10\n  ------------[ cut here ]------------\n  WARNING: CPU: 6 PID: 1 at drivers/gpu/drm/drm_modeset_lock.c:317 drm_modeset_lock_all_ctx+0x3c4/0x3d0\n  ...\n  Hardware name: Google CoachZ (rev3+) (DT)\n  pstate: a0400009 (NzCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)\n  pc : drm_modeset_lock_all_ctx+0x3c4/0x3d0\n  lr : drm_modeset_lock_all_ctx+0x48/0x3d0\n  sp : ffff80000805bb80\n  x29: ffff80000805bb80 x28: ffff327c00128000 x27: 0000000000000000\n  x26: 0000000000000000 x25: 0000000000000001 x24: ffffc95d820ec030\n  x23: ffff327c00bbd090 x22: ffffc95d8215eca0 x21: ffff327c039c5800\n  x20: ffff327c039c5988 x19: ffff80000805bbe8 x18: 0000000000000034\n  x17: 000000040044ffff x16: ffffc95d80cac920 x15: 0000000000000000\n  x14: 0000000000000315 x13: 0000000000000315 x12: 0000000000000000\n  x11: 0000000000000000 x10: 0000000000000000 x9 : 0000000000000000\n  x8 : ffff80000805bc28 x7 : 0000000000000000 x6 : 0000000000000000\n  x5 : 0000000000000000 x4 : 0000000000000000 x3 : 0000000000000000\n  x2 : ffff327c00128000 x1 : 0000000000000000 x0 : ffff327c039c59b0\n  Call trace:\n   drm_modeset_lock_all_ctx+0x3c4/0x3d0\n   drm_atomic_helper_shutdown+0x70/0x134\n   msm_drv_shutdown+0x30/0x40\n   platform_shutdown+0x28/0x40\n   device_shutdown+0x148/0x350\n   kernel_power_off+0x38/0x80\n   __do_sys_reboot+0x288/0x2c0\n   __arm64_sys_reboot+0x28/0x34\n   invoke_syscall+0x48/0x114\n   el0_svc_common.constprop.0+0x44/0xec\n   do_el0_svc+0x2c/0xc0\n   el0_svc+0x2c/0x84\n   el0t_64_sync_handler+0x11c/0x150\n   el0t_64_sync+0x18c/0x190\n  ---[ end trace 0000000000000000 ]---\n  Unable to handle kernel NULL pointer dereference at virtual address 0000000000000018\n  Mem abort info:\n    ESR = 0x0000000096000004\n    EC = 0x25: DABT (current EL), IL = 32 bits\n    SET = 0, FnV = 0\n    EA = 0, S1PTW = 0\n    FSC = 0x04: level 0 translation fault\n  Data abort info:\n    ISV = 0, ISS = 0x00000004\n    CM = 0, WnR = 0\n  user pgtable: 4k pages, 48-bit VAs, pgdp=000000010eab1000\n  [0000000000000018] pgd=0000000000000000, p4d=0000000000000000\n  Internal error: Oops: 96000004 [#1] PREEMPT SMP\n  ...\n  Hardware name: Google CoachZ (rev3+) (DT)\n  pstate: a0400009 (NzCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)\n  pc : ww_mutex_lock+0x28/0x32c\n  lr : drm_modeset_lock_all_ctx+0x1b0/0x3d0\n  sp : ffff80000805bb50\n  x29: ffff80000805bb50 x28: ffff327c00128000 x27: 0000000000000000\n  x26: 00000\n---truncated---"
            }
         ],
         "affected": [
            {
               "product": "Linux",
               "vendor": "Linux",
               "defaultStatus": "unaffected",
               "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
               "programFiles": [
                  "drivers/gpu/drm/msm/msm_drv.c"
               ],
               "versions": [
                  {
                     "version": "9d5cbf5fe46e350715389d89d0c350d83289a102",
                     "lessThan": "26f9a766f87b33c50ed400a9500cc1dc9aced953",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "9d5cbf5fe46e350715389d89d0c350d83289a102",
                     "lessThan": "0e6649a2e31ac157c711d583ec8f5ec59da5de0e",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "9d5cbf5fe46e350715389d89d0c350d83289a102",
                     "lessThan": "0a58d2ae572adaec8d046f8d35b40c2c32ac7468",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "3d516e369e3a563e7da39c72b06d78c7f1b09b1e",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "8bc5c9ba5a1d67aaf6957199b2ab8a24402741a9",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "19583b280801b6ba4a36172113db42413860d1c4",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "56ed34ea6cd73c2fd5384d03a9034e6f229a390a",
                     "status": "affected",
                     "versionType": "git"
                  }
               ]
            },
            {
               "product": "Linux",
               "vendor": "Linux",
               "defaultStatus": "affected",
               "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
               "programFiles": [
                  "drivers/gpu/drm/msm/msm_drv.c"
               ],
               "versions": [
                  {
                     "version": "5.9",
                     "status": "affected"
                  },
                  {
                     "version": "0",
                     "lessThan": "5.9",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "5.19.17",
                     "lessThanOrEqual": "5.19.*",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "6.0.3",
                     "lessThanOrEqual": "6.0.*",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "6.1",
                     "lessThanOrEqual": "*",
                     "status": "unaffected",
                     "versionType": "original_commit_for_fix"
                  }
               ]
            }
         ],
         "cpeApplicability": [
            {
               "nodes": [
                  {
                     "operator": "OR",
                     "negate": false,
                     "cpeMatch": [
                        {
                           "vulnerable": true,
                           "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                           "versionStartIncluding": "5.9",
                           "versionEndExcluding": "5.19.17"
                        },
                        {
                           "vulnerable": true,
                           "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                           "versionStartIncluding": "5.9",
                           "versionEndExcluding": "6.0.3"
                        },
                        {
                           "vulnerable": true,
                           "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                           "versionStartIncluding": "5.9",
                           "versionEndExcluding": "6.1"
                        },
                        {
                           "vulnerable": true,
                           "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                           "versionStartIncluding": "4.14.197"
                        },
                        {
                           "vulnerable": true,
                           "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                           "versionStartIncluding": "4.19.144"
                        },
                        {
                           "vulnerable": true,
                           "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                           "versionStartIncluding": "5.4.64"
                        },
                        {
                           "vulnerable": true,
                           "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                           "versionStartIncluding": "5.8.8"
                        }
                     ]
                  }
               ]
            }
         ],
         "references": [
            {
               "url": "https://git.kernel.org/stable/c/26f9a766f87b33c50ed400a9500cc1dc9aced953"
            },
            {
               "url": "https://git.kernel.org/stable/c/0e6649a2e31ac157c711d583ec8f5ec59da5de0e"
            },
            {
               "url": "https://git.kernel.org/stable/c/0a58d2ae572adaec8d046f8d35b40c2c32ac7468"
            }
         ],
         "title": "drm/msm: Make .remove and .shutdown HW shutdown consistent",
         "x_generator": {
            "engine": "bippy-1.2.0"
         }
      }
   },
   "cveMetadata": {
      "assignerOrgId": "f4215fc3-5b6b-47ff-a258-f7189bd81038",
      "cveID": "CVE-2022-50260",
      "requesterUserId": "gregkh@kernel.org",
      "serial": "1",
      "state": "PUBLISHED"
   },
   "dataType": "CVE_RECORD",
   "dataVersion": "5.0"
}
