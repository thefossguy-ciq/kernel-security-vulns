From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50618: mmc: meson-gx: fix return value check of mmc_add_host()
Message-Id: <2025120852-CVE-2022-50618-6be5@gregkh>
Content-Length: 3273
Lines: 65
X-Developer-Signature: v=1; a=openpgp-sha256; l=3339;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=O+ciGFGByRAihhl+2JcoY2xpAkG3z7msdxZMZ9IZKyo=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJlm6ixy9o8PO532PfdzxZ1CNZ9H/5LP7rXY/Xvj34d9d
 7ZtXlvO2xHLwiDIxCArpsjyZRvP0f0VhxS9DG1Pw8xhZQIZwsDFKQAT2XqFYb7H5TVH5S/vLfwQ
 sfvkRfOFyq2f9hozLFjn8brkxfFNhk3aD9TsxPbpLnL81A8A
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

mmc: meson-gx: fix return value check of mmc_add_host()

mmc_add_host() may return error, if we ignore its return value,
it will lead two issues:
1. The memory that allocated in mmc_alloc_host() is leaked.
2. In the remove() path, mmc_remove_host() will be called to
   delete device, but it's not added yet, it will lead a kernel
   crash because of null-ptr-deref in device_del().

Fix this by checking the return value and goto error path which
will call mmc_free_host().

The Linux kernel CVE team has assigned CVE-2022-50618 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.10 with commit 51c5d8447bd71b7e539c19c46a03b73c0e91fa66 and fixed in 4.19.270 with commit f5506e0bbb25102bd8ef2e1a3b483a0b934e454e
	Issue introduced in 4.10 with commit 51c5d8447bd71b7e539c19c46a03b73c0e91fa66 and fixed in 5.4.229 with commit 9e11c6bb745be4e9b325cf96031b4ea34801342d
	Issue introduced in 4.10 with commit 51c5d8447bd71b7e539c19c46a03b73c0e91fa66 and fixed in 5.10.163 with commit 64b2c441171febf075bd9632aca579afda8ab9fb
	Issue introduced in 4.10 with commit 51c5d8447bd71b7e539c19c46a03b73c0e91fa66 and fixed in 5.15.86 with commit e0cfe7aa41f3965f5224affd88afd48c60f6ad1f
	Issue introduced in 4.10 with commit 51c5d8447bd71b7e539c19c46a03b73c0e91fa66 and fixed in 6.0.16 with commit 42343e3c6195e934b9cb4c08b7ff84a3778d77f9
	Issue introduced in 4.10 with commit 51c5d8447bd71b7e539c19c46a03b73c0e91fa66 and fixed in 6.1.2 with commit f5ce76aeddf01ca8f2a80fc37119388d59db7c10
	Issue introduced in 4.10 with commit 51c5d8447bd71b7e539c19c46a03b73c0e91fa66 and fixed in 6.2 with commit 90935f16f2650ab7416fa2ffbe5c28cb39cf3f1e

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50618
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/mmc/host/meson-gx-mmc.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/f5506e0bbb25102bd8ef2e1a3b483a0b934e454e
	https://git.kernel.org/stable/c/9e11c6bb745be4e9b325cf96031b4ea34801342d
	https://git.kernel.org/stable/c/64b2c441171febf075bd9632aca579afda8ab9fb
	https://git.kernel.org/stable/c/e0cfe7aa41f3965f5224affd88afd48c60f6ad1f
	https://git.kernel.org/stable/c/42343e3c6195e934b9cb4c08b7ff84a3778d77f9
	https://git.kernel.org/stable/c/f5ce76aeddf01ca8f2a80fc37119388d59db7c10
	https://git.kernel.org/stable/c/90935f16f2650ab7416fa2ffbe5c28cb39cf3f1e
