From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50474: macintosh: fix possible memory leak in macio_add_one_device()
Message-Id: <2025100437-CVE-2022-50474-7639@gregkh>
Content-Length: 3751
Lines: 68
X-Developer-Signature: v=1; a=openpgp-sha256; l=3820;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=22tt/eSWyB/ij4TMKaUcyrhKd4BNKG9HNKd7uYoIINw=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBkPrUK7T86v0PdpDIrhcj46f/Or0zd5lk86P8tb9NgBI
 dUsrnMXOmJZGASZGGTFFFm+bOM5ur/ikKKXoe1pmDmsTCBDGLg4BWAi52cwzNMLS8tc8lBrivm9
 9ecKnzd5Kdy/p8Awz/Tt3yCmcxXxxzRUDuSoBi/Rlz/8HAA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

macintosh: fix possible memory leak in macio_add_one_device()

Afer commit 1fa5ae857bb1 ("driver core: get rid of struct device's
bus_id string array"), the name of device is allocated dynamically. It
needs to be freed when of_device_register() fails. Call put_device() to
give up the reference that's taken in device_initialize(), so that it
can be freed in kobject_cleanup() when the refcount hits 0.

macio device is freed in macio_release_dev(), so the kfree() can be
removed.

The Linux kernel CVE team has assigned CVE-2022-50474 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.30 with commit 1fa5ae857bb14f6046205171d98506d8112dd74e and fixed in 4.9.337 with commit 3a866ff6fc2232c8e393cdb55ffb8ce947349e03
	Issue introduced in 2.6.30 with commit 1fa5ae857bb14f6046205171d98506d8112dd74e and fixed in 4.14.303 with commit aa9054267366ff0a382d403d17728e21951ddbb9
	Issue introduced in 2.6.30 with commit 1fa5ae857bb14f6046205171d98506d8112dd74e and fixed in 4.19.270 with commit 35858b87a943917fa30172aa4bf01ce7adbcb42c
	Issue introduced in 2.6.30 with commit 1fa5ae857bb14f6046205171d98506d8112dd74e and fixed in 5.4.229 with commit b29a2f1dd33ae9b94821ab2f4d398b9081786748
	Issue introduced in 2.6.30 with commit 1fa5ae857bb14f6046205171d98506d8112dd74e and fixed in 5.10.163 with commit 2ac0a7059b7bcbed35bfffa34a82c9a9e99638ef
	Issue introduced in 2.6.30 with commit 1fa5ae857bb14f6046205171d98506d8112dd74e and fixed in 5.15.86 with commit 19ded60b40e86b0903c8d5bd0161437ed5107a8b
	Issue introduced in 2.6.30 with commit 1fa5ae857bb14f6046205171d98506d8112dd74e and fixed in 6.0.16 with commit ca765257feb89dacf604ced9cd233db5f865dee0
	Issue introduced in 2.6.30 with commit 1fa5ae857bb14f6046205171d98506d8112dd74e and fixed in 6.1.2 with commit 76837e7f6b30da72ad59f56291e22804a219e015
	Issue introduced in 2.6.30 with commit 1fa5ae857bb14f6046205171d98506d8112dd74e and fixed in 6.2 with commit 5ca86eae55a2f006e6c1edd2029b2cacb6979515

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50474
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/macintosh/macio_asic.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/3a866ff6fc2232c8e393cdb55ffb8ce947349e03
	https://git.kernel.org/stable/c/aa9054267366ff0a382d403d17728e21951ddbb9
	https://git.kernel.org/stable/c/35858b87a943917fa30172aa4bf01ce7adbcb42c
	https://git.kernel.org/stable/c/b29a2f1dd33ae9b94821ab2f4d398b9081786748
	https://git.kernel.org/stable/c/2ac0a7059b7bcbed35bfffa34a82c9a9e99638ef
	https://git.kernel.org/stable/c/19ded60b40e86b0903c8d5bd0161437ed5107a8b
	https://git.kernel.org/stable/c/ca765257feb89dacf604ced9cd233db5f865dee0
	https://git.kernel.org/stable/c/76837e7f6b30da72ad59f56291e22804a219e015
	https://git.kernel.org/stable/c/5ca86eae55a2f006e6c1edd2029b2cacb6979515
