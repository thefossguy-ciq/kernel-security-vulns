From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50366: powercap: intel_rapl: fix UBSAN shift-out-of-bounds issue
Message-Id: <2025091716-CVE-2022-50366-0f75@gregkh>
Content-Length: 2939
Lines: 70
X-Developer-Signature: v=1; a=openpgp-sha256; l=3010;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=vFpOXc408MVyO6fgkU8I58PuRNPGQW0zG9QiIDNCl1Y=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBmnzgjsN/dMeaF3+MAe/pzyN448s+948/+yODknaXlHw
 ZQTPq77OmJZGASZGGTFFFm+bOM5ur/ikKKXoe1pmDmsTCBDGLg4BWAi+nkMC6b5Tlta1bU4I/6K
 ruqPGdMVCqPlTzPMFb1ksT67ucbxkF387HsHk2NaPy9MAQA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

powercap: intel_rapl: fix UBSAN shift-out-of-bounds issue

When value < time_unit, the parameter of ilog2() will be zero and
the return value is -1. u64(-1) is too large for shift exponent
and then will trigger shift-out-of-bounds:

shift exponent 18446744073709551615 is too large for 32-bit type 'int'
Call Trace:
 rapl_compute_time_window_core
 rapl_write_data_raw
 set_time_window
 store_constraint_time_window_us

The Linux kernel CVE team has assigned CVE-2022-50366 to this issue.


Affected and fixed versions
===========================

	Fixed in 4.9.331 with commit 42f79dbb9514f726ff21df25f09cb0693b0b2445
	Fixed in 4.14.296 with commit 3eb0ba70376f6ee40fa843fc9cee49269370b0b3
	Fixed in 4.19.262 with commit 4ebba43384722adbd325baec3a12c572d94488eb
	Fixed in 5.4.220 with commit 49a6ffdaed60f0eb52c198fafebc05994e16e305
	Fixed in 5.10.150 with commit 708b9abe1b4a2f050a483db4b7edfc446b13df1f
	Fixed in 5.15.75 with commit 139bbbd01114433b80fe59f5e1330615aadf9752
	Fixed in 5.19.17 with commit 6216b685b8f48ab7b721a6fd5acbf526b41c13e8
	Fixed in 6.0.3 with commit 1d94af37565e4d3c26b0d63428e093a37d5b4c32
	Fixed in 6.1 with commit 2d93540014387d1c73b9ccc4d7895320df66d01b

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50366
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/powercap/intel_rapl_common.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/42f79dbb9514f726ff21df25f09cb0693b0b2445
	https://git.kernel.org/stable/c/3eb0ba70376f6ee40fa843fc9cee49269370b0b3
	https://git.kernel.org/stable/c/4ebba43384722adbd325baec3a12c572d94488eb
	https://git.kernel.org/stable/c/49a6ffdaed60f0eb52c198fafebc05994e16e305
	https://git.kernel.org/stable/c/708b9abe1b4a2f050a483db4b7edfc446b13df1f
	https://git.kernel.org/stable/c/139bbbd01114433b80fe59f5e1330615aadf9752
	https://git.kernel.org/stable/c/6216b685b8f48ab7b721a6fd5acbf526b41c13e8
	https://git.kernel.org/stable/c/1d94af37565e4d3c26b0d63428e093a37d5b4c32
	https://git.kernel.org/stable/c/2d93540014387d1c73b9ccc4d7895320df66d01b
