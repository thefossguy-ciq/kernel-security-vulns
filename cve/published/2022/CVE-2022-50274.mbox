From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50274: media: dvbdev: adopts refcnt to avoid UAF

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

media: dvbdev: adopts refcnt to avoid UAF

dvb_unregister_device() is known that prone to use-after-free.
That is, the cleanup from dvb_unregister_device() releases the dvb_device
even if there are pointers stored in file->private_data still refer to it.

This patch adds a reference counter into struct dvb_device and delays its
deallocation until no pointer refers to the object.

The Linux kernel CVE team has assigned CVE-2022-50274 to this issue.


Affected and fixed versions
===========================

	Fixed in 4.14.303 with commit ac521bbe3d00fa574e66a9361763f2b37725bc97
	Fixed in 4.19.270 with commit 219b44bf94203bd433aa91b7796475bf656348e5
	Fixed in 5.4.229 with commit 6d18b44bb44e1f4d97dfe0efe92ac0f0984739c2
	Fixed in 5.10.163 with commit 2abd73433872194bccdf1432a0980e4ec5273c2a
	Fixed in 5.15.86 with commit 88a6f8a72d167294c0931c7874941bf37a41b6dd
	Fixed in 6.0.16 with commit a2f0a08aa613176c9688c81d7b598a7779974991
	Fixed in 6.1.2 with commit 9945d05d6693710574f354c5dbddc47f5101eb77
	Fixed in 6.2 with commit 0fc044b2b5e2d05a1fa1fb0d7f270367a7855d79

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50274
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/media/dvb-core/dvb_ca_en50221.c
	drivers/media/dvb-core/dvb_frontend.c
	drivers/media/dvb-core/dvbdev.c
	include/media/dvbdev.h


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/ac521bbe3d00fa574e66a9361763f2b37725bc97
	https://git.kernel.org/stable/c/219b44bf94203bd433aa91b7796475bf656348e5
	https://git.kernel.org/stable/c/6d18b44bb44e1f4d97dfe0efe92ac0f0984739c2
	https://git.kernel.org/stable/c/2abd73433872194bccdf1432a0980e4ec5273c2a
	https://git.kernel.org/stable/c/88a6f8a72d167294c0931c7874941bf37a41b6dd
	https://git.kernel.org/stable/c/a2f0a08aa613176c9688c81d7b598a7779974991
	https://git.kernel.org/stable/c/9945d05d6693710574f354c5dbddc47f5101eb77
	https://git.kernel.org/stable/c/0fc044b2b5e2d05a1fa1fb0d7f270367a7855d79
