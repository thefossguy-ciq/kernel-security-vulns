From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50423: ACPICA: Fix use-after-free in acpi_ut_copy_ipackage_to_ipackage()
Message-Id: <2025100155-CVE-2022-50423-5a66@gregkh>
Content-Length: 4948
Lines: 95
X-Developer-Signature: v=1; a=openpgp-sha256; l=5044;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=za0rUXIrBjs00ewl9bfzLRVlRGud29uA6lRefafJCkk=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBl3hZsTfn1JZ9oWoWT05LPCtmlvJql9f3Ft5RLLzmfrV
 gesPBk2uyOWhUGQiUFWTJHlyzaeo/srDil6GdqehpnDygQyhIGLUwAmsjuWYcH6h6f/uOZl/Vy+
 qZ73SO4dtw28sY8Y5qle5DWete6w8puLy/KiL7WwrAnn2wUA
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ACPICA: Fix use-after-free in acpi_ut_copy_ipackage_to_ipackage()

There is an use-after-free reported by KASAN:

  BUG: KASAN: use-after-free in acpi_ut_remove_reference+0x3b/0x82
  Read of size 1 at addr ffff888112afc460 by task modprobe/2111
  CPU: 0 PID: 2111 Comm: modprobe Not tainted 6.1.0-rc7-dirty
  Hardware name: QEMU Standard PC (i440FX + PIIX, 1996),
  Call Trace:
   <TASK>
   kasan_report+0xae/0xe0
   acpi_ut_remove_reference+0x3b/0x82
   acpi_ut_copy_iobject_to_iobject+0x3be/0x3d5
   acpi_ds_store_object_to_local+0x15d/0x3a0
   acpi_ex_store+0x78d/0x7fd
   acpi_ex_opcode_1A_1T_1R+0xbe4/0xf9b
   acpi_ps_parse_aml+0x217/0x8d5
   ...
   </TASK>

The root cause of the problem is that the acpi_operand_object
is freed when acpi_ut_walk_package_tree() fails in
acpi_ut_copy_ipackage_to_ipackage(), lead to repeated release in
acpi_ut_copy_iobject_to_iobject(). The problem was introduced
by "8aa5e56eeb61" commit, this commit is to fix memory leak in
acpi_ut_copy_iobject_to_iobject(), repeatedly adding remove
operation, lead to "acpi_operand_object" used after free.

Fix it by removing acpi_ut_remove_reference() in
acpi_ut_copy_ipackage_to_ipackage(). acpi_ut_copy_ipackage_to_ipackage()
is called to copy an internal package object into another internal
package object, when it fails, the memory of acpi_operand_object
should be freed by the caller.

The Linux kernel CVE team has assigned CVE-2022-50423 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.17 with commit 8aa5e56eeb61a099ea6519eb30ee399e1bc043ce and fixed in 4.9.337 with commit 133462d35dae95edb944af86b986d4c9dec59bd1
	Issue introduced in 3.17 with commit 8aa5e56eeb61a099ea6519eb30ee399e1bc043ce and fixed in 4.14.303 with commit 02f237423c9c6a18e062de2d474f85d5659e4eb9
	Issue introduced in 3.17 with commit 8aa5e56eeb61a099ea6519eb30ee399e1bc043ce and fixed in 4.19.270 with commit c9125b643fc51b8e662f2f614096ceb45a0adbc3
	Issue introduced in 3.17 with commit 8aa5e56eeb61a099ea6519eb30ee399e1bc043ce and fixed in 5.4.229 with commit dfdde4d5138bc023897033a5ac653a84e94805be
	Issue introduced in 3.17 with commit 8aa5e56eeb61a099ea6519eb30ee399e1bc043ce and fixed in 5.10.163 with commit 02617006b5a46f2ea55ac61f5693c7afd7bf9276
	Issue introduced in 3.17 with commit 8aa5e56eeb61a099ea6519eb30ee399e1bc043ce and fixed in 5.15.86 with commit 6fde666278f91b85d71545a0ebbf41d8d7af8074
	Issue introduced in 3.17 with commit 8aa5e56eeb61a099ea6519eb30ee399e1bc043ce and fixed in 6.0.16 with commit f51b2235e4f320edc839c3e5cb0d1f8a6e8657c6
	Issue introduced in 3.17 with commit 8aa5e56eeb61a099ea6519eb30ee399e1bc043ce and fixed in 6.1.2 with commit 01f2c2052ea50fb9a8ce12e4e83aed0267934ef0
	Issue introduced in 3.17 with commit 8aa5e56eeb61a099ea6519eb30ee399e1bc043ce and fixed in 6.2 with commit 470188b09e92d83c5a997f25f0e8fb8cd2bc3469
	Issue introduced in 3.10.55 with commit b3e98f0c4f996cd53b80bad71f0d7e4a2cf3a4e8
	Issue introduced in 3.12.29 with commit 7af5504c102a378376101dbd160246b10a814dd0
	Issue introduced in 3.14.19 with commit e29a15484d7ea949e49ae7fb7e576a575da824a6
	Issue introduced in 3.16.3 with commit e2ab6731a36966d042a2d4dabd980496cd680f75

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50423
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/acpi/acpica/utcopy.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/133462d35dae95edb944af86b986d4c9dec59bd1
	https://git.kernel.org/stable/c/02f237423c9c6a18e062de2d474f85d5659e4eb9
	https://git.kernel.org/stable/c/c9125b643fc51b8e662f2f614096ceb45a0adbc3
	https://git.kernel.org/stable/c/dfdde4d5138bc023897033a5ac653a84e94805be
	https://git.kernel.org/stable/c/02617006b5a46f2ea55ac61f5693c7afd7bf9276
	https://git.kernel.org/stable/c/6fde666278f91b85d71545a0ebbf41d8d7af8074
	https://git.kernel.org/stable/c/f51b2235e4f320edc839c3e5cb0d1f8a6e8657c6
	https://git.kernel.org/stable/c/01f2c2052ea50fb9a8ce12e4e83aed0267934ef0
	https://git.kernel.org/stable/c/470188b09e92d83c5a997f25f0e8fb8cd2bc3469
