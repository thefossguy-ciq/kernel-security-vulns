From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50077: apparmor: fix reference count leak in aa_pivotroot()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

apparmor: fix reference count leak in aa_pivotroot()

The aa_pivotroot() function has a reference counting bug in a specific
path. When aa_replace_current_label() returns on success, the function
forgets to decrement the reference count of “target”, which is
increased earlier by build_pivotroot(), causing a reference leak.

Fix it by decreasing the refcount of “target” in that path.

The Linux kernel CVE team has assigned CVE-2022-50077 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.14 with commit 2ea3ffb7782a84da33a8382f13ebd016da50079b and fixed in 4.14.291 with commit d53194707d2a1851be027cd74266b96ceff799d3
	Issue introduced in 4.14 with commit 2ea3ffb7782a84da33a8382f13ebd016da50079b and fixed in 4.19.256 with commit f4d5c7796571624e3f380b447ada52834270a287
	Issue introduced in 4.14 with commit 2ea3ffb7782a84da33a8382f13ebd016da50079b and fixed in 5.4.211 with commit ef6fb6f0d0d8440595b45a7e53c6162c737177f4
	Issue introduced in 4.14 with commit 2ea3ffb7782a84da33a8382f13ebd016da50079b and fixed in 5.10.138 with commit 2ceeb3296e9dde1d5772348046affcefdea605e2
	Issue introduced in 4.14 with commit 2ea3ffb7782a84da33a8382f13ebd016da50079b and fixed in 5.15.63 with commit 64103ea357734b82384c925cba4758fdb909be0c
	Issue introduced in 4.14 with commit 2ea3ffb7782a84da33a8382f13ebd016da50079b and fixed in 5.19.4 with commit 3ca40ad7afae144169a43988ef1a3f16182faf0a
	Issue introduced in 4.14 with commit 2ea3ffb7782a84da33a8382f13ebd016da50079b and fixed in 6.0 with commit 11c3627ec6b56c1525013f336f41b79a983b4d46

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50077
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	security/apparmor/mount.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d53194707d2a1851be027cd74266b96ceff799d3
	https://git.kernel.org/stable/c/f4d5c7796571624e3f380b447ada52834270a287
	https://git.kernel.org/stable/c/ef6fb6f0d0d8440595b45a7e53c6162c737177f4
	https://git.kernel.org/stable/c/2ceeb3296e9dde1d5772348046affcefdea605e2
	https://git.kernel.org/stable/c/64103ea357734b82384c925cba4758fdb909be0c
	https://git.kernel.org/stable/c/3ca40ad7afae144169a43988ef1a3f16182faf0a
	https://git.kernel.org/stable/c/11c3627ec6b56c1525013f336f41b79a983b4d46
