From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50043: net: fix potential refcount leak in ndisc_router_discovery()
Message-Id: <2025061843-CVE-2022-50043-e7dc@gregkh>
Content-Length: 2473
Lines: 57
X-Developer-Signature: v=1; a=openpgp-sha256; l=2531;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=OAdKc9SaE2vqpktGJ1SrbpcCs3Hk68Z6216UwzzQbAM=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBlBc6KnKbzcarD6u9W5I2YvLX53X/uyymzViXivPtX1d
 +0q4v03d8SyMAgyMciKKbJ82cZzdH/FIUUvQ9vTMHNYmUCGMHBxCsBEPjQyzI+vMzx/mF/37bvf
 q0/Y+hocFq/a9IJhwcE17Pe+ZFx18lRb1PX61GP5jK/nTwIA
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net: fix potential refcount leak in ndisc_router_discovery()

The issue happens on specific paths in the function. After both the
object `rt` and `neigh` are grabbed successfully, when `lifetime` is
nonzero but the metric needs change, the function just deletes the
route and set `rt` to NULL. Then, it may try grabbing `rt` and `neigh`
again if above conditions hold. The function simply overwrite `neigh`
if succeeds or returns if fails, without decreasing the reference
count of previous `neigh`. This may result in memory leaks.

Fix it by decrementing the reference count of `neigh` in place.

The Linux kernel CVE team has assigned CVE-2022-50043 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.12 with commit 6b2e04bc240fe9be9e690059f710e9f95346d34d and fixed in 5.15.63 with commit ffb15594433391fd7885eb88ce5a7f7bdeefbb15
	Issue introduced in 5.12 with commit 6b2e04bc240fe9be9e690059f710e9f95346d34d and fixed in 5.19.4 with commit 7998043d31d000c3a93f46182e6569dd0eecda34
	Issue introduced in 5.12 with commit 6b2e04bc240fe9be9e690059f710e9f95346d34d and fixed in 6.0 with commit 7396ba87f1edf549284869451665c7c4e74ecd4f

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50043
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/ipv6/ndisc.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/ffb15594433391fd7885eb88ce5a7f7bdeefbb15
	https://git.kernel.org/stable/c/7998043d31d000c3a93f46182e6569dd0eecda34
	https://git.kernel.org/stable/c/7396ba87f1edf549284869451665c7c4e74ecd4f
