From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50868: hwrng: amd - Fix PCI device refcount leak

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

hwrng: amd - Fix PCI device refcount leak

for_each_pci_dev() is implemented by pci_get_device(). The comment of
pci_get_device() says that it will increase the reference count for the
returned pci_dev and also decrease the reference count for the input
pci_dev @from if it is not NULL.

If we break for_each_pci_dev() loop with pdev not NULL, we need to call
pci_dev_put() to decrease the reference count. Add the missing
pci_dev_put() for the normal and error path.

The Linux kernel CVE team has assigned CVE-2022-50868 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.18 with commit 96d63c0297ccfd6d9059c614b3f5555d9441a2b3 and fixed in 4.9.337 with commit f1c97f72ffd504f49882774e2ab689d982dc7afc
	Issue introduced in 2.6.18 with commit 96d63c0297ccfd6d9059c614b3f5555d9441a2b3 and fixed in 4.14.303 with commit 526c316948819d3ecd2bb20fe5e2580c51a1b760
	Issue introduced in 2.6.18 with commit 96d63c0297ccfd6d9059c614b3f5555d9441a2b3 and fixed in 4.19.270 with commit e246f5eff26055bdcb61a2cc99c50af72a19680f
	Issue introduced in 2.6.18 with commit 96d63c0297ccfd6d9059c614b3f5555d9441a2b3 and fixed in 5.4.229 with commit 1199f8e02941b326c60ab71a63002b7c80e38212
	Issue introduced in 2.6.18 with commit 96d63c0297ccfd6d9059c614b3f5555d9441a2b3 and fixed in 5.10.163 with commit 5998e5c30e839f73e62cb29e0d9617b0d16ccba3
	Issue introduced in 2.6.18 with commit 96d63c0297ccfd6d9059c614b3f5555d9441a2b3 and fixed in 5.15.86 with commit 2b79a5e560779b35e1164d57ae35c48b43373082
	Issue introduced in 2.6.18 with commit 96d63c0297ccfd6d9059c614b3f5555d9441a2b3 and fixed in 6.0.16 with commit cb348c7908631dd9f60083a0a1542eab055d3edf
	Issue introduced in 2.6.18 with commit 96d63c0297ccfd6d9059c614b3f5555d9441a2b3 and fixed in 6.1.2 with commit 2e10ecd012ae2b2a374b34f307e9bc1e6096c03d
	Issue introduced in 2.6.18 with commit 96d63c0297ccfd6d9059c614b3f5555d9441a2b3 and fixed in 6.2 with commit ecadb5b0111ea19fc7c240bb25d424a94471eb7d

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50868
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/char/hw_random/amd-rng.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/f1c97f72ffd504f49882774e2ab689d982dc7afc
	https://git.kernel.org/stable/c/526c316948819d3ecd2bb20fe5e2580c51a1b760
	https://git.kernel.org/stable/c/e246f5eff26055bdcb61a2cc99c50af72a19680f
	https://git.kernel.org/stable/c/1199f8e02941b326c60ab71a63002b7c80e38212
	https://git.kernel.org/stable/c/5998e5c30e839f73e62cb29e0d9617b0d16ccba3
	https://git.kernel.org/stable/c/2b79a5e560779b35e1164d57ae35c48b43373082
	https://git.kernel.org/stable/c/cb348c7908631dd9f60083a0a1542eab055d3edf
	https://git.kernel.org/stable/c/2e10ecd012ae2b2a374b34f307e9bc1e6096c03d
	https://git.kernel.org/stable/c/ecadb5b0111ea19fc7c240bb25d424a94471eb7d
