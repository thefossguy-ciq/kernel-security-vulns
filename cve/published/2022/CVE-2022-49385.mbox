From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-49385: driver: base: fix UAF when driver_attach failed
Message-Id: <2025022648-CVE-2022-49385-258c@gregkh>
Content-Length: 2783
Lines: 58
X-Developer-Signature: v=1; a=openpgp-sha256; l=2842;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=UlisebreoEkJnZlHQuIOROh7z1j7H5eRdIlxXzSHhsM=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDOn7yt8kKlrYOOedWx1n/SC0aFFL5dPGjvR6SR2VCy+Dz
 k8vblzbEcvCIMjEICumyPJlG8/R/RWHFL0MbU/DzGFlAhnCwMUpABNJns8wv/ygzpPZCe55HRxu
 8zWKnny9YL1bk2HByX2rek5H5Ra4ya58Pes0n4Ixq+d5AA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

driver: base: fix UAF when driver_attach failed

When driver_attach(drv); failed, the driver_private will be freed.
But it has been added to the bus, which caused a UAF.

To fix it, we need to delete it from the bus when failed.

The Linux kernel CVE team has assigned CVE-2022-49385 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.9 with commit 190888ac01d059e38ffe77a2291d44cafa9016fb and fixed in 5.4.198 with commit 5d709f58c743166fe1c6914b9de0ae8868600d9b
	Issue introduced in 3.9 with commit 190888ac01d059e38ffe77a2291d44cafa9016fb and fixed in 5.10.122 with commit 823f24f2e329babd0330200d0b74882516fe57f4
	Issue introduced in 3.9 with commit 190888ac01d059e38ffe77a2291d44cafa9016fb and fixed in 5.15.47 with commit cdf1a683a01583bca4b618dd16223cbd6e462e21
	Issue introduced in 3.9 with commit 190888ac01d059e38ffe77a2291d44cafa9016fb and fixed in 5.17.15 with commit 5389101257828d1913d713d9a40acbe14f5961df
	Issue introduced in 3.9 with commit 190888ac01d059e38ffe77a2291d44cafa9016fb and fixed in 5.18.4 with commit c059665c84feab46b7173d3a1bf36c2fb7f9df86
	Issue introduced in 3.9 with commit 190888ac01d059e38ffe77a2291d44cafa9016fb and fixed in 5.19 with commit 310862e574001a97ad02272bac0fd13f75f42a27

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-49385
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/base/bus.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/5d709f58c743166fe1c6914b9de0ae8868600d9b
	https://git.kernel.org/stable/c/823f24f2e329babd0330200d0b74882516fe57f4
	https://git.kernel.org/stable/c/cdf1a683a01583bca4b618dd16223cbd6e462e21
	https://git.kernel.org/stable/c/5389101257828d1913d713d9a40acbe14f5961df
	https://git.kernel.org/stable/c/c059665c84feab46b7173d3a1bf36c2fb7f9df86
	https://git.kernel.org/stable/c/310862e574001a97ad02272bac0fd13f75f42a27
