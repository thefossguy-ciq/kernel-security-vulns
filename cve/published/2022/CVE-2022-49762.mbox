From bippy-1.1.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-49762: ntfs: check overflow when iterating ATTR_RECORDs
Message-Id: <2025050112-CVE-2022-49762-216f@gregkh>
Content-Length: 3035
Lines: 70
X-Developer-Signature: v=1; a=openpgp-sha256; l=3106;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=2ld+XnYvG9pySB2bjg7eUyEiWkQJoM/K2qqHTgInmF4=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBnCDR1T/050CJsslvvwkLf/ulTdFbIJa9+cLSibHnZ0v
 sOxgoKIjlgWBkEmBlkxRZYv23iO7q84pOhlaHsaZg4rE8gQBi5OAZiIlxXDgr0yy3gnbY3Uifvl
 l3alo/qigGveY4YFm/4WMM605GWYMXs+f63VzJdV8z/+AwA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ntfs: check overflow when iterating ATTR_RECORDs

Kernel iterates over ATTR_RECORDs in mft record in ntfs_attr_find(). 
Because the ATTR_RECORDs are next to each other, kernel can get the next
ATTR_RECORD from end address of current ATTR_RECORD, through current
ATTR_RECORD length field.

The problem is that during iteration, when kernel calculates the end
address of current ATTR_RECORD, kernel may trigger an integer overflow bug
in executing `a = (ATTR_RECORD*)((u8*)a + le32_to_cpu(a->length))`.  This
may wrap, leading to a forever iteration on 32bit systems.

This patch solves it by adding some checks on calculating end address
of current ATTR_RECORD during iteration.

The Linux kernel CVE team has assigned CVE-2022-49762 to this issue.


Affected and fixed versions
===========================

	Fixed in 4.9.334 with commit 5559eb5809353a83a40a1e4e7f066431c7b83020
	Fixed in 4.14.300 with commit 86f36de14dce5802856bb7a5921d74439db00b64
	Fixed in 4.19.267 with commit 45683723f6b53e39e8a4cec0894e61fd6ec71989
	Fixed in 5.4.225 with commit b612f924f296408d7d02fb4cd01218afd4ed7184
	Fixed in 5.10.156 with commit 957732a09c3828267c2819d31c425aa793dd475b
	Fixed in 5.15.80 with commit b63ddb3ba61e2d3539f87e095c881e552bc45dab
	Fixed in 6.0.10 with commit 785b2af9654b8beac55644e36da0085c5d776361
	Fixed in 6.1 with commit 63095f4f3af59322bea984a6ae44337439348fe0

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-49762
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/ntfs/attrib.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/5559eb5809353a83a40a1e4e7f066431c7b83020
	https://git.kernel.org/stable/c/86f36de14dce5802856bb7a5921d74439db00b64
	https://git.kernel.org/stable/c/45683723f6b53e39e8a4cec0894e61fd6ec71989
	https://git.kernel.org/stable/c/b612f924f296408d7d02fb4cd01218afd4ed7184
	https://git.kernel.org/stable/c/957732a09c3828267c2819d31c425aa793dd475b
	https://git.kernel.org/stable/c/b63ddb3ba61e2d3539f87e095c881e552bc45dab
	https://git.kernel.org/stable/c/785b2af9654b8beac55644e36da0085c5d776361
	https://git.kernel.org/stable/c/63095f4f3af59322bea984a6ae44337439348fe0
