From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50670: mmc: omap_hsmmc: fix return value check of mmc_add_host()
Message-Id: <2025120946-CVE-2022-50670-feb4@gregkh>
Content-Length: 3057
Lines: 63
X-Developer-Signature: v=1; a=openpgp-sha256; l=3121;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=0urwVc4TR5e5h2CAERxth5RQnmjRsH1ZG6fWwPNuOXI=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJnm1cdOmiTMXLP08acIyZ6gSfteT/nwLm6Zs+K07puVI
 RImP/UXdMSyMAgyMciKKbJ82cZzdH/FIUUvQ9vTMHNYmUCGMHBxCsBEnP8wzI/e+/DY3Yq9v3UF
 pj2qXHY/5aPG26kMC5Zelp5wdLKKhmrPzJ8HbdzvHlkpPhsA
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

mmc: omap_hsmmc: fix return value check of mmc_add_host()

mmc_add_host() may return error, if we ignore its return value,
it will lead two issues:
1. The memory that allocated in mmc_alloc_host() is leaked.
2. In the remove() path, mmc_remove_host() will be called to
   delete device, but it's not added yet, it will lead a kernel
   crash because of null-ptr-deref in device_del().

Fix this by checking the return value and goto error path wihch
will call mmc_free_host().

The Linux kernel CVE team has assigned CVE-2022-50670 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.29 with commit a45c6cb816474cefe56059fce422a9bdcd77e0dc and fixed in 5.4.229 with commit f153c9e15f8961bdf38707853e15b42ea7c691d9
	Issue introduced in 2.6.29 with commit a45c6cb816474cefe56059fce422a9bdcd77e0dc and fixed in 5.10.163 with commit fb3d596267a98813a7a8206097d8d46c98505a0d
	Issue introduced in 2.6.29 with commit a45c6cb816474cefe56059fce422a9bdcd77e0dc and fixed in 5.15.86 with commit 62005dfcc396424db3337a1dc3ab49623537f5e5
	Issue introduced in 2.6.29 with commit a45c6cb816474cefe56059fce422a9bdcd77e0dc and fixed in 6.0.16 with commit a5f8a4583280a76e50329b910e91ef1dea1e6c79
	Issue introduced in 2.6.29 with commit a45c6cb816474cefe56059fce422a9bdcd77e0dc and fixed in 6.1.2 with commit 4e1dc24bcfc8257f24c0663badec7e4f3ae80558
	Issue introduced in 2.6.29 with commit a45c6cb816474cefe56059fce422a9bdcd77e0dc and fixed in 6.2 with commit a525cad241c339ca00bf7ebf03c5180f2a9b767c

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50670
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/mmc/host/omap_hsmmc.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/f153c9e15f8961bdf38707853e15b42ea7c691d9
	https://git.kernel.org/stable/c/fb3d596267a98813a7a8206097d8d46c98505a0d
	https://git.kernel.org/stable/c/62005dfcc396424db3337a1dc3ab49623537f5e5
	https://git.kernel.org/stable/c/a5f8a4583280a76e50329b910e91ef1dea1e6c79
	https://git.kernel.org/stable/c/4e1dc24bcfc8257f24c0663badec7e4f3ae80558
	https://git.kernel.org/stable/c/a525cad241c339ca00bf7ebf03c5180f2a9b767c
