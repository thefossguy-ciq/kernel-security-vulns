From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-50250: regulator: core: fix use_count leakage when handling boot-on

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

regulator: core: fix use_count leakage when handling boot-on

I found a use_count leakage towards supply regulator of rdev with
boot-on option.

┌───────────────────┐           ┌───────────────────┐
│  regulator_dev A  │           │  regulator_dev B  │
│     (boot-on)     │           │     (boot-on)     │
│    use_count=0    │◀──supply──│    use_count=1    │
│                   │           │                   │
└───────────────────┘           └───────────────────┘

In case of rdev(A) configured with `regulator-boot-on', the use_count
of supplying regulator(B) will increment inside
regulator_enable(rdev->supply).

Thus, B will acts like always-on, and further balanced
regulator_enable/disable cannot actually disable it anymore.

However, B was also configured with `regulator-boot-on', we wish it
could be disabled afterwards.

The Linux kernel CVE team has assigned CVE-2022-50250 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.19.226 with commit dc1b1d7faf616ed663d0bba9be5abb4d1ed35d01 and fixed in 4.19.270 with commit dc3391d49479bc2bf8a2b88dbf86fdd800882fee
	Issue introduced in 5.4.7 with commit f44b07472f29ae313ce875dc7b9c75b100c608b8 and fixed in 5.4.229 with commit 5bfc53df288e8ea54ca6866fb92034214940183f
	Issue introduced in 5.5 with commit 089b3f61ecfc43ca4ea26d595e1d31ead6de3f7b and fixed in 5.10.163 with commit 4b737246ff50f810d6ab4be13c1388a07f0c14b1
	Issue introduced in 5.5 with commit 089b3f61ecfc43ca4ea26d595e1d31ead6de3f7b and fixed in 5.15.86 with commit feb847e6591e8c7a09cc39721cc9ca74fd9a5d80
	Issue introduced in 5.5 with commit 089b3f61ecfc43ca4ea26d595e1d31ead6de3f7b and fixed in 6.0.16 with commit 4dd6e1cc9c7403f1ee1b7eee85bc31b797ae8347
	Issue introduced in 5.5 with commit 089b3f61ecfc43ca4ea26d595e1d31ead6de3f7b and fixed in 6.1.2 with commit bc6c381df5793ebcf32db88a3e65acf7870379fc
	Issue introduced in 5.5 with commit 089b3f61ecfc43ca4ea26d595e1d31ead6de3f7b and fixed in 6.2 with commit 0591b14ce0398125439c759f889647369aa616a0

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-50250
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/regulator/core.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/dc3391d49479bc2bf8a2b88dbf86fdd800882fee
	https://git.kernel.org/stable/c/5bfc53df288e8ea54ca6866fb92034214940183f
	https://git.kernel.org/stable/c/4b737246ff50f810d6ab4be13c1388a07f0c14b1
	https://git.kernel.org/stable/c/feb847e6591e8c7a09cc39721cc9ca74fd9a5d80
	https://git.kernel.org/stable/c/4dd6e1cc9c7403f1ee1b7eee85bc31b797ae8347
	https://git.kernel.org/stable/c/bc6c381df5793ebcf32db88a3e65acf7870379fc
	https://git.kernel.org/stable/c/0591b14ce0398125439c759f889647369aa616a0
