From bippy-42982939a884 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>
Subject: CVE-2021-47181: USB: gadget: bRequestType is a bitfield, not a enum

Description
===========

USB: gadget: bRequestType is a bitfield, not a enum

Szymon rightly pointed out that the previous check for the endpoint
direction in bRequestType was not looking at only the bit involved, but
rather the whole value.  Normally this is ok, but for some request
types, bits other than bit 8 could be set and the check for the endpoint
length could not stall correctly.

Fix that up by only checking the single bit.

The Linux kernel CVE team has assigned CVE-2021-47181 to this issue.


Affected versions
=================

	Issue introduced in 4.4.295 and fixed in 4.4.296
	Issue introduced in 4.9.293 and fixed in 4.9.294
	Issue introduced in 4.14.258 and fixed in 4.14.259
	Issue introduced in 4.19.221 and fixed in 4.19.222
	Issue introduced in 5.4.165 and fixed in 5.4.168
	Issue introduced in 5.10.85 and fixed in 5.10.88
	Issue introduced in 5.15.8 and fixed in 5.15.11

Please note that only supported kernel versions have fixes applied to
them.  For a full list of currently supported kernel versions, please
see https://www.kernel.org/

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2021-47181
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual change to resolve this
issue can be found at:
	https://git.kernel.org/stable/linux/c/f08adf5add9a071160c68bb2a61d697f39ab0758
