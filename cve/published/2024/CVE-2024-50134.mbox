From bippy-9e1c9544281a Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-50134: drm/vboxvideo: Replace fake VLA at end of vbva_mouse_pointer_shape with real VLA
Message-Id: <2024110558-CVE-2024-50134-53ce@gregkh>
Content-Length: 2709
Lines: 65
X-Developer-Signature: v=1; a=openpgp-sha256; l=2775;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=9cPBqh9uudgCSlJMLQ8kCpptbVgO+YJ9PjSV6K9j9zA=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDOlagYsi/ddkrvl1d5P//fwXjg3V3ppFm3mXHE9T3rfm2
 5vz1fuOdsSyMAgyMciKKbJ82cZzdH/FIUUvQ9vTMHNYmUCGMHBxCsBEyjYzLDhva7p3j6fU3aSH
 flNFN2tbem6Z/J9hfjjX+WhDp+iEbOvfri7eAWwdps6zAQ==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/vboxvideo: Replace fake VLA at end of vbva_mouse_pointer_shape with real VLA

Replace the fake VLA at end of the vbva_mouse_pointer_shape shape with
a real VLA to fix a "memcpy: detected field-spanning write error" warning:

[   13.319813] memcpy: detected field-spanning write (size 16896) of single field "p->data" at drivers/gpu/drm/vboxvideo/hgsmi_base.c:154 (size 4)
[   13.319841] WARNING: CPU: 0 PID: 1105 at drivers/gpu/drm/vboxvideo/hgsmi_base.c:154 hgsmi_update_pointer_shape+0x192/0x1c0 [vboxvideo]
[   13.320038] Call Trace:
[   13.320173]  hgsmi_update_pointer_shape [vboxvideo]
[   13.320184]  vbox_cursor_atomic_update [vboxvideo]

Note as mentioned in the added comment it seems the original length
calculation for the allocated and send hgsmi buffer is 4 bytes too large.
Changing this is not the goal of this patch, so this behavior is kept.

The Linux kernel CVE team has assigned CVE-2024-50134 to this issue.


Affected and fixed versions
===========================

	Fixed in 5.15.170 with commit 34a422274b69
	Fixed in 6.1.115 with commit 7458a6cdaebb
	Fixed in 6.6.59 with commit 9eb32bd23bbc
	Fixed in 6.11.6 with commit fae9dc12c61c
	Fixed in 6.12-rc2 with commit d92b90f9a54d

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-50134
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/vboxvideo/hgsmi_base.c
	drivers/gpu/drm/vboxvideo/vboxvideo.h


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/34a422274b693507025a7db21519865d1862afcb
	https://git.kernel.org/stable/c/7458a6cdaebb3dc59af8578ee354fae78a154c4a
	https://git.kernel.org/stable/c/9eb32bd23bbcec44bcbef27b7f282b7a7f3d0391
	https://git.kernel.org/stable/c/fae9dc12c61ce23cf29d09824a741b7b1ff8f01f
	https://git.kernel.org/stable/c/d92b90f9a54d9300a6e883258e79f36dab53bfae
