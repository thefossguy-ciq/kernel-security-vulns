From bippy-7d53e8ef8be4 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-36479: fpga: bridge: add owner module and take its refcount
Message-Id: <2024062459-CVE-2024-36479-ef6c@gregkh>
Content-Length: 3007
Lines: 70
X-Developer-Signature: v=1; a=openpgp-sha256; l=3078;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=BVQ5E/qnZ+M3u+eERtD0aQsHcaI2pzwUGXDWvDrrMhc=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDGmV1do3+Xeqnr57LmLCjbjm8Pf8Td+0l7aECGX2XPtvN
 E9GXbalI5aFQZCJQVZMkeXLNp6j+ysOKXoZ2p6GmcPKBDKEgYtTACbi9IdhrmDqB287uS/L7658
 kVbVx1TEkWk3iWHB8fVHLQ7vK9K337s5hzGN7+Aj5xtBAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

fpga: bridge: add owner module and take its refcount

The current implementation of the fpga bridge assumes that the low-level
module registers a driver for the parent device and uses its owner pointer
to take the module's refcount. This approach is problematic since it can
lead to a null pointer dereference while attempting to get the bridge if
the parent device does not have a driver.

To address this problem, add a module owner pointer to the fpga_bridge
struct and use it to take the module's refcount. Modify the function for
registering a bridge to take an additional owner module parameter and
rename it to avoid conflicts. Use the old function name for a helper macro
that automatically sets the module that registers the bridge as the owner.
This ensures compatibility with existing low-level control modules and
reduces the chances of registering a bridge without setting the owner.

Also, update the documentation to keep it consistent with the new interface
for registering an fpga bridge.

Other changes: opportunistically move put_device() from __fpga_bridge_get()
to fpga_bridge_get() and of_fpga_bridge_get() to improve code clarity since
the bridge device is taken in these functions.

The Linux kernel CVE team has assigned CVE-2024-36479 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.10 with commit 21aeda950c5f and fixed in 6.6.33 with commit d7c4081c54a1
	Issue introduced in 4.10 with commit 21aeda950c5f and fixed in 6.9.4 with commit 6896b6b2e2d9
	Issue introduced in 4.10 with commit 21aeda950c5f and fixed in 6.10-rc1 with commit 1da11f822042

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-36479
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	Documentation/driver-api/fpga/fpga-bridge.rst
	drivers/fpga/fpga-bridge.c
	include/linux/fpga/fpga-bridge.h


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d7c4081c54a1d4068de9440957303a76f9e5c95b
	https://git.kernel.org/stable/c/6896b6b2e2d9ec4e1b0acb4c1698a75a4b34d125
	https://git.kernel.org/stable/c/1da11f822042eb6ef4b6064dc048f157a7852529
