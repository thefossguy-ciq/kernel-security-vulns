From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-53685: ceph: give up on paths longer than PATH_MAX
Message-Id: <2025011143-CVE-2024-53685-e6c3@gregkh>
Content-Length: 2118
Lines: 57
X-Developer-Signature: v=1; a=openpgp-sha256; l=2176;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=wlKU2tLIOTEObvoX1vSJAq8aZbNAxM5MATzVvLMY9X0=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDOlNqQuyFIsuTWFbOn+rw25ObcGvc86em7BK3n/Ot9/uV
 8OsUqNiO2JZGASZGGTFFFm+bOM5ur/ikKKXoe1pmDmsTCBDGLg4BWAij08zzGIuU203XyB1iPf4
 3rkNc9nPf16ceoBhwcSO/dKVXV9X33t19OM+zyliK7Z8fwIA
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ceph: give up on paths longer than PATH_MAX

If the full path to be built by ceph_mdsc_build_path() happens to be
longer than PATH_MAX, then this function will enter an endless (retry)
loop, effectively blocking the whole task.  Most of the machine
becomes unusable, making this a very simple and effective DoS
vulnerability.

I cannot imagine why this retry was ever implemented, but it seems
rather useless and harmful to me.  Let's remove it and fail with
ENAMETOOLONG instead.

The Linux kernel CVE team has assigned CVE-2024-53685 to this issue.


Affected and fixed versions
===========================

	Fixed in 6.6.70 with commit c47ed91156daf328601d02b58d52d9804da54108
	Fixed in 6.12.7 with commit 99a37ab76a315c8307eb5b0dc095d8ad9d8efeaa
	Fixed in 6.13-rc4 with commit 550f7ca98ee028a606aa75705a7e77b1bd11720f

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-53685
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/ceph/mds_client.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/c47ed91156daf328601d02b58d52d9804da54108
	https://git.kernel.org/stable/c/99a37ab76a315c8307eb5b0dc095d8ad9d8efeaa
	https://git.kernel.org/stable/c/550f7ca98ee028a606aa75705a7e77b1bd11720f
