From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-53150: ALSA: usb-audio: Fix out of bounds reads when finding clock sources

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ALSA: usb-audio: Fix out of bounds reads when finding clock sources

The current USB-audio driver code doesn't check bLength of each
descriptor at traversing for clock descriptors.  That is, when a
device provides a bogus descriptor with a shorter bLength, the driver
might hit out-of-bounds reads.

For addressing it, this patch adds sanity checks to the validator
functions for the clock descriptor traversal.  When the descriptor
length is shorter than expected, it's skipped in the loop.

For the clock source and clock multiplier descriptors, we can just
check bLength against the sizeof() of each descriptor type.
OTOH, the clock selector descriptor of UAC2 and UAC3 has an array
of bNrInPins elements and two more fields at its tail, hence those
have to be checked in addition to the sizeof() check.

The Linux kernel CVE team has assigned CVE-2024-53150 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.4 with commit b8e4f1fdfa422398c2d6c47bfb7d1feb3046d70a and fixed in 5.4.287 with commit a632bdcb359fd8145e86486ff8612da98e239acd
	Issue introduced in 5.4 with commit b8e4f1fdfa422398c2d6c47bfb7d1feb3046d70a and fixed in 5.10.231 with commit 45a92cbc88e4013bfed7fd2ccab3ade45f8e896b
	Issue introduced in 5.4 with commit b8e4f1fdfa422398c2d6c47bfb7d1feb3046d70a and fixed in 5.15.174 with commit ab011f7439d9bbfd34fd3b9cef4b2d6d952c9bb9
	Issue introduced in 5.4 with commit b8e4f1fdfa422398c2d6c47bfb7d1feb3046d70a and fixed in 6.1.120 with commit da13ade87a12dd58829278bc816a61bea06a56a9
	Issue introduced in 5.4 with commit b8e4f1fdfa422398c2d6c47bfb7d1feb3046d70a and fixed in 6.6.64 with commit 74cb86e1006c5437b1d90084d22018da30fddc77
	Issue introduced in 5.4 with commit b8e4f1fdfa422398c2d6c47bfb7d1feb3046d70a and fixed in 6.11.11 with commit ea0fa76f61cf8e932d1d26e6193513230816e11d
	Issue introduced in 5.4 with commit b8e4f1fdfa422398c2d6c47bfb7d1feb3046d70a and fixed in 6.12.2 with commit 096bb5b43edf755bc4477e64004fa3a20539ec2f
	Issue introduced in 5.4 with commit b8e4f1fdfa422398c2d6c47bfb7d1feb3046d70a and fixed in 6.13 with commit a3dd4d63eeb452cfb064a13862fb376ab108f6a6
	Issue introduced in 4.19.84 with commit 9feeaa50e5b4b0b71259d918a36ecf9059e60796
	Issue introduced in 5.3.11 with commit 3b17a13b687ae99939dc94a4ae01fbc34f68decc

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-53150
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	sound/usb/clock.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/a632bdcb359fd8145e86486ff8612da98e239acd
	https://git.kernel.org/stable/c/45a92cbc88e4013bfed7fd2ccab3ade45f8e896b
	https://git.kernel.org/stable/c/ab011f7439d9bbfd34fd3b9cef4b2d6d952c9bb9
	https://git.kernel.org/stable/c/da13ade87a12dd58829278bc816a61bea06a56a9
	https://git.kernel.org/stable/c/74cb86e1006c5437b1d90084d22018da30fddc77
	https://git.kernel.org/stable/c/ea0fa76f61cf8e932d1d26e6193513230816e11d
	https://git.kernel.org/stable/c/096bb5b43edf755bc4477e64004fa3a20539ec2f
	https://git.kernel.org/stable/c/a3dd4d63eeb452cfb064a13862fb376ab108f6a6
