From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-57998: OPP: add index check to assert to avoid buffer overflow in _read_freq()
Message-Id: <2025022641-CVE-2024-57998-e730@gregkh>
Content-Length: 2676
Lines: 61
X-Developer-Signature: v=1; a=openpgp-sha256; l=2738;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=aztvcnMGyMZjESkMUpnGo3ahZMYmOopHe8h2LcuZYNM=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDOn7T5TuXlbUEiaR3Vyv9ZzvysdCv+yYvIRfa6MNz1iy/
 UoWbLzcEcvCIMjEICumyPJlG8/R/RWHFL0MbU/DzGFlAhnCwMUpABPRecMwz3qC3Z/dUXPPfhG5
 eXlf3XZu9nVWxgwL1s2aP2fXjcIdOlKzpQu3ea+cOVd/JwA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

OPP: add index check to assert to avoid buffer overflow in _read_freq()

Pass the freq index to the assert function to make sure
we do not read a freq out of the opp->rates[] table when called
from the indexed variants:
dev_pm_opp_find_freq_exact_indexed() or
dev_pm_opp_find_freq_ceil/floor_indexed().

Add a secondary parameter to the assert function, unused
for assert_single_clk() then add assert_clk_index() which
will check for the clock index when called from the _indexed()
find functions.

The Linux kernel CVE team has assigned CVE-2024-57998 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.6 with commit 142e17c1c2b48e3fb4f024e62ab6dee18f268694 and fixed in 6.6.76 with commit eb6ffa0192ba83ece1a318b956265519c5c7dcec
	Issue introduced in 6.6 with commit 142e17c1c2b48e3fb4f024e62ab6dee18f268694 and fixed in 6.12.13 with commit 7d68c20638e50d5eb4576492a7958328ae445248
	Issue introduced in 6.6 with commit 142e17c1c2b48e3fb4f024e62ab6dee18f268694 and fixed in 6.13.2 with commit da2a6acc73933b7812c94794726e438cde39e037
	Issue introduced in 6.6 with commit 142e17c1c2b48e3fb4f024e62ab6dee18f268694 and fixed in 6.14-rc1 with commit d659bc68ed489022ea33342cfbda2911a81e7a0d

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-57998
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/opp/core.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/774dd6f0f0a61c9c3848e025d7d9eeed1a7ca4cd
	https://git.kernel.org/stable/c/eb6ffa0192ba83ece1a318b956265519c5c7dcec
	https://git.kernel.org/stable/c/7d68c20638e50d5eb4576492a7958328ae445248
	https://git.kernel.org/stable/c/da2a6acc73933b7812c94794726e438cde39e037
	https://git.kernel.org/stable/c/d659bc68ed489022ea33342cfbda2911a81e7a0d
