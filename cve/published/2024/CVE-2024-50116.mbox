From bippy-9e1c9544281a Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-50116: nilfs2: fix kernel bug due to missing clearing of buffer delay flag
Message-Id: <2024110555-CVE-2024-50116-64fb@gregkh>
Content-Length: 2637
Lines: 63
X-Developer-Signature: v=1; a=openpgp-sha256; l=2701;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=Y87jgXO5WBN19yI06SbWGBNXmXVozif9bA38Hccfkh4=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDOlagfPzS2d4tWx7cP7B7i9z/9p8vfZ75g8p+Q6jJ/ts9
 xxgOWZ2oiOWhUGQiUFWTJHlyzaeo/srDil6GdqehpnDygQyhIGLUwAmsruHYZ7Gatk5Kta69lHq
 v1+9z59eVnKnRZphQSdX1/tki4L3CyPmKq3Vdqw0v+gVCQA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

nilfs2: fix kernel bug due to missing clearing of buffer delay flag

Syzbot reported that after nilfs2 reads a corrupted file system image
and degrades to read-only, the BUG_ON check for the buffer delay flag
in submit_bh_wbc() may fail, causing a kernel bug.

This is because the buffer delay flag is not cleared when clearing the
buffer state flags to discard a page/folio or a buffer head. So, fix
this.

This became necessary when the use of nilfs2's own page clear routine
was expanded.  This state inconsistency does not occur if the buffer
is written normally by log writing.

The Linux kernel CVE team has assigned CVE-2024-50116 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.10 with commit 8c26c4e2694a and fixed in 5.15.170 with commit 822203f6355f
	Issue introduced in 3.10 with commit 8c26c4e2694a and fixed in 6.1.115 with commit 27524f65621f
	Issue introduced in 3.10 with commit 8c26c4e2694a and fixed in 6.6.59 with commit 743c78d455e7
	Issue introduced in 3.10 with commit 8c26c4e2694a and fixed in 6.11.6 with commit c6f58ff2d4c5
	Issue introduced in 3.10 with commit 8c26c4e2694a and fixed in 6.12-rc5 with commit 6ed469df0bfb

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-50116
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/nilfs2/page.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/822203f6355f4b322d21e7115419f6b98284be25
	https://git.kernel.org/stable/c/27524f65621f490184f2ace44cd8e5f3685af4a3
	https://git.kernel.org/stable/c/743c78d455e784097011ea958b27396001181567
	https://git.kernel.org/stable/c/c6f58ff2d4c552927fe9a187774e668ebba6c7aa
	https://git.kernel.org/stable/c/6ed469df0bfbef3e4b44fca954a781919db9f7ab
