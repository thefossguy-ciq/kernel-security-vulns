From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-71161: dm-verity: disable recursive forward error correction
Message-Id: <2026012346-CVE-2025-71161-4b58@gregkh>
Content-Length: 2339
Lines: 61
X-Developer-Signature: v=1; a=openpgp-sha256; l=2401;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=KCAGQ0xM4wVJKeursFmjBqHY7JnCZnI5Cjdzt4/phu4=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJnFk/Zx6/7ove/8/0Snhox29L26WIVjj8KvZpgp7qhQe
 rLOV+VERywLgyATg6yYIsuXbTxH91ccUvQytD0NM4eVCWQIAxenAEwkmJdhrnCz17udR0o2XGIp
 l9O4tktQuezcS4YF+183yOas3R35WWBDmPHsdW/yg85+AAA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

dm-verity: disable recursive forward error correction

There are two problems with the recursive correction:

1. It may cause denial-of-service. In fec_read_bufs, there is a loop that
has 253 iterations. For each iteration, we may call verity_hash_for_block
recursively. There is a limit of 4 nested recursions - that means that
there may be at most 253^4 (4 billion) iterations. Red Hat QE team
actually created an image that pushes dm-verity to this limit - and this
image just makes the udev-worker process get stuck in the 'D' state.

2. It doesn't work. In fec_read_bufs we store data into the variable
"fio->bufs", but fio bufs is shared between recursive invocations, if
"verity_hash_for_block" invoked correction recursively, it would
overwrite partially filled fio->bufs.

The Linux kernel CVE team has assigned CVE-2025-71161 to this issue.


Affected and fixed versions
===========================

	Fixed in 6.18.6 with commit 232948cf600fba69aff36b25d85ef91a73a35756
	Fixed in 6.19-rc1 with commit d9f3e47d3fae0c101d9094bc956ed24e7a0ee801

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-71161
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/md/dm-verity-fec.c
	drivers/md/dm-verity-fec.h
	drivers/md/dm-verity-target.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/232948cf600fba69aff36b25d85ef91a73a35756
	https://git.kernel.org/stable/c/d9f3e47d3fae0c101d9094bc956ed24e7a0ee801
