From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-68204: pmdomain: arm: scmi: Fix genpd leak on provider registration failure

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

pmdomain: arm: scmi: Fix genpd leak on provider registration failure

If of_genpd_add_provider_onecell() fails during probe, the previously
created generic power domains are not removed, leading to a memory leak
and potential kernel crash later in genpd_debug_add().

Add proper error handling to unwind the initialized domains before
returning from probe to ensure all resources are correctly released on
failure.

Example crash trace observed without this fix:

  | Unable to handle kernel paging request at virtual address fffffffffffffc70
  | CPU: 1 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.18.0-rc1 #405 PREEMPT
  | Hardware name: ARM LTD ARM Juno Development Platform/ARM Juno Development Platform
  | pstate: 00000005 (nzcv daif -PAN -UAO -TCO -DIT -SSBS BTYPE=--)
  | pc : genpd_debug_add+0x2c/0x160
  | lr : genpd_debug_init+0x74/0x98
  | Call trace:
  |  genpd_debug_add+0x2c/0x160 (P)
  |  genpd_debug_init+0x74/0x98
  |  do_one_initcall+0xd0/0x2d8
  |  do_initcall_level+0xa0/0x140
  |  do_initcalls+0x60/0xa8
  |  do_basic_setup+0x28/0x40
  |  kernel_init_freeable+0xe8/0x170
  |  kernel_init+0x2c/0x140
  |  ret_from_fork+0x10/0x20

The Linux kernel CVE team has assigned CVE-2025-68204 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.17 with commit 898216c97ed2ebfffda659ce12388da43534de6c and fixed in 5.4.302 with commit 18249a167ffd91b4b4fbd92afd4ddcbf3af81f35
	Issue introduced in 4.17 with commit 898216c97ed2ebfffda659ce12388da43534de6c and fixed in 5.10.247 with commit c6e11d320fd6cbaef6d589f2fcb45aa25a6b960a
	Issue introduced in 4.17 with commit 898216c97ed2ebfffda659ce12388da43534de6c and fixed in 5.15.197 with commit 582f48d22eb5676fe7be3589b986ddd29f7bf4d1
	Issue introduced in 4.17 with commit 898216c97ed2ebfffda659ce12388da43534de6c and fixed in 6.1.159 with commit 7f569197f7ad09319af960bd7e43109de5c67c04
	Issue introduced in 4.17 with commit 898216c97ed2ebfffda659ce12388da43534de6c and fixed in 6.6.118 with commit ad120c08b89a81d41d091490bbe150343473b659
	Issue introduced in 4.17 with commit 898216c97ed2ebfffda659ce12388da43534de6c and fixed in 6.12.59 with commit 921b090841ae7a08b19ab14495bdf8636dc31e21
	Issue introduced in 4.17 with commit 898216c97ed2ebfffda659ce12388da43534de6c and fixed in 6.17.9 with commit 983e91da82ec3e331600108f9be3ea61236f5c75
	Issue introduced in 4.17 with commit 898216c97ed2ebfffda659ce12388da43534de6c and fixed in 6.18 with commit 7458f72cc28f9eb0de811effcb5376d0ec19094a

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-68204
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/pmdomain/arm/scmi_pm_domain.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/18249a167ffd91b4b4fbd92afd4ddcbf3af81f35
	https://git.kernel.org/stable/c/c6e11d320fd6cbaef6d589f2fcb45aa25a6b960a
	https://git.kernel.org/stable/c/582f48d22eb5676fe7be3589b986ddd29f7bf4d1
	https://git.kernel.org/stable/c/7f569197f7ad09319af960bd7e43109de5c67c04
	https://git.kernel.org/stable/c/ad120c08b89a81d41d091490bbe150343473b659
	https://git.kernel.org/stable/c/921b090841ae7a08b19ab14495bdf8636dc31e21
	https://git.kernel.org/stable/c/983e91da82ec3e331600108f9be3ea61236f5c75
	https://git.kernel.org/stable/c/7458f72cc28f9eb0de811effcb5376d0ec19094a
