From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-40043: net: nfc: nci: Add parameter validation for packet data
Message-Id: <2025102813-CVE-2025-40043-39d2@gregkh>
Content-Length: 3956
Lines: 80
X-Developer-Signature: v=1; a=openpgp-sha256; l=4037;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=LLOvLUU0fRH7SnWumEItWA92x6aaiZ8ASY/903+6nqI=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJkMa2tvzt+x/Lcys1rVnieKp7LrRRfcvfTb62fnLYmae
 wu+/xAz64hlYRBkYpAVU2T5so3n6P6KQ4pehranYeawMoEMYeDiFICJMDEyzBXMXLkkxXXBZf5l
 pc0r5HnshAW+7mBYsGDlwX0/W9rkkhJTU+3fv9ghfu8gDwA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net: nfc: nci: Add parameter validation for packet data

Syzbot reported an uninitialized value bug in nci_init_req, which was
introduced by commit 5aca7966d2a7 ("Merge tag
'perf-tools-fixes-for-v6.17-2025-09-16' of
git://git.kernel.org/pub/scm/linux/kernel/git/perf/perf-tools").

This bug arises due to very limited and poor input validation
that was done at nic_valid_size(). This validation only
validates the skb->len (directly reflects size provided at the
userspace interface) with the length provided in the buffer
itself (interpreted as NCI_HEADER). This leads to the processing
of memory content at the address assuming the correct layout
per what opcode requires there. This leads to the accesses to
buffer of `skb_buff->data` which is not assigned anything yet.

Following the same silent drop of packets of invalid sizes at
`nic_valid_size()`, add validation of the data in the respective
handlers and return error values in case of failure. Release
the skb if error values are returned from handlers in
`nci_nft_packet` and effectively do a silent drop

Possible TODO: because we silently drop the packets, the
call to `nci_request` will be waiting for completion of request
and will face timeouts. These timeouts can get excessively logged
in the dmesg. A proper handling of them may require to export
`nci_request_cancel` (or propagate error handling from the
nft packets handlers).

The Linux kernel CVE team has assigned CVE-2025-40043 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.2 with commit 6a2968aaf50c7a22fced77a5e24aa636281efca8 and fixed in 5.15.195 with commit 8fcc7315a10a84264e55bb65ede10f0af20a983f
	Issue introduced in 3.2 with commit 6a2968aaf50c7a22fced77a5e24aa636281efca8 and fixed in 6.1.156 with commit bfdda0123dde406dbff62e7e9136037e97998a15
	Issue introduced in 3.2 with commit 6a2968aaf50c7a22fced77a5e24aa636281efca8 and fixed in 6.6.112 with commit 0ba68bea1e356f466ad29449938bea12f5f3711f
	Issue introduced in 3.2 with commit 6a2968aaf50c7a22fced77a5e24aa636281efca8 and fixed in 6.12.53 with commit 74837bca0748763a77f77db47a0bdbe63b347628
	Issue introduced in 3.2 with commit 6a2968aaf50c7a22fced77a5e24aa636281efca8 and fixed in 6.17.3 with commit c395d1e548cc68e84584ffa2e3ca9796a78bf7b9
	Issue introduced in 3.2 with commit 6a2968aaf50c7a22fced77a5e24aa636281efca8 and fixed in 6.18-rc1 with commit 9c328f54741bd5465ca1dc717c84c04242fac2e1

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-40043
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/nfc/nci/ntf.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/8fcc7315a10a84264e55bb65ede10f0af20a983f
	https://git.kernel.org/stable/c/bfdda0123dde406dbff62e7e9136037e97998a15
	https://git.kernel.org/stable/c/0ba68bea1e356f466ad29449938bea12f5f3711f
	https://git.kernel.org/stable/c/74837bca0748763a77f77db47a0bdbe63b347628
	https://git.kernel.org/stable/c/c395d1e548cc68e84584ffa2e3ca9796a78bf7b9
	https://git.kernel.org/stable/c/9c328f54741bd5465ca1dc717c84c04242fac2e1
