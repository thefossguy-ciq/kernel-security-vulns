From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38633: clk: spacemit: mark K1 pll1_d8 as critical

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

clk: spacemit: mark K1 pll1_d8 as critical

The pll1_d8 clock is enabled by the boot loader, and is ultimately a
parent for numerous clocks, including those used by APB and AXI buses.
Guodong Xu discovered that this clock got disabled while responding to
getting -EPROBE_DEFER when requesting a reset controller.

The needed clock (CLK_DMA, along with its parents) had already been
enabled.  To respond to the probe deferral return, the CLK_DMA clock
was disabled, and this led to parent clocks also reducing their enable
count.  When the enable count for pll1_d8 was decremented it became 0,
which caused it to be disabled.  This led to a system hang.

Marking that clock critical resolves this by preventing it from being
disabled.

Define a new macro CCU_FACTOR_GATE_DEFINE() to allow clock flags to
be supplied for a CCU_FACTOR_GATE clock.

The Linux kernel CVE team has assigned CVE-2025-38633 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.16 with commit 1b72c59db0add8e47fa116b21f78ed0b09a264f3 and fixed in 6.16.1 with commit 10948c00e548e9ad2ce9d765baf26dce2d9b806b
	Issue introduced in 6.16 with commit 1b72c59db0add8e47fa116b21f78ed0b09a264f3 and fixed in 6.17 with commit 7554729de27daf6d54bcf8689d863bbe267828bf

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38633
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/clk/spacemit/ccu-k1.c
	drivers/clk/spacemit/ccu_mix.h


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/10948c00e548e9ad2ce9d765baf26dce2d9b806b
	https://git.kernel.org/stable/c/7554729de27daf6d54bcf8689d863bbe267828bf
