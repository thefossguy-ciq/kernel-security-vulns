From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38190: atm: Revert atm_account_tx() if copy_from_iter_full() fails.

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

atm: Revert atm_account_tx() if copy_from_iter_full() fails.

In vcc_sendmsg(), we account skb->truesize to sk->sk_wmem_alloc by
atm_account_tx().

It is expected to be reverted by atm_pop_raw() later called by
vcc->dev->ops->send(vcc, skb).

However, vcc_sendmsg() misses the same revert when copy_from_iter_full()
fails, and then we will leak a socket.

Let's factorise the revert part as atm_return_tx() and call it in
the failure path.

Note that the corresponding sk_wmem_alloc operation can be found in
alloc_tx() as of the blamed commit.

  $ git blame -L:alloc_tx net/atm/common.c c55fa3cccbc2c~

The Linux kernel CVE team has assigned CVE-2025-38190 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.12 with commit 1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 and fixed in 5.4.295 with commit 5e0d00992118e234ebf29d5145c1cc920342777e
	Issue introduced in 2.6.12 with commit 1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 and fixed in 5.10.239 with commit c12430edd92fd49a4800b0f3fb395b50cb16bcc1
	Issue introduced in 2.6.12 with commit 1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 and fixed in 5.15.186 with commit 287b4f085d2ca3375cf1ee672af27410c64777e8
	Issue introduced in 2.6.12 with commit 1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 and fixed in 6.1.142 with commit 2252c539c43f9a1431a7e8b34e3c18e9dd77a96d
	Issue introduced in 2.6.12 with commit 1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 and fixed in 6.6.95 with commit 3902205eadf35db59dbc2186c2a98b9e6182efa5
	Issue introduced in 2.6.12 with commit 1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 and fixed in 6.12.35 with commit 3d828519bd69bfcaabdd942a872679617ef06739
	Issue introduced in 2.6.12 with commit 1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 and fixed in 6.15.4 with commit 7d6bc28cfe5c8e3a279b4b4bdeed6698b2702685
	Issue introduced in 2.6.12 with commit 1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 and fixed in 6.16-rc3 with commit 7851263998d4269125fd6cb3fdbfc7c6db853859

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38190
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	include/linux/atmdev.h
	net/atm/common.c
	net/atm/raw.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/5e0d00992118e234ebf29d5145c1cc920342777e
	https://git.kernel.org/stable/c/c12430edd92fd49a4800b0f3fb395b50cb16bcc1
	https://git.kernel.org/stable/c/287b4f085d2ca3375cf1ee672af27410c64777e8
	https://git.kernel.org/stable/c/2252c539c43f9a1431a7e8b34e3c18e9dd77a96d
	https://git.kernel.org/stable/c/3902205eadf35db59dbc2186c2a98b9e6182efa5
	https://git.kernel.org/stable/c/3d828519bd69bfcaabdd942a872679617ef06739
	https://git.kernel.org/stable/c/7d6bc28cfe5c8e3a279b4b4bdeed6698b2702685
	https://git.kernel.org/stable/c/7851263998d4269125fd6cb3fdbfc7c6db853859
