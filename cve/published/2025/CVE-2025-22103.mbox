From bippy-7c5fe7eed585 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-22103: net: fix NULL pointer dereference in l3mdev_l3_rcv
Message-Id: <2025041621-CVE-2025-22103-b3a2@gregkh>
Content-Length: 2735
Lines: 78
X-Developer-Signature: v=1; a=openpgp-sha256; l=2814;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=okutZFUbjuxG6rQW8Y1Ha5cDawzw+JqrwGrS5sAX0po=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDOn/dx1lm7V4vrVSKeelLKtqB8ZtN5R3u0tmWdZevXdl1
 u1FVncfdcSyMAgyMciKKbJ82cZzdH/FIUUvQ9vTMHNYmUCGMHBxCsBEJO4wzNP/HeIqwVV/4sKc
 yH3v02Ne8H+62MAwv8on/yW3MTt76w3Zf/31xnX/MrtNAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net: fix NULL pointer dereference in l3mdev_l3_rcv

When delete l3s ipvlan:

    ip link del link eth0 ipvlan1 type ipvlan mode l3s

This may cause a null pointer dereference:

    Call trace:
     ip_rcv_finish+0x48/0xd0
     ip_rcv+0x5c/0x100
     __netif_receive_skb_one_core+0x64/0xb0
     __netif_receive_skb+0x20/0x80
     process_backlog+0xb4/0x204
     napi_poll+0xe8/0x294
     net_rx_action+0xd8/0x22c
     __do_softirq+0x12c/0x354

This is because l3mdev_l3_rcv() visit dev->l3mdev_ops after
ipvlan_l3s_unregister() assign the dev->l3mdev_ops to NULL. The process
like this:

    (CPU1)                     | (CPU2)
    l3mdev_l3_rcv()            |
      check dev->priv_flags:   |
        master = skb->dev;     |
                               |
                               | ipvlan_l3s_unregister()
                               |   set dev->priv_flags
                               |   dev->l3mdev_ops = NULL;
                               |
      visit master->l3mdev_ops |

To avoid this by do not set dev->l3mdev_ops when unregister l3s ipvlan.

The Linux kernel CVE team has assigned CVE-2025-22103 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.1 with commit c675e06a98a474f7ad0af32ce467613da818da52 and fixed in 6.14.2 with commit f9dff65140efc289f01bcf39c3ca66a8806b6132
	Issue introduced in 5.1 with commit c675e06a98a474f7ad0af32ce467613da818da52 and fixed in 6.15-rc1 with commit 0032c99e83b9ce6d5995d65900aa4b6ffb501cce

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-22103
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/ipvlan/ipvlan_l3s.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/f9dff65140efc289f01bcf39c3ca66a8806b6132
	https://git.kernel.org/stable/c/0032c99e83b9ce6d5995d65900aa4b6ffb501cce
