From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38535: phy: tegra: xusb: Fix unbalanced regulator disable in UTMI PHY mode

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

phy: tegra: xusb: Fix unbalanced regulator disable in UTMI PHY mode

When transitioning from USB_ROLE_DEVICE to USB_ROLE_NONE, the code
assumed that the regulator should be disabled. However, if the regulator
is marked as always-on, regulator_is_enabled() continues to return true,
leading to an incorrect attempt to disable a regulator which is not
enabled.

This can result in warnings such as:

[  250.155624] WARNING: CPU: 1 PID: 7326 at drivers/regulator/core.c:3004
_regulator_disable+0xe4/0x1a0
[  250.155652] unbalanced disables for VIN_SYS_5V0

To fix this, we move the regulator control logic into
tegra186_xusb_padctl_id_override() function since it's directly related
to the ID override state. The regulator is now only disabled when the role
transitions from USB_ROLE_HOST to USB_ROLE_NONE, by checking the VBUS_ID
register. This ensures that regulator enable/disable operations are
properly balanced and only occur when actually transitioning to/from host
mode.

The Linux kernel CVE team has assigned CVE-2025-38535 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.7 with commit 49d46e3c7e597e8b00c6fc16e6fd7a92044f4371 and fixed in 5.10.241 with commit ceb645ac6ce052609ee5c8f819a80e8881789b04
	Issue introduced in 5.7 with commit 49d46e3c7e597e8b00c6fc16e6fd7a92044f4371 and fixed in 5.15.190 with commit cdcb0ffd6448f6be898956913a42bd08e59fb2ae
	Issue introduced in 5.7 with commit 49d46e3c7e597e8b00c6fc16e6fd7a92044f4371 and fixed in 6.1.147 with commit 1bb85b5c2bd43b687c3d54eb6328917f90dd38fc
	Issue introduced in 5.7 with commit 49d46e3c7e597e8b00c6fc16e6fd7a92044f4371 and fixed in 6.6.100 with commit 5367cdeb75cb6c687ca468450bceb2602ab239d8
	Issue introduced in 5.7 with commit 49d46e3c7e597e8b00c6fc16e6fd7a92044f4371 and fixed in 6.12.40 with commit ec7f98ff05f0649af0adeb4808c7ba23d6111ef9
	Issue introduced in 5.7 with commit 49d46e3c7e597e8b00c6fc16e6fd7a92044f4371 and fixed in 6.15.8 with commit eaa420339658615d26c1cc95cd6cf720b9aebfca
	Issue introduced in 5.7 with commit 49d46e3c7e597e8b00c6fc16e6fd7a92044f4371 and fixed in 6.16 with commit cefc1caee9dd06c69e2d807edc5949b329f52b22

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38535
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/phy/tegra/xusb-tegra186.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/ceb645ac6ce052609ee5c8f819a80e8881789b04
	https://git.kernel.org/stable/c/cdcb0ffd6448f6be898956913a42bd08e59fb2ae
	https://git.kernel.org/stable/c/1bb85b5c2bd43b687c3d54eb6328917f90dd38fc
	https://git.kernel.org/stable/c/5367cdeb75cb6c687ca468450bceb2602ab239d8
	https://git.kernel.org/stable/c/ec7f98ff05f0649af0adeb4808c7ba23d6111ef9
	https://git.kernel.org/stable/c/eaa420339658615d26c1cc95cd6cf720b9aebfca
	https://git.kernel.org/stable/c/cefc1caee9dd06c69e2d807edc5949b329f52b22
