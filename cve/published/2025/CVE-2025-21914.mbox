From bippy-7c5fe7eed585 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-21914: slimbus: messaging: Free transaction ID in delayed interrupt scenario

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

slimbus: messaging: Free transaction ID in delayed interrupt scenario

In case of interrupt delay for any reason, slim_do_transfer()
returns timeout error but the transaction ID (TID) is not freed.
This results into invalid memory access inside
qcom_slim_ngd_rx_msgq_cb() due to invalid TID.

Fix the issue by freeing the TID in slim_do_transfer() before
returning timeout error to avoid invalid memory access.

Call trace:
__memcpy_fromio+0x20/0x190
qcom_slim_ngd_rx_msgq_cb+0x130/0x290 [slim_qcom_ngd_ctrl]
vchan_complete+0x2a0/0x4a0
tasklet_action_common+0x274/0x700
tasklet_action+0x28/0x3c
_stext+0x188/0x620
run_ksoftirqd+0x34/0x74
smpboot_thread_fn+0x1d8/0x464
kthread+0x178/0x238
ret_from_fork+0x10/0x20
Code: aa0003e8 91000429 f100044a 3940002b (3800150b)
---[ end trace 0fe00bec2b975c99 ]---
Kernel panic - not syncing: Oops: Fatal exception in interrupt.

The Linux kernel CVE team has assigned CVE-2025-21914 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.16 with commit afbdcc7c384b0d446da08b1e0901dc176b41b9e0 and fixed in 5.4.291 with commit cec8c0ac173fe5321f03fdb1a09a9cb69bc9a9fe
	Issue introduced in 4.16 with commit afbdcc7c384b0d446da08b1e0901dc176b41b9e0 and fixed in 5.10.235 with commit a32e5198a9134772eb03f7b72a7849094c55bda9
	Issue introduced in 4.16 with commit afbdcc7c384b0d446da08b1e0901dc176b41b9e0 and fixed in 5.15.179 with commit 09d34c4cbc38485c7514069f25348e439555b282
	Issue introduced in 4.16 with commit afbdcc7c384b0d446da08b1e0901dc176b41b9e0 and fixed in 6.1.131 with commit 18ae4cee05c310c299ba75d7477dcf34be67aa16
	Issue introduced in 4.16 with commit afbdcc7c384b0d446da08b1e0901dc176b41b9e0 and fixed in 6.6.83 with commit faac8e894014e8167471a8e4a5eb35a8fefbb82a
	Issue introduced in 4.16 with commit afbdcc7c384b0d446da08b1e0901dc176b41b9e0 and fixed in 6.12.19 with commit 6abf3d8bb51cbaf886c3f08109a0462890b10db6
	Issue introduced in 4.16 with commit afbdcc7c384b0d446da08b1e0901dc176b41b9e0 and fixed in 6.13.7 with commit 0c541c8f6da23e0b92f0a6216d899659a7572074
	Issue introduced in 4.16 with commit afbdcc7c384b0d446da08b1e0901dc176b41b9e0 and fixed in 6.14 with commit dcb0d43ba8eb9517e70b1a0e4b0ae0ab657a0e5a

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-21914
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/slimbus/messaging.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/cec8c0ac173fe5321f03fdb1a09a9cb69bc9a9fe
	https://git.kernel.org/stable/c/a32e5198a9134772eb03f7b72a7849094c55bda9
	https://git.kernel.org/stable/c/09d34c4cbc38485c7514069f25348e439555b282
	https://git.kernel.org/stable/c/18ae4cee05c310c299ba75d7477dcf34be67aa16
	https://git.kernel.org/stable/c/faac8e894014e8167471a8e4a5eb35a8fefbb82a
	https://git.kernel.org/stable/c/6abf3d8bb51cbaf886c3f08109a0462890b10db6
	https://git.kernel.org/stable/c/0c541c8f6da23e0b92f0a6216d899659a7572074
	https://git.kernel.org/stable/c/dcb0d43ba8eb9517e70b1a0e4b0ae0ab657a0e5a
