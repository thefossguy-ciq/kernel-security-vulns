From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-71111: hwmon: (w83791d) Convert macros to functions to avoid TOCTOU

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

hwmon: (w83791d) Convert macros to functions to avoid TOCTOU

The macro FAN_FROM_REG evaluates its arguments multiple times. When used
in lockless contexts involving shared driver data, this leads to
Time-of-Check to Time-of-Use (TOCTOU) race conditions, potentially
causing divide-by-zero errors.

Convert the macro to a static function. This guarantees that arguments
are evaluated only once (pass-by-value), preventing the race
conditions.

Additionally, in store_fan_div, move the calculation of the minimum
limit inside the update lock. This ensures that the read-modify-write
sequence operates on consistent data.

Adhere to the principle of minimal changes by only converting macros
that evaluate arguments multiple times and are used in lockless
contexts.

The Linux kernel CVE team has assigned CVE-2025-71111 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.18 with commit 9873964d6eb24bd0205394f9b791de9eddbcb855 and fixed in 5.10.248 with commit 3dceb68f6ad33156032ef4da21a93d84059cca6d
	Issue introduced in 2.6.18 with commit 9873964d6eb24bd0205394f9b791de9eddbcb855 and fixed in 5.15.198 with commit bf5b03227f2e6d4360004886d268f9df8993ef8f
	Issue introduced in 2.6.18 with commit 9873964d6eb24bd0205394f9b791de9eddbcb855 and fixed in 6.1.160 with commit f2b579a0c37c0df19603d719894a942a295f634a
	Issue introduced in 2.6.18 with commit 9873964d6eb24bd0205394f9b791de9eddbcb855 and fixed in 6.6.120 with commit f94800fbc26ccf7c81eb791707b038a57aa39a18
	Issue introduced in 2.6.18 with commit 9873964d6eb24bd0205394f9b791de9eddbcb855 and fixed in 6.12.64 with commit a9fb6e8835a22f5796c1182ed612daed3fd273af
	Issue introduced in 2.6.18 with commit 9873964d6eb24bd0205394f9b791de9eddbcb855 and fixed in 6.18.3 with commit c8cf0c2bdcccc6634b6915ff793b844e12436680
	Issue introduced in 2.6.18 with commit 9873964d6eb24bd0205394f9b791de9eddbcb855 and fixed in 6.19 with commit 670d7ef945d3a84683594429aea6ab2cdfa5ceb4

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-71111
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/hwmon/w83791d.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/3dceb68f6ad33156032ef4da21a93d84059cca6d
	https://git.kernel.org/stable/c/bf5b03227f2e6d4360004886d268f9df8993ef8f
	https://git.kernel.org/stable/c/f2b579a0c37c0df19603d719894a942a295f634a
	https://git.kernel.org/stable/c/f94800fbc26ccf7c81eb791707b038a57aa39a18
	https://git.kernel.org/stable/c/a9fb6e8835a22f5796c1182ed612daed3fd273af
	https://git.kernel.org/stable/c/c8cf0c2bdcccc6634b6915ff793b844e12436680
	https://git.kernel.org/stable/c/670d7ef945d3a84683594429aea6ab2cdfa5ceb4
