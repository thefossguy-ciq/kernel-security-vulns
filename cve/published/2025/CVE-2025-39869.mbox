From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39869: dmaengine: ti: edma: Fix memory allocation size for queue_priority_map

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

dmaengine: ti: edma: Fix memory allocation size for queue_priority_map

Fix a critical memory allocation bug in edma_setup_from_hw() where
queue_priority_map was allocated with insufficient memory. The code
declared queue_priority_map as s8 (*)[2] (pointer to array of 2 s8),
but allocated memory using sizeof(s8) instead of the correct size.

This caused out-of-bounds memory writes when accessing:
  queue_priority_map[i][0] = i;
  queue_priority_map[i][1] = i;

The bug manifested as kernel crashes with "Oops - undefined instruction"
on ARM platforms (BeagleBoard-X15) during EDMA driver probe, as the
memory corruption triggered kernel hardening features on Clang.

Change the allocation to use sizeof(*queue_priority_map) which
automatically gets the correct size for the 2D array structure.

The Linux kernel CVE team has assigned CVE-2025-39869 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.4 with commit 2b6b3b7420190888793c49e97276e1e73bd7eaed and fixed in 5.4.300 with commit 7d4de60d6db02d9b01d5890d5156b04fad65d07a
	Issue introduced in 4.4 with commit 2b6b3b7420190888793c49e97276e1e73bd7eaed and fixed in 5.10.245 with commit d722de80ce037dccf6931e778f4a46499d51bdf9
	Issue introduced in 4.4 with commit 2b6b3b7420190888793c49e97276e1e73bd7eaed and fixed in 5.15.194 with commit 301a96cc4dc006c9a285913d301e681cfbf7edb6
	Issue introduced in 4.4 with commit 2b6b3b7420190888793c49e97276e1e73bd7eaed and fixed in 6.1.153 with commit 5e462fa0dfdb52b3983cf41532d3d4c7d63e2f93
	Issue introduced in 4.4 with commit 2b6b3b7420190888793c49e97276e1e73bd7eaed and fixed in 6.6.107 with commit 1baed10553fc8b388351d8fc803e3ae6f1a863bc
	Issue introduced in 4.4 with commit 2b6b3b7420190888793c49e97276e1e73bd7eaed and fixed in 6.12.48 with commit 069fd1688c57c0cc8a3de64d108579b31676f74b
	Issue introduced in 4.4 with commit 2b6b3b7420190888793c49e97276e1e73bd7eaed and fixed in 6.16.8 with commit d5e82f3f2c918d446df46e8d65f8083fd97cdec5
	Issue introduced in 4.4 with commit 2b6b3b7420190888793c49e97276e1e73bd7eaed and fixed in 6.17 with commit e63419dbf2ceb083c1651852209c7f048089ac0f

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39869
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/dma/ti/edma.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/7d4de60d6db02d9b01d5890d5156b04fad65d07a
	https://git.kernel.org/stable/c/d722de80ce037dccf6931e778f4a46499d51bdf9
	https://git.kernel.org/stable/c/301a96cc4dc006c9a285913d301e681cfbf7edb6
	https://git.kernel.org/stable/c/5e462fa0dfdb52b3983cf41532d3d4c7d63e2f93
	https://git.kernel.org/stable/c/1baed10553fc8b388351d8fc803e3ae6f1a863bc
	https://git.kernel.org/stable/c/069fd1688c57c0cc8a3de64d108579b31676f74b
	https://git.kernel.org/stable/c/d5e82f3f2c918d446df46e8d65f8083fd97cdec5
	https://git.kernel.org/stable/c/e63419dbf2ceb083c1651852209c7f048089ac0f
