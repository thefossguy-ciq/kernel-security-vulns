From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-23133: wifi: ath11k: update channel list in reg notifier instead reg worker

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

wifi: ath11k: update channel list in reg notifier instead reg worker

Currently when ath11k gets a new channel list, it will be processed
according to the following steps:
1. update new channel list to cfg80211 and queue reg_work.
2. cfg80211 handles new channel list during reg_work.
3. update cfg80211's handled channel list to firmware by
ath11k_reg_update_chan_list().

But ath11k will immediately execute step 3 after reg_work is just
queued. Since step 2 is asynchronous, cfg80211 may not have completed
handling the new channel list, which may leading to an out-of-bounds
write error:
BUG: KASAN: slab-out-of-bounds in ath11k_reg_update_chan_list
Call Trace:
    ath11k_reg_update_chan_list+0xbfe/0xfe0 [ath11k]
    kfree+0x109/0x3a0
    ath11k_regd_update+0x1cf/0x350 [ath11k]
    ath11k_regd_update_work+0x14/0x20 [ath11k]
    process_one_work+0xe35/0x14c0

Should ensure step 2 is completely done before executing step 3. Thus
Wen raised patch[1]. When flag NL80211_REGDOM_SET_BY_DRIVER is set,
cfg80211 will notify ath11k after step 2 is done.

So enable the flag NL80211_REGDOM_SET_BY_DRIVER then cfg80211 will
notify ath11k after step 2 is done. At this time, there will be no
KASAN bug during the execution of the step 3.

[1] https://patchwork.kernel.org/project/linux-wireless/patch/20230201065313.27203-1-quic_wgong@quicinc.com/

Tested-on: WCN6855 hw2.0 PCI WLAN.HSP.1.1-03125-QCAHSPSWPL_V1_V2_SILICONZ_LITE-3

The Linux kernel CVE team has assigned CVE-2025-23133 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.1 with commit f45cb6b29cd36514e13f7519770873d8c0457008 and fixed in 6.12.46 with commit 26618c039b78a76c373d4e02c5fbd52e3a73aead
	Issue introduced in 6.1 with commit f45cb6b29cd36514e13f7519770873d8c0457008 and fixed in 6.14.2 with commit f952fb83c9c6f908d27500764c4aee1df04b9d3f
	Issue introduced in 6.1 with commit f45cb6b29cd36514e13f7519770873d8c0457008 and fixed in 6.15 with commit 933ab187e679e6fbdeea1835ae39efcc59c022d2
	Issue introduced in 5.15.79 with commit f96fd36936310cefe0ea1370a9ae30e6746e6f62
	Issue introduced in 6.0.9 with commit c97b120950b49d76bdce013bd4d9577d769465f4

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-23133
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/wireless/ath/ath11k/reg.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/26618c039b78a76c373d4e02c5fbd52e3a73aead
	https://git.kernel.org/stable/c/f952fb83c9c6f908d27500764c4aee1df04b9d3f
	https://git.kernel.org/stable/c/933ab187e679e6fbdeea1835ae39efcc59c022d2
