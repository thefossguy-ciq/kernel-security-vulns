From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38212: ipc: fix to protect IPCS lookups using RCU
Message-Id: <2025070422-CVE-2025-38212-5bd9@gregkh>
Content-Length: 3711
Lines: 71
X-Developer-Signature: v=1; a=openpgp-sha256; l=3783;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=/lGdGs90HoW2MAlUqGcIS2hGv/9YoRvlll3jURNz1Vo=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBnpN4U+/ti9h/HSOXHhtwJG3/POT3mSVXB37QmlRXOuP
 zlpapIypyOWhUGQiUFWTJHlyzaeo/srDil6GdqehpnDygQyhIGLUwAmIhbMsGD734ta31KkPnLU
 RUlduqAf991iDiPDPMuN55rT/+02c2iwvXRUc6dTWG34YQA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ipc: fix to protect IPCS lookups using RCU

syzbot reported that it discovered a use-after-free vulnerability, [0]

[0]: https://lore.kernel.org/all/67af13f8.050a0220.21dd3.0038.GAE@google.com/

idr_for_each() is protected by rwsem, but this is not enough.  If it is
not protected by RCU read-critical region, when idr_for_each() calls
radix_tree_node_free() through call_rcu() to free the radix_tree_node
structure, the node will be freed immediately, and when reading the next
node in radix_tree_for_each_slot(), the already freed memory may be read.

Therefore, we need to add code to make sure that idr_for_each() is
protected within the RCU read-critical region when we call it in
shm_destroy_orphaned().

The Linux kernel CVE team has assigned CVE-2025-38212 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.1 with commit b34a6b1da371ed8af1221459a18c67970f7e3d53 and fixed in 5.4.295 with commit 5f1e1573bf103303944fd7225559de5d8297539c
	Issue introduced in 3.1 with commit b34a6b1da371ed8af1221459a18c67970f7e3d53 and fixed in 5.10.239 with commit b968ba8bfd9f90914957bbbd815413bf6a98eca7
	Issue introduced in 3.1 with commit b34a6b1da371ed8af1221459a18c67970f7e3d53 and fixed in 5.15.186 with commit 74bc813d11c30e28fc5261dc877cca662ccfac68
	Issue introduced in 3.1 with commit b34a6b1da371ed8af1221459a18c67970f7e3d53 and fixed in 6.1.142 with commit 78297d53d3878d43c1d627d20cd09f611fa4b91d
	Issue introduced in 3.1 with commit b34a6b1da371ed8af1221459a18c67970f7e3d53 and fixed in 6.6.95 with commit 5180561afff8e0f029073c8c8117c95c6512d1f9
	Issue introduced in 3.1 with commit b34a6b1da371ed8af1221459a18c67970f7e3d53 and fixed in 6.12.35 with commit 68c173ea138b66d7dd1fd980c9bc578a18e11884
	Issue introduced in 3.1 with commit b34a6b1da371ed8af1221459a18c67970f7e3d53 and fixed in 6.15.4 with commit b0b6bf90ce2699a574b3683e22c44d0dcdd7a057
	Issue introduced in 3.1 with commit b34a6b1da371ed8af1221459a18c67970f7e3d53 and fixed in 6.16-rc1 with commit d66adabe91803ef34a8b90613c81267b5ded1472

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38212
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	ipc/shm.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/5f1e1573bf103303944fd7225559de5d8297539c
	https://git.kernel.org/stable/c/b968ba8bfd9f90914957bbbd815413bf6a98eca7
	https://git.kernel.org/stable/c/74bc813d11c30e28fc5261dc877cca662ccfac68
	https://git.kernel.org/stable/c/78297d53d3878d43c1d627d20cd09f611fa4b91d
	https://git.kernel.org/stable/c/5180561afff8e0f029073c8c8117c95c6512d1f9
	https://git.kernel.org/stable/c/68c173ea138b66d7dd1fd980c9bc578a18e11884
	https://git.kernel.org/stable/c/b0b6bf90ce2699a574b3683e22c44d0dcdd7a057
	https://git.kernel.org/stable/c/d66adabe91803ef34a8b90613c81267b5ded1472
