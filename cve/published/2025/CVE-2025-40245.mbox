From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-40245: nios2: ensure that memblock.current_limit is set when setting pfn limits

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

nios2: ensure that memblock.current_limit is set when setting pfn limits

On nios2, with CONFIG_FLATMEM set, the kernel relies on
memblock_get_current_limit() to determine the limits of mem_map, in
particular for max_low_pfn.
Unfortunately, memblock.current_limit is only default initialized to
MEMBLOCK_ALLOC_ANYWHERE at this point of the bootup, potentially leading
to situations where max_low_pfn can erroneously exceed the value of
max_pfn and, thus, the valid range of available DRAM.

This can in turn cause kernel-level paging failures, e.g.:

[   76.900000] Unable to handle kernel paging request at virtual address 20303000
[   76.900000] ea = c0080890, ra = c000462c, cause = 14
[   76.900000] Kernel panic - not syncing: Oops
[   76.900000] ---[ end Kernel panic - not syncing: Oops ]---

This patch fixes this by pre-calculating memblock.current_limit
based on the upper limits of the available memory ranges via
adjust_lowmem_bounds, a simplified version of the equivalent
implementation within the arm architecture.

The Linux kernel CVE team has assigned CVE-2025-40245 to this issue.


Affected and fixed versions
===========================

	Fixed in 5.15.196 with commit 25f09699edd360b534ccae16bc276c3b52c471f3
	Fixed in 6.1.158 with commit 5c3e38a367822f036227dd52bac82dc4a05157e2
	Fixed in 6.6.115 with commit b1ec9faef7e36269ca3ec890972a78effbaeb975
	Fixed in 6.12.56 with commit 90f5f715550e07cd6a51f80fc3f062d832c8c997
	Fixed in 6.17.6 with commit 8912814f14e298b83df072fecc1f7ed1b63b1b2c
	Fixed in 6.18 with commit a20b83cf45be2057f3d073506779e52c7fa17f94

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-40245
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	arch/nios2/kernel/setup.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/25f09699edd360b534ccae16bc276c3b52c471f3
	https://git.kernel.org/stable/c/5c3e38a367822f036227dd52bac82dc4a05157e2
	https://git.kernel.org/stable/c/b1ec9faef7e36269ca3ec890972a78effbaeb975
	https://git.kernel.org/stable/c/90f5f715550e07cd6a51f80fc3f062d832c8c997
	https://git.kernel.org/stable/c/8912814f14e298b83df072fecc1f7ed1b63b1b2c
	https://git.kernel.org/stable/c/a20b83cf45be2057f3d073506779e52c7fa17f94
