From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-37842: spi: fsl-qspi: use devm function instead of driver remove

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

spi: fsl-qspi: use devm function instead of driver remove

Driver use devm APIs to manage clk/irq/resources and register the spi
controller, but the legacy remove function will be called first during
device detach and trigger kernel panic. Drop the remove function and use
devm_add_action_or_reset() for driver cleanup to ensure the release
sequence.

Trigger kernel panic on i.MX8MQ by
echo 30bb0000.spi >/sys/bus/platform/drivers/fsl-quadspi/unbind

The Linux kernel CVE team has assigned CVE-2025-37842 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.2 with commit 8fcb830a00f0980ffe38d223cdd9a4d2d24da476 and fixed in 6.13.12 with commit 439688dbe82baa10d4430dc3252bb5ef1183a171
	Issue introduced in 5.2 with commit 8fcb830a00f0980ffe38d223cdd9a4d2d24da476 and fixed in 6.14.3 with commit f9bfb3a5f6f616f3eb7665c8ff3bcb9760ae33c8
	Issue introduced in 5.2 with commit 8fcb830a00f0980ffe38d223cdd9a4d2d24da476 and fixed in 6.15-rc1 with commit 40369bfe717e96e26650eeecfa5a6363563df6e4

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-37842
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/spi/spi-fsl-qspi.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/439688dbe82baa10d4430dc3252bb5ef1183a171
	https://git.kernel.org/stable/c/f9bfb3a5f6f616f3eb7665c8ff3bcb9760ae33c8
	https://git.kernel.org/stable/c/40369bfe717e96e26650eeecfa5a6363563df6e4
