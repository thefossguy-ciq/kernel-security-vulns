From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38696: MIPS: Don't crash in stack_top() for tasks without ABI or vDSO

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

MIPS: Don't crash in stack_top() for tasks without ABI or vDSO

Not all tasks have an ABI associated or vDSO mapped,
for example kthreads never do.
If such a task ever ends up calling stack_top(), it will derefence the
NULL ABI pointer and crash.

This can for example happen when using kunit:

    mips_stack_top+0x28/0xc0
    arch_pick_mmap_layout+0x190/0x220
    kunit_vm_mmap_init+0xf8/0x138
    __kunit_add_resource+0x40/0xa8
    kunit_vm_mmap+0x88/0xd8
    usercopy_test_init+0xb8/0x240
    kunit_try_run_case+0x5c/0x1a8
    kunit_generic_run_threadfn_adapter+0x28/0x50
    kthread+0x118/0x240
    ret_from_kernel_thread+0x14/0x1c

Only dereference the ABI point if it is set.

The GIC page is also included as it is specific to the vDSO.
Also move the randomization adjustment into the same conditional.

The Linux kernel CVE team has assigned CVE-2025-38696 to this issue.


Affected and fixed versions
===========================

	Fixed in 5.4.297 with commit ab18e48a503230d675e824a0d68a108bdff42503
	Fixed in 5.10.241 with commit e78033e59444d257d095b73ce5d20625294f6ec2
	Fixed in 5.15.190 with commit bd90dbd196831f5c2620736dc221db2634cf1e8e
	Fixed in 6.1.149 with commit 5b6839b572b503609b9b58bc6c04a816eefa0794
	Fixed in 6.6.103 with commit f22de2027b206ddfb8a075800bb5d0dacf2da4b8
	Fixed in 6.12.43 with commit 82d140f6aab5e89a9d3972697a0dbe1498752d9b
	Fixed in 6.15.11 with commit 24d098b6f69b0aa806ffcb3e18259bee31650b28
	Fixed in 6.16.2 with commit cddf47d20b0325dc8a4e57b833fe96e8f36c42a4
	Fixed in 6.17-rc1 with commit e9f4a6b3421e936c3ee9d74710243897d74dbaa2

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38696
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	arch/mips/kernel/process.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/ab18e48a503230d675e824a0d68a108bdff42503
	https://git.kernel.org/stable/c/e78033e59444d257d095b73ce5d20625294f6ec2
	https://git.kernel.org/stable/c/bd90dbd196831f5c2620736dc221db2634cf1e8e
	https://git.kernel.org/stable/c/5b6839b572b503609b9b58bc6c04a816eefa0794
	https://git.kernel.org/stable/c/f22de2027b206ddfb8a075800bb5d0dacf2da4b8
	https://git.kernel.org/stable/c/82d140f6aab5e89a9d3972697a0dbe1498752d9b
	https://git.kernel.org/stable/c/24d098b6f69b0aa806ffcb3e18259bee31650b28
	https://git.kernel.org/stable/c/cddf47d20b0325dc8a4e57b833fe96e8f36c42a4
	https://git.kernel.org/stable/c/e9f4a6b3421e936c3ee9d74710243897d74dbaa2
