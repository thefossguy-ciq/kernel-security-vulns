From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38146: net: openvswitch: Fix the dead loop of MPLS parse

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net: openvswitch: Fix the dead loop of MPLS parse

The unexpected MPLS packet may not end with the bottom label stack.
When there are many stacks, The label count value has wrapped around.
A dead loop occurs, soft lockup/CPU stuck finally.

stack backtrace:
UBSAN: array-index-out-of-bounds in /build/linux-0Pa0xK/linux-5.15.0/net/openvswitch/flow.c:662:26
index -1 is out of range for type '__be32 [3]'
CPU: 34 PID: 0 Comm: swapper/34 Kdump: loaded Tainted: G           OE   5.15.0-121-generic #131-Ubuntu
Hardware name: Dell Inc. PowerEdge C6420/0JP9TF, BIOS 2.12.2 07/14/2021
Call Trace:
 <IRQ>
 show_stack+0x52/0x5c
 dump_stack_lvl+0x4a/0x63
 dump_stack+0x10/0x16
 ubsan_epilogue+0x9/0x36
 __ubsan_handle_out_of_bounds.cold+0x44/0x49
 key_extract_l3l4+0x82a/0x840 [openvswitch]
 ? kfree_skbmem+0x52/0xa0
 key_extract+0x9c/0x2b0 [openvswitch]
 ovs_flow_key_extract+0x124/0x350 [openvswitch]
 ovs_vport_receive+0x61/0xd0 [openvswitch]
 ? kernel_init_free_pages.part.0+0x4a/0x70
 ? get_page_from_freelist+0x353/0x540
 netdev_port_receive+0xc4/0x180 [openvswitch]
 ? netdev_port_receive+0x180/0x180 [openvswitch]
 netdev_frame_hook+0x1f/0x40 [openvswitch]
 __netif_receive_skb_core.constprop.0+0x23a/0xf00
 __netif_receive_skb_list_core+0xfa/0x240
 netif_receive_skb_list_internal+0x18e/0x2a0
 napi_complete_done+0x7a/0x1c0
 bnxt_poll+0x155/0x1c0 [bnxt_en]
 __napi_poll+0x30/0x180
 net_rx_action+0x126/0x280
 ? bnxt_msix+0x67/0x80 [bnxt_en]
 handle_softirqs+0xda/0x2d0
 irq_exit_rcu+0x96/0xc0
 common_interrupt+0x8e/0xa0
 </IRQ>

The Linux kernel CVE team has assigned CVE-2025-38146 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.5 with commit fbdcdd78da7c95f1b970d371e1b23cbd3aa990f3 and fixed in 5.10.239 with commit 4b9a086eedc1fddae632310386098c12155e3d0a
	Issue introduced in 5.5 with commit fbdcdd78da7c95f1b970d371e1b23cbd3aa990f3 and fixed in 5.15.186 with commit ad17eb86d042d72a59fd184ad1adf34f5eb36843
	Issue introduced in 5.5 with commit fbdcdd78da7c95f1b970d371e1b23cbd3aa990f3 and fixed in 6.1.142 with commit f26fe7c3002516dd3c288f1012786df31f4d89e0
	Issue introduced in 5.5 with commit fbdcdd78da7c95f1b970d371e1b23cbd3aa990f3 and fixed in 6.6.94 with commit 8ebcd311b4866ab911d1445ead08690e67f0c488
	Issue introduced in 5.5 with commit fbdcdd78da7c95f1b970d371e1b23cbd3aa990f3 and fixed in 6.12.34 with commit 69541e58323ec3e3904e1fa87a6213961b1f52f4
	Issue introduced in 5.5 with commit fbdcdd78da7c95f1b970d371e1b23cbd3aa990f3 and fixed in 6.15.3 with commit 3c1906a3d50cb94fd0a10e97a1c0a40c0f033cb7
	Issue introduced in 5.5 with commit fbdcdd78da7c95f1b970d371e1b23cbd3aa990f3 and fixed in 6.16-rc1 with commit 0bdc924bfb319fb10d1113cbf091fc26fb7b1f99

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38146
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/openvswitch/flow.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/4b9a086eedc1fddae632310386098c12155e3d0a
	https://git.kernel.org/stable/c/ad17eb86d042d72a59fd184ad1adf34f5eb36843
	https://git.kernel.org/stable/c/f26fe7c3002516dd3c288f1012786df31f4d89e0
	https://git.kernel.org/stable/c/8ebcd311b4866ab911d1445ead08690e67f0c488
	https://git.kernel.org/stable/c/69541e58323ec3e3904e1fa87a6213961b1f52f4
	https://git.kernel.org/stable/c/3c1906a3d50cb94fd0a10e97a1c0a40c0f033cb7
	https://git.kernel.org/stable/c/0bdc924bfb319fb10d1113cbf091fc26fb7b1f99
