From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38659: gfs2: No more self recovery

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

gfs2: No more self recovery

When a node withdraws and it turns out that it is the only node that has
the filesystem mounted, gfs2 currently tries to replay the local journal
to bring the filesystem back into a consistent state.  Not only is that
a very bad idea, it has also never worked because gfs2_recover_func()
will refuse to do anything during a withdraw.

However, before even getting to this point, gfs2_recover_func()
dereferences sdp->sd_jdesc->jd_inode.  This was a use-after-free before
commit 04133b607a78 ("gfs2: Prevent double iput for journal on error")
and is a NULL pointer dereference since then.

Simply get rid of self recovery to fix that.

The Linux kernel CVE team has assigned CVE-2025-38659 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.7 with commit 601ef0d52e9617588fcff3df26953592f2eb44ac and fixed in 6.6.102 with commit 1a91ba12abef628b43cada87478328274d988e88
	Issue introduced in 5.7 with commit 601ef0d52e9617588fcff3df26953592f2eb44ac and fixed in 6.12.42 with commit f5426ffbec971a8f7346a57392d3a901bdee5a9b
	Issue introduced in 5.7 with commit 601ef0d52e9617588fcff3df26953592f2eb44ac and fixed in 6.15.10 with commit 6784367b2f3cd7b89103de35764f37f152590dbd
	Issue introduced in 5.7 with commit 601ef0d52e9617588fcff3df26953592f2eb44ac and fixed in 6.16.1 with commit 97c94c7dbddc34d353c83b541b3decabf98d04af
	Issue introduced in 5.7 with commit 601ef0d52e9617588fcff3df26953592f2eb44ac and fixed in 6.17 with commit deb016c1669002e48c431d6fd32ea1c20ef41756

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38659
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/gfs2/util.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/1a91ba12abef628b43cada87478328274d988e88
	https://git.kernel.org/stable/c/f5426ffbec971a8f7346a57392d3a901bdee5a9b
	https://git.kernel.org/stable/c/6784367b2f3cd7b89103de35764f37f152590dbd
	https://git.kernel.org/stable/c/97c94c7dbddc34d353c83b541b3decabf98d04af
	https://git.kernel.org/stable/c/deb016c1669002e48c431d6fd32ea1c20ef41756
