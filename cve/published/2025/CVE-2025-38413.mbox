From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38413: virtio-net: xsk: rx: fix the frame's length check

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

virtio-net: xsk: rx: fix the frame's length check

When calling buf_to_xdp, the len argument is the frame data's length
without virtio header's length (vi->hdr_len). We check that len with

	xsk_pool_get_rx_frame_size() + vi->hdr_len

to ensure the provided len does not larger than the allocated chunk
size. The additional vi->hdr_len is because in virtnet_add_recvbuf_xsk,
we use part of XDP_PACKET_HEADROOM for virtio header and ask the vhost
to start placing data from

	hard_start + XDP_PACKET_HEADROOM - vi->hdr_len
not
	hard_start + XDP_PACKET_HEADROOM

But the first buffer has virtio_header, so the maximum frame's length in
the first buffer can only be

	xsk_pool_get_rx_frame_size()
not
	xsk_pool_get_rx_frame_size() + vi->hdr_len

like in the current check.

This commit adds an additional argument to buf_to_xdp differentiate
between the first buffer and other ones to correctly calculate the maximum
frame's length.

The Linux kernel CVE team has assigned CVE-2025-38413 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.11 with commit a4e7ba7027012f009f22a68bcfde670f9298d3a4 and fixed in 6.12.37 with commit 892f6ed9a4a38bb3360fdff091b9241cfa105b61
	Issue introduced in 6.11 with commit a4e7ba7027012f009f22a68bcfde670f9298d3a4 and fixed in 6.15.6 with commit 6013bb6bc24c2cac3f45b37a15b71b232a5b00ff
	Issue introduced in 6.11 with commit a4e7ba7027012f009f22a68bcfde670f9298d3a4 and fixed in 6.16 with commit 5177373c31318c3c6a190383bfd232e6cf565c36

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38413
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/virtio_net.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/892f6ed9a4a38bb3360fdff091b9241cfa105b61
	https://git.kernel.org/stable/c/6013bb6bc24c2cac3f45b37a15b71b232a5b00ff
	https://git.kernel.org/stable/c/5177373c31318c3c6a190383bfd232e6cf565c36
