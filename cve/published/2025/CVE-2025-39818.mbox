From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39818: HID: intel-thc-hid: intel-thc: Fix incorrect pointer arithmetic in I2C regs save
Message-Id: <2025091615-CVE-2025-39818-f1b9@gregkh>
Content-Length: 3191
Lines: 82
X-Developer-Signature: v=1; a=openpgp-sha256; l=3274;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=KjI41xzwO1mbMkOvtJ929m66DTTWZQ50Rd1tUtTWbYc=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBkn4+MDLpuqds/61OjNkeR7prFYeeMP6b2LXvaGfOee3
 fPdr0m9I5aFQZCJQVZMkeXLNp6j+ysOKXoZ2p6GmcPKBDKEgYtTACbSuJJhwbK+GQYszeEhHyUO
 1nD+/VkrMn+vOcOCNTyOj1M1RV0UPTvqGvODGwxjJ6kCAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

HID: intel-thc-hid: intel-thc: Fix incorrect pointer arithmetic in I2C regs save

Improper use of secondary pointer (&dev->i2c_subip_regs) caused
kernel crash and out-of-bounds error:

 BUG: KASAN: slab-out-of-bounds in _regmap_bulk_read+0x449/0x510
 Write of size 4 at addr ffff888136005dc0 by task kworker/u33:5/5107

 CPU: 3 UID: 0 PID: 5107 Comm: kworker/u33:5 Not tainted 6.16.0+ #3 PREEMPT(voluntary)
 Workqueue: async async_run_entry_fn
 Call Trace:
  <TASK>
  dump_stack_lvl+0x76/0xa0
  print_report+0xd1/0x660
  ? __pfx__raw_spin_lock_irqsave+0x10/0x10
  ? kasan_complete_mode_report_info+0x26/0x200
  kasan_report+0xe1/0x120
  ? _regmap_bulk_read+0x449/0x510
  ? _regmap_bulk_read+0x449/0x510
  __asan_report_store4_noabort+0x17/0x30
  _regmap_bulk_read+0x449/0x510
  ? __pfx__regmap_bulk_read+0x10/0x10
  regmap_bulk_read+0x270/0x3d0
  pio_complete+0x1ee/0x2c0 [intel_thc]
  ? __pfx_pio_complete+0x10/0x10 [intel_thc]
  ? __pfx_pio_wait+0x10/0x10 [intel_thc]
  ? regmap_update_bits_base+0x13b/0x1f0
  thc_i2c_subip_pio_read+0x117/0x270 [intel_thc]
  thc_i2c_subip_regs_save+0xc2/0x140 [intel_thc]
  ? __pfx_thc_i2c_subip_regs_save+0x10/0x10 [intel_thc]
[...]
 The buggy address belongs to the object at ffff888136005d00
  which belongs to the cache kmalloc-rnd-12-192 of size 192
 The buggy address is located 0 bytes to the right of
  allocated 192-byte region [ffff888136005d00, ffff888136005dc0)

Replaced with direct array indexing (&dev->i2c_subip_regs[i]) to ensure
safe memory access.

The Linux kernel CVE team has assigned CVE-2025-39818 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.14 with commit 4228966def884c6e34b85cdc7118c5d013e1718f and fixed in 6.16.5 with commit 78d4cf0466c79452e47aa6f720afbde63e709ccc
	Issue introduced in 6.14 with commit 4228966def884c6e34b85cdc7118c5d013e1718f and fixed in 6.17-rc4 with commit a7fc15ed629be89e51e09b743277c53e0a0168f5

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39818
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/hid/intel-thc-hid/intel-thc/intel-thc-dev.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/78d4cf0466c79452e47aa6f720afbde63e709ccc
	https://git.kernel.org/stable/c/a7fc15ed629be89e51e09b743277c53e0a0168f5
