From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-37859: page_pool: avoid infinite loop to schedule delayed worker
Message-Id: <2025050922-CVE-2025-37859-cf97@gregkh>
Content-Length: 3790
Lines: 87
X-Developer-Signature: v=1; a=openpgp-sha256; l=3878;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=tA/W0Y2k97dm4aCQH6vzl6SQEoek3ahVCzwcxSxvgQw=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBmyi8+V6/E8sXGoFnbXKS1ezXjdsLxdwT3VhZnz5Ndvu
 9qyL2R0xLIwCDIxyIopsnzZxnN0f8UhRS9D29Mwc1iZQIYwcHEKwEReTGSYK1kz7cJRi6p9U1Uy
 VybL6XuW7WdZzrCg//aM26Zny/2LKmYli6h/XzX5n9oXAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

page_pool: avoid infinite loop to schedule delayed worker

We noticed the kworker in page_pool_release_retry() was waken
up repeatedly and infinitely in production because of the
buggy driver causing the inflight less than 0 and warning
us in page_pool_inflight()[1].

Since the inflight value goes negative, it means we should
not expect the whole page_pool to get back to work normally.

This patch mitigates the adverse effect by not rescheduling
the kworker when detecting the inflight negative in
page_pool_release_retry().

[1]
[Mon Feb 10 20:36:11 2025] ------------[ cut here ]------------
[Mon Feb 10 20:36:11 2025] Negative(-51446) inflight packet-pages
...
[Mon Feb 10 20:36:11 2025] Call Trace:
[Mon Feb 10 20:36:11 2025]  page_pool_release_retry+0x23/0x70
[Mon Feb 10 20:36:11 2025]  process_one_work+0x1b1/0x370
[Mon Feb 10 20:36:11 2025]  worker_thread+0x37/0x3a0
[Mon Feb 10 20:36:11 2025]  kthread+0x11a/0x140
[Mon Feb 10 20:36:11 2025]  ? process_one_work+0x370/0x370
[Mon Feb 10 20:36:11 2025]  ? __kthread_cancel_work+0x40/0x40
[Mon Feb 10 20:36:11 2025]  ret_from_fork+0x35/0x40
[Mon Feb 10 20:36:11 2025] ---[ end trace ebffe800f33e7e34 ]---
Note: before this patch, the above calltrace would flood the
dmesg due to repeated reschedule of release_dw kworker.

The Linux kernel CVE team has assigned CVE-2025-37859 to this issue.


Affected and fixed versions
===========================

	Fixed in 5.4.293 with commit c3c7c57017ce1d4b2d3788c1fc59e7e39026e158
	Fixed in 5.10.237 with commit 9f71db4fb82deb889e0bac4a51b34daea7d506a3
	Fixed in 5.15.181 with commit 91522aba56e9fcdf64da25ffef9b27f8fad48e0f
	Fixed in 6.1.135 with commit 90e089a64504982f8d62f223027cb9f903781f78
	Fixed in 6.6.88 with commit 95f17738b86fd198924d874a5639bcdc49c7e5b8
	Fixed in 6.12.24 with commit 7204335d1991c23fc615ab76f31f175748a578e1
	Fixed in 6.13.12 with commit e74e5aa33228c5e2cb4fc80ad103541a7b7805ec
	Fixed in 6.14.3 with commit 738d1812ec2e395e953258aea912ddd867d11a13
	Fixed in 6.15-rc1 with commit 43130d02baa137033c25297aaae95fd0edc41654

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-37859
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/core/page_pool.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/c3c7c57017ce1d4b2d3788c1fc59e7e39026e158
	https://git.kernel.org/stable/c/9f71db4fb82deb889e0bac4a51b34daea7d506a3
	https://git.kernel.org/stable/c/91522aba56e9fcdf64da25ffef9b27f8fad48e0f
	https://git.kernel.org/stable/c/90e089a64504982f8d62f223027cb9f903781f78
	https://git.kernel.org/stable/c/95f17738b86fd198924d874a5639bcdc49c7e5b8
	https://git.kernel.org/stable/c/7204335d1991c23fc615ab76f31f175748a578e1
	https://git.kernel.org/stable/c/e74e5aa33228c5e2cb4fc80ad103541a7b7805ec
	https://git.kernel.org/stable/c/738d1812ec2e395e953258aea912ddd867d11a13
	https://git.kernel.org/stable/c/43130d02baa137033c25297aaae95fd0edc41654
