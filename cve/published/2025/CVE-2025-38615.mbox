From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38615: fs/ntfs3: cancle set bad inode after removing name fails

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

fs/ntfs3: cancle set bad inode after removing name fails

The reproducer uses a file0 on a ntfs3 file system with a corrupted i_link.
When renaming, the file0's inode is marked as a bad inode because the file
name cannot be deleted.

The underlying bug is that make_bad_inode() is called on a live inode.
In some cases it's "icache lookup finds a normal inode, d_splice_alias()
is called to attach it to dentry, while another thread decides to call
make_bad_inode() on it - that would evict it from icache, but we'd already
found it there earlier".
In some it's outright "we have an inode attached to dentry - that's how we
got it in the first place; let's call make_bad_inode() on it just for shits
and giggles".

The Linux kernel CVE team has assigned CVE-2025-38615 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.15 with commit 78ab59fee07f22464f32eafebab2bd97ba94ff2d and fixed in 6.6.102 with commit b35a50d639ca5259466ef5fea85529bb4fb17d5b
	Issue introduced in 5.15 with commit 78ab59fee07f22464f32eafebab2bd97ba94ff2d and fixed in 6.12.42 with commit 3ed2cc6a6e93fbeb8c0cafce1e7fb1f64a331dcc
	Issue introduced in 5.15 with commit 78ab59fee07f22464f32eafebab2bd97ba94ff2d and fixed in 6.15.10 with commit 358d4f821c03add421a4c49290538a705852ccf1
	Issue introduced in 5.15 with commit 78ab59fee07f22464f32eafebab2bd97ba94ff2d and fixed in 6.16.1 with commit a285395020780adac1ffbc844069c3d700bf007a
	Issue introduced in 5.15 with commit 78ab59fee07f22464f32eafebab2bd97ba94ff2d and fixed in 6.17 with commit d99208b91933fd2a58ed9ed321af07dacd06ddc3

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38615
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/ntfs3/frecord.c
	fs/ntfs3/namei.c
	fs/ntfs3/ntfs_fs.h


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/b35a50d639ca5259466ef5fea85529bb4fb17d5b
	https://git.kernel.org/stable/c/3ed2cc6a6e93fbeb8c0cafce1e7fb1f64a331dcc
	https://git.kernel.org/stable/c/358d4f821c03add421a4c49290538a705852ccf1
	https://git.kernel.org/stable/c/a285395020780adac1ffbc844069c3d700bf007a
	https://git.kernel.org/stable/c/d99208b91933fd2a58ed9ed321af07dacd06ddc3
