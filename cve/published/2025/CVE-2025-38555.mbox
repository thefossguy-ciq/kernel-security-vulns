From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38555: usb: gadget : fix use-after-free in composite_dev_cleanup()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

usb: gadget : fix use-after-free in composite_dev_cleanup()

1. In func configfs_composite_bind() -> composite_os_desc_req_prepare():
if kmalloc fails, the pointer cdev->os_desc_req will be freed but not
set to NULL. Then it will return a failure to the upper-level function.
2. in func configfs_composite_bind() -> composite_dev_cleanup():
it will checks whether cdev->os_desc_req is NULL. If it is not NULL, it
will attempt to use it.This will lead to a use-after-free issue.

BUG: KASAN: use-after-free in composite_dev_cleanup+0xf4/0x2c0
Read of size 8 at addr 0000004827837a00 by task init/1

CPU: 10 PID: 1 Comm: init Tainted: G           O      5.10.97-oh #1
 kasan_report+0x188/0x1cc
 __asan_load8+0xb4/0xbc
 composite_dev_cleanup+0xf4/0x2c0
 configfs_composite_bind+0x210/0x7ac
 udc_bind_to_driver+0xb4/0x1ec
 usb_gadget_probe_driver+0xec/0x21c
 gadget_dev_desc_UDC_store+0x264/0x27c

The Linux kernel CVE team has assigned CVE-2025-38555 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.16 with commit 37a3a533429ef9b3cc9f15a656c19623f0e88df7 and fixed in 6.1.148 with commit e624bf26127645a2f7821e73fdf6dc64bad07835
	Issue introduced in 3.16 with commit 37a3a533429ef9b3cc9f15a656c19623f0e88df7 and fixed in 6.6.102 with commit aada327a9f8028c573636fa60c0abc80fb8135c9
	Issue introduced in 3.16 with commit 37a3a533429ef9b3cc9f15a656c19623f0e88df7 and fixed in 6.12.42 with commit 5f06ee9f9a3665d43133f125c17e5258a13f3963
	Issue introduced in 3.16 with commit 37a3a533429ef9b3cc9f15a656c19623f0e88df7 and fixed in 6.15.10 with commit bd3c4ef60baf7f65c963f3e12d9d7b2b091e20ba
	Issue introduced in 3.16 with commit 37a3a533429ef9b3cc9f15a656c19623f0e88df7 and fixed in 6.16.1 with commit e1be1f380c82a69f80c68c96a7cfe8759fb30355
	Issue introduced in 3.16 with commit 37a3a533429ef9b3cc9f15a656c19623f0e88df7 and fixed in 6.17-rc1 with commit 151c0aa896c47a4459e07fee7d4843f44c1bb18e

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38555
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/usb/gadget/composite.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/e624bf26127645a2f7821e73fdf6dc64bad07835
	https://git.kernel.org/stable/c/aada327a9f8028c573636fa60c0abc80fb8135c9
	https://git.kernel.org/stable/c/5f06ee9f9a3665d43133f125c17e5258a13f3963
	https://git.kernel.org/stable/c/bd3c4ef60baf7f65c963f3e12d9d7b2b091e20ba
	https://git.kernel.org/stable/c/e1be1f380c82a69f80c68c96a7cfe8759fb30355
	https://git.kernel.org/stable/c/151c0aa896c47a4459e07fee7d4843f44c1bb18e
