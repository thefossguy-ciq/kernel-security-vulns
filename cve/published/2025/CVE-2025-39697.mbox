From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39697: NFS: Fix a race when updating an existing write

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

NFS: Fix a race when updating an existing write

After nfs_lock_and_join_requests() tests for whether the request is
still attached to the mapping, nothing prevents a call to
nfs_inode_remove_request() from succeeding until we actually lock the
page group.
The reason is that whoever called nfs_inode_remove_request() doesn't
necessarily have a lock on the page group head.

So in order to avoid races, let's take the page group lock earlier in
nfs_lock_and_join_requests(), and hold it across the removal of the
request in nfs_inode_remove_request().

The Linux kernel CVE team has assigned CVE-2025-39697 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.14 with commit bd37d6fce184836bd5e7cd90ce40116a4fadaf2a and fixed in 5.10.242 with commit 0ff42a32784e0f2cb46a46da8e9f473538c13e1b
	Issue introduced in 4.14 with commit bd37d6fce184836bd5e7cd90ce40116a4fadaf2a and fixed in 5.15.191 with commit f230d40147cc37eb3aef4d50e2e2c06ea73d9a77
	Issue introduced in 4.14 with commit bd37d6fce184836bd5e7cd90ce40116a4fadaf2a and fixed in 6.1.150 with commit c32e3c71aaa1c1ba05da88605e2ddd493c58794f
	Issue introduced in 4.14 with commit bd37d6fce184836bd5e7cd90ce40116a4fadaf2a and fixed in 6.6.104 with commit 181feb41f0b268e6288bf9a7b984624d7fe2031d
	Issue introduced in 4.14 with commit bd37d6fce184836bd5e7cd90ce40116a4fadaf2a and fixed in 6.12.44 with commit 92278ae36935a54e65fef9f8ea8efe7e80481ace
	Issue introduced in 4.14 with commit bd37d6fce184836bd5e7cd90ce40116a4fadaf2a and fixed in 6.16.4 with commit 202a3432d21ac060629a760fff3b0a39859da3ea
	Issue introduced in 4.14 with commit bd37d6fce184836bd5e7cd90ce40116a4fadaf2a and fixed in 6.17 with commit 76d2e3890fb169168c73f2e4f8375c7cc24a765e

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39697
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/nfs/pagelist.c
	fs/nfs/write.c
	include/linux/nfs_page.h


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/0ff42a32784e0f2cb46a46da8e9f473538c13e1b
	https://git.kernel.org/stable/c/f230d40147cc37eb3aef4d50e2e2c06ea73d9a77
	https://git.kernel.org/stable/c/c32e3c71aaa1c1ba05da88605e2ddd493c58794f
	https://git.kernel.org/stable/c/181feb41f0b268e6288bf9a7b984624d7fe2031d
	https://git.kernel.org/stable/c/92278ae36935a54e65fef9f8ea8efe7e80481ace
	https://git.kernel.org/stable/c/202a3432d21ac060629a760fff3b0a39859da3ea
	https://git.kernel.org/stable/c/76d2e3890fb169168c73f2e4f8375c7cc24a765e
