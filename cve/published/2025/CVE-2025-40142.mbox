From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-40142: ALSA: pcm: Disable bottom softirqs as part of spin_lock_irq() on PREEMPT_RT

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ALSA: pcm: Disable bottom softirqs as part of spin_lock_irq() on PREEMPT_RT

snd_pcm_group_lock_irq() acquires a spinlock_t and disables interrupts
via spin_lock_irq(). This also implicitly disables the handling of
softirqs such as TIMER_SOFTIRQ.
On PREEMPT_RT softirqs are preemptible and spin_lock_irq() does not
disable them. That means a timer can be invoked during spin_lock_irq()
on the same CPU. Due to synchronisations reasons local_bh_disable() has
a per-CPU lock named softirq_ctrl.lock which synchronizes individual
softirq against each other.
syz-bot managed to trigger a lockdep report where softirq_ctrl.lock is
acquired in hrtimer_cancel() in addition to hrtimer_run_softirq(). This
is a possible deadlock.

The softirq_ctrl.lock can not be made part of spin_lock_irq() as this
would lead to too much synchronisation against individual threads on the
system. To avoid the possible deadlock, softirqs must be manually
disabled before the lock is acquired.

Disable softirqs before the lock is acquired on PREEMPT_RT.

The Linux kernel CVE team has assigned CVE-2025-40142 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.12 with commit d2d6422f8bd17c6bb205133e290625a564194496 and fixed in 6.12.53 with commit 63ee96c7f47df239ee0a6e8108b6bfd8c98334ae
	Issue introduced in 6.12 with commit d2d6422f8bd17c6bb205133e290625a564194496 and fixed in 6.17.3 with commit 3969b6193cb7a45aa5fb4ec68f215e9e7f93d39a
	Issue introduced in 6.12 with commit d2d6422f8bd17c6bb205133e290625a564194496 and fixed in 6.18 with commit 9fc4a3da9a0259a0500848b5d8657918efde176b

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-40142
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	sound/core/pcm_native.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/63ee96c7f47df239ee0a6e8108b6bfd8c98334ae
	https://git.kernel.org/stable/c/3969b6193cb7a45aa5fb4ec68f215e9e7f93d39a
	https://git.kernel.org/stable/c/9fc4a3da9a0259a0500848b5d8657918efde176b
