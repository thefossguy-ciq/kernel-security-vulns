From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38597: drm/rockchip: vop2: fail cleanly if missing a primary plane for a video-port

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/rockchip: vop2: fail cleanly if missing a primary plane for a video-port

Each window of a vop2 is usable by a specific set of video ports, so while
binding the vop2, we look through the list of available windows trying to
find one designated as primary-plane and usable by that specific port.

The code later wants to use drm_crtc_init_with_planes with that found
primary plane, but nothing has checked so far if a primary plane was
actually found.

For whatever reason, the rk3576 vp2 does not have a usable primary window
(if vp0 is also in use) which brought the issue to light and ended in a
null-pointer dereference further down.

As we expect a primary-plane to exist for a video-port, add a check at
the end of the window-iteration and fail probing if none was found.

The Linux kernel CVE team has assigned CVE-2025-38597 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.19 with commit 604be85547ce4d61b89292d2f9a78c721b778c16 and fixed in 6.15.10 with commit e1eef239399927b368f70a716044fb10085627c8
	Issue introduced in 5.19 with commit 604be85547ce4d61b89292d2f9a78c721b778c16 and fixed in 6.16.1 with commit 38682edbbad272b5f8c7bf55128b42cd10626f73
	Issue introduced in 5.19 with commit 604be85547ce4d61b89292d2f9a78c721b778c16 and fixed in 6.17 with commit f9f68bf1d0efeadb6c427c9dbb30f307a7def19b

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38597
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/rockchip/rockchip_drm_vop2.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/e1eef239399927b368f70a716044fb10085627c8
	https://git.kernel.org/stable/c/38682edbbad272b5f8c7bf55128b42cd10626f73
	https://git.kernel.org/stable/c/f9f68bf1d0efeadb6c427c9dbb30f307a7def19b
