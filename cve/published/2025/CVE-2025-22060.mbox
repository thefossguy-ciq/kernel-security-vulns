From bippy-7c5fe7eed585 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-22060: net: mvpp2: Prevent parser TCAM memory corruption

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net: mvpp2: Prevent parser TCAM memory corruption

Protect the parser TCAM/SRAM memory, and the cached (shadow) SRAM
information, from concurrent modifications.

Both the TCAM and SRAM tables are indirectly accessed by configuring
an index register that selects the row to read or write to. This means
that operations must be atomic in order to, e.g., avoid spreading
writes across multiple rows. Since the shadow SRAM array is used to
find free rows in the hardware table, it must also be protected in
order to avoid TOCTOU errors where multiple cores allocate the same
row.

This issue was detected in a situation where `mvpp2_set_rx_mode()` ran
concurrently on two CPUs. In this particular case the
MVPP2_PE_MAC_UC_PROMISCUOUS entry was corrupted, causing the
classifier unit to drop all incoming unicast - indicated by the
`rx_classifier_drops` counter.

The Linux kernel CVE team has assigned CVE-2025-22060 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.17 with commit 3f518509dedc99f0b755d2ce68d24f610e3a005a and fixed in 5.15.180 with commit e3711163d14d02af9005e4cdad30899c565f13fb
	Issue introduced in 3.17 with commit 3f518509dedc99f0b755d2ce68d24f610e3a005a and fixed in 6.1.134 with commit b3f48a41a00d6d8d9c6fe09ae47dd21c8c1c8b03
	Issue introduced in 3.17 with commit 3f518509dedc99f0b755d2ce68d24f610e3a005a and fixed in 6.6.87 with commit 5b0ae1723a7d9574ae1aee7d9cf9757a30069865
	Issue introduced in 3.17 with commit 3f518509dedc99f0b755d2ce68d24f610e3a005a and fixed in 6.12.23 with commit fcbfb54a0269875cf3cd6a2bff4f85a2e0a0b552
	Issue introduced in 3.17 with commit 3f518509dedc99f0b755d2ce68d24f610e3a005a and fixed in 6.13.11 with commit e64e9b6e86b39db3baa576fd73da73533b54cb2d
	Issue introduced in 3.17 with commit 3f518509dedc99f0b755d2ce68d24f610e3a005a and fixed in 6.14.2 with commit 46c1e23e34c9d1eaadf37f88216d9d8ce0d0bcee
	Issue introduced in 3.17 with commit 3f518509dedc99f0b755d2ce68d24f610e3a005a and fixed in 6.15-rc1 with commit 96844075226b49af25a69a1d084b648ec2d9b08d

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-22060
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/ethernet/marvell/mvpp2/mvpp2.h
	drivers/net/ethernet/marvell/mvpp2/mvpp2_main.c
	drivers/net/ethernet/marvell/mvpp2/mvpp2_prs.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/e3711163d14d02af9005e4cdad30899c565f13fb
	https://git.kernel.org/stable/c/b3f48a41a00d6d8d9c6fe09ae47dd21c8c1c8b03
	https://git.kernel.org/stable/c/5b0ae1723a7d9574ae1aee7d9cf9757a30069865
	https://git.kernel.org/stable/c/fcbfb54a0269875cf3cd6a2bff4f85a2e0a0b552
	https://git.kernel.org/stable/c/e64e9b6e86b39db3baa576fd73da73533b54cb2d
	https://git.kernel.org/stable/c/46c1e23e34c9d1eaadf37f88216d9d8ce0d0bcee
	https://git.kernel.org/stable/c/96844075226b49af25a69a1d084b648ec2d9b08d
