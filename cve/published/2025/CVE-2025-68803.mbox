From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-68803: NFSD: NFSv4 file creation neglects setting ACL
Message-Id: <2026011309-CVE-2025-68803-d897@gregkh>
Content-Length: 3169
Lines: 68
X-Developer-Signature: v=1; a=openpgp-sha256; l=3238;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=yny8mCTo+mt6LJauCjdinRTB3ZFXZ5TEg4nRSvbayTk=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJlpKUedBNKbDZ/Jz0jlDZZeUbTrw9ltaw68uKaku6Ltt
 aWY8E3RjlgWBkEmBlkxRZYv23iO7q84pOhlaHsaZg4rE8gQBi5OAZhI+muG+R6yzK/9zBLOfjDu
 tPKa45V/5sn78wzzvR8G7c86UHlHqeJ2d5qknpRhwfaHAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

NFSD: NFSv4 file creation neglects setting ACL

An NFSv4 client that sets an ACL with a named principal during file
creation retrieves the ACL afterwards, and finds that it is only a
default ACL (based on the mode bits) and not the ACL that was
requested during file creation. This violates RFC 8881 section
6.4.1.3: "the ACL attribute is set as given".

The issue occurs in nfsd_create_setattr(), which calls
nfsd_attrs_valid() to determine whether to call nfsd_setattr().
However, nfsd_attrs_valid() checks only for iattr changes and
security labels, but not POSIX ACLs. When only an ACL is present,
the function returns false, nfsd_setattr() is skipped, and the
POSIX ACL is never applied to the inode.

Subsequently, when the client retrieves the ACL, the server finds
no POSIX ACL on the inode and returns one generated from the file's
mode bits rather than returning the originally-specified ACL.

The Linux kernel CVE team has assigned CVE-2025-68803 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.0 with commit c0cbe70742f4a70893cd6e5f6b10b6e89b6db95b and fixed in 6.1.160 with commit 60dbdef2ebc2317266a385e4debdb1bb0e57afe1
	Issue introduced in 6.0 with commit c0cbe70742f4a70893cd6e5f6b10b6e89b6db95b and fixed in 6.12.64 with commit bf4e671c651534a307ab2fabba4926116beef8c3
	Issue introduced in 6.0 with commit c0cbe70742f4a70893cd6e5f6b10b6e89b6db95b and fixed in 6.18.3 with commit 214b396480061cbc8b16f2c518b2add7fbfa5192
	Issue introduced in 6.0 with commit c0cbe70742f4a70893cd6e5f6b10b6e89b6db95b and fixed in 6.19-rc3 with commit 913f7cf77bf14c13cfea70e89bcb6d0b22239562
	Issue introduced in 5.10.220 with commit c5409ce523af40d5c3019717bc5b4f72038d48be
	Issue introduced in 5.15.154 with commit d52acd23a327cada5fb597591267cfc09f08bb1d

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-68803
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/nfsd/vfs.h


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/60dbdef2ebc2317266a385e4debdb1bb0e57afe1
	https://git.kernel.org/stable/c/bf4e671c651534a307ab2fabba4926116beef8c3
	https://git.kernel.org/stable/c/214b396480061cbc8b16f2c518b2add7fbfa5192
	https://git.kernel.org/stable/c/913f7cf77bf14c13cfea70e89bcb6d0b22239562
