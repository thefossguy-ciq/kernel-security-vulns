From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38571: sunrpc: fix client side handling of tls alerts

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

sunrpc: fix client side handling of tls alerts

A security exploit was discovered in NFS over TLS in tls_alert_recv
due to its assumption that there is valid data in the msghdr's
iterator's kvec.

Instead, this patch proposes the rework how control messages are
setup and used by sock_recvmsg().

If no control message structure is setup, kTLS layer will read and
process TLS data record types. As soon as it encounters a TLS control
message, it would return an error. At that point, NFS can setup a kvec
backed control buffer and read in the control message such as a TLS
alert. Scott found that a msg iterator can advance the kvec pointer
as a part of the copy process thus we need to revert the iterator
before calling into the tls_alert_recv.

The Linux kernel CVE team has assigned CVE-2025-38571 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.5 with commit dea034b963c8901bdcc3d3880c04f0d75c95112f and fixed in 6.6.102 with commit a55b3d15331859d9fdd261cfa6d34ca2aeb0fb95
	Issue introduced in 6.5 with commit dea034b963c8901bdcc3d3880c04f0d75c95112f and fixed in 6.12.42 with commit c36b2fbd60e8f9c6f975522130998608880c93be
	Issue introduced in 6.5 with commit dea034b963c8901bdcc3d3880c04f0d75c95112f and fixed in 6.15.10 with commit 3ee397eaaca4fa04db21bb98c8f1d0c6cc525368
	Issue introduced in 6.5 with commit dea034b963c8901bdcc3d3880c04f0d75c95112f and fixed in 6.16.1 with commit 3feada5baf4dc96e151ff2ca54630e1d274e5458
	Issue introduced in 6.5 with commit dea034b963c8901bdcc3d3880c04f0d75c95112f and fixed in 6.17-rc1 with commit cc5d59081fa26506d02de2127ab822f40d88bc5a

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38571
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/sunrpc/xprtsock.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/a55b3d15331859d9fdd261cfa6d34ca2aeb0fb95
	https://git.kernel.org/stable/c/c36b2fbd60e8f9c6f975522130998608880c93be
	https://git.kernel.org/stable/c/3ee397eaaca4fa04db21bb98c8f1d0c6cc525368
	https://git.kernel.org/stable/c/3feada5baf4dc96e151ff2ca54630e1d274e5458
	https://git.kernel.org/stable/c/cc5d59081fa26506d02de2127ab822f40d88bc5a
