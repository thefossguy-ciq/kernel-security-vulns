From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-40330: bnxt_en: Shutdown FW DMA in bnxt_shutdown()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

bnxt_en: Shutdown FW DMA in bnxt_shutdown()

The netif_close() call in bnxt_shutdown() only stops packet DMA.  There
may be FW DMA for trace logging (recently added) that will continue.  If
we kexec to a new kernel, the DMA will corrupt memory in the new kernel.

Add bnxt_hwrm_func_drv_unrgtr() to unregister the driver from the FW.
This will stop the FW DMA.  In case the call fails, call pcie_flr() to
reset the function and stop the DMA.

The Linux kernel CVE team has assigned CVE-2025-40330 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.13 with commit 24d694aec139e9e0a31c60993db79bd8ad575afe and fixed in 6.17.8 with commit 1a8a15c3f71d1199d510ccba4bc201cbd2204048
	Issue introduced in 6.13 with commit 24d694aec139e9e0a31c60993db79bd8ad575afe and fixed in 6.18 with commit bc7208ca805ae6062f353a4753467d913d963bc6

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-40330
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/ethernet/broadcom/bnxt/bnxt.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/1a8a15c3f71d1199d510ccba4bc201cbd2204048
	https://git.kernel.org/stable/c/bc7208ca805ae6062f353a4753467d913d963bc6
