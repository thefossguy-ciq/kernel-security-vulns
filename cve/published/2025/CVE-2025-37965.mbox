From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-37965: drm/amd/display: Fix invalid context error in dml helper
Message-Id: <2025052043-CVE-2025-37965-5602@gregkh>
Content-Length: 2592
Lines: 65
X-Developer-Signature: v=1; a=openpgp-sha256; l=2658;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=2ObTjJm5VdI/0erX5At+RVldNitHlj6/1L2WrnYDUBY=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBk6G7dnfVeu6v1nuPXx0oazjfOXlMz1KpDRvxX2P2ZV6
 MN97OdPdcSyMAgyMciKKbJ82cZzdH/FIUUvQ9vTMHNYmUCGMHBxCsBEXrAzzPerdNONqrvx/PDs
 2TvYUvhqw1+xFzLMLxGJOfLql+HDnRaXnHX3xt1/+uH3XgA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/amd/display: Fix invalid context error in dml helper

[Why]
"BUG: sleeping function called from invalid context" error.
after:
"drm/amd/display: Protect FPU in dml2_validate()/dml21_validate()"

The populate_dml_plane_cfg_from_plane_state() uses the GFP_KERNEL flag
for memory allocation, which shouldn't be used in atomic contexts.

The allocation is needed only for using another helper function
get_scaler_data_for_plane().

[How]
Modify helpers to pass a pointer to scaler_data within existing context,
eliminating the need for dynamic memory allocation/deallocation
and copying.

(cherry picked from commit bd3e84bc98f81b44f2c43936bdadc3241d654259)

The Linux kernel CVE team has assigned CVE-2025-37965 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.12.25 with commit 74d6fba60f05ca6b298702233b6e6cc7629eeb5a and fixed in 6.12.29 with commit d8c4afe78385cd355e4d80299d785379d6e874df
	Issue introduced in 6.14.4 with commit 7b80dcf343d45088931d16a6c9ba2fd975138a0b and fixed in 6.14.7 with commit b371f8f6d89ec8dfea796e00a44a57c44fc8fcc0
	Issue introduced in 6.15-rc2 with commit 366e77cd4923c3aa45341e15dcaf3377af9b042f and fixed in 6.15-rc6 with commit 9984db63742099ee3f3cff35cf71306d10e64356

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-37965
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/amd/display/dc/dml2/dml2_translation_helper.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d8c4afe78385cd355e4d80299d785379d6e874df
	https://git.kernel.org/stable/c/b371f8f6d89ec8dfea796e00a44a57c44fc8fcc0
	https://git.kernel.org/stable/c/9984db63742099ee3f3cff35cf71306d10e64356
