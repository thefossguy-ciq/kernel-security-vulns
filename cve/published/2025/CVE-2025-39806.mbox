From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39806: HID: multitouch: fix slab out-of-bounds access in mt_report_fixup()
Message-Id: <2025091613-CVE-2025-39806-f74d@gregkh>
Content-Length: 4567
Lines: 93
X-Developer-Signature: v=1; a=openpgp-sha256; l=4661;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=SKYasg4imdwz4AcGdYvBhNbBcKP6O7+05e8P4CYVV3Y=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBkn42P5jTllk9fsPnT8RUH+wtyfBRLnZkd08W23OREtv
 XDiNNN9HbEsDIJMDLJiiixftvEc3V9xSNHL0PY0zBxWJpAhDFycAjARjssMC1Z/axWJEjP86J7u
 fFJP4UXXA/uDQgwL+nZo7FuUrtfIs3fmFC/u+U5dt/l3AAA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

HID: multitouch: fix slab out-of-bounds access in mt_report_fixup()

A malicious HID device can trigger a slab out-of-bounds during
mt_report_fixup() by passing in report descriptor smaller than
607 bytes. mt_report_fixup() attempts to patch byte offset 607
of the descriptor with 0x25 by first checking if byte offset
607 is 0x15 however it lacks bounds checks to verify if the
descriptor is big enough before conducting this check. Fix
this bug by ensuring the descriptor size is at least 608
bytes before accessing it.

Below is the KASAN splat after the out of bounds access happens:

[   13.671954] ==================================================================
[   13.672667] BUG: KASAN: slab-out-of-bounds in mt_report_fixup+0x103/0x110
[   13.673297] Read of size 1 at addr ffff888103df39df by task kworker/0:1/10
[   13.673297]
[   13.673297] CPU: 0 UID: 0 PID: 10 Comm: kworker/0:1 Not tainted 6.15.0-00005-gec5d573d83f4-dirty #3
[   13.673297] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.16.2-debian-1.16.2-1 04/04
[   13.673297] Call Trace:
[   13.673297]  <TASK>
[   13.673297]  dump_stack_lvl+0x5f/0x80
[   13.673297]  print_report+0xd1/0x660
[   13.673297]  kasan_report+0xe5/0x120
[   13.673297]  __asan_report_load1_noabort+0x18/0x20
[   13.673297]  mt_report_fixup+0x103/0x110
[   13.673297]  hid_open_report+0x1ef/0x810
[   13.673297]  mt_probe+0x422/0x960
[   13.673297]  hid_device_probe+0x2e2/0x6f0
[   13.673297]  really_probe+0x1c6/0x6b0
[   13.673297]  __driver_probe_device+0x24f/0x310
[   13.673297]  driver_probe_device+0x4e/0x220
[   13.673297]  __device_attach_driver+0x169/0x320
[   13.673297]  bus_for_each_drv+0x11d/0x1b0
[   13.673297]  __device_attach+0x1b8/0x3e0
[   13.673297]  device_initial_probe+0x12/0x20
[   13.673297]  bus_probe_device+0x13d/0x180
[   13.673297]  device_add+0xe3a/0x1670
[   13.673297]  hid_add_device+0x31d/0xa40
[...]

The Linux kernel CVE team has assigned CVE-2025-39806 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.15.168 with commit 7d91a0b2151a9c3b61d44c85c8eba930eddd1dd0 and fixed in 5.15.191 with commit 4263e5851779f7d8ebfbc9cc7d2e9b0217adba8d
	Issue introduced in 6.1.111 with commit 45ec9f17ce46417fc4eccecf388c99e81fb7fcc1 and fixed in 6.1.150 with commit 7ab7311c43ae19c66c53ccd8c5052a9072a4e338
	Issue introduced in 6.6.52 with commit 1d5c7d0a49ec9d8786f266ac6d1d7c4960e1787b and fixed in 6.6.104 with commit d4e6e2680807671e1c73cd6a986b33659ce92f2b
	Issue introduced in 6.11 with commit c8000deb68365b461b324d68c7ea89d730f0bb85 and fixed in 6.12.45 with commit 3055309821dd3da92888f88bad10f0324c3c89fe
	Issue introduced in 6.11 with commit c8000deb68365b461b324d68c7ea89d730f0bb85 and fixed in 6.16.5 with commit c13e95587583d018cfbcc277df7e02d41902ac5a
	Issue introduced in 6.11 with commit c8000deb68365b461b324d68c7ea89d730f0bb85 and fixed in 6.17-rc4 with commit 0379eb8691b9c4477da0277ae0832036ca4410b4
	Issue introduced in 6.10.11 with commit d189e24a42b8bd0ece3d28801d751bf66dba8e92

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39806
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/hid/hid-multitouch.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/4263e5851779f7d8ebfbc9cc7d2e9b0217adba8d
	https://git.kernel.org/stable/c/7ab7311c43ae19c66c53ccd8c5052a9072a4e338
	https://git.kernel.org/stable/c/d4e6e2680807671e1c73cd6a986b33659ce92f2b
	https://git.kernel.org/stable/c/3055309821dd3da92888f88bad10f0324c3c89fe
	https://git.kernel.org/stable/c/c13e95587583d018cfbcc277df7e02d41902ac5a
	https://git.kernel.org/stable/c/0379eb8691b9c4477da0277ae0832036ca4410b4
