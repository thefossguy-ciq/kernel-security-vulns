From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39838: cifs: prevent NULL pointer dereference in UTF16 conversion
Message-Id: <2025091902-CVE-2025-39838-2a5d@gregkh>
Content-Length: 2447
Lines: 61
X-Developer-Signature: v=1; a=openpgp-sha256; l=2509;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=PtzL6GVhJvnLjhVBkPWPgDiJ+WLQ7TGMixZLrdPqBr0=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBlny5pOLui49nrloUj56X55P/69MN9ddzlyk2C0d+rU/
 U7zj+ov6IhlYRBkYpAVU2T5so3n6P6KQ4pehranYeawMoEMYeDiFICJVKximGcrkVMf+7GiNEnt
 hdMkG+uHcuaBbxgW7DO+KCmQenIi77bO/eZZz0KU32qZAQA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

cifs: prevent NULL pointer dereference in UTF16 conversion

There can be a NULL pointer dereference bug here. NULL is passed to
__cifs_sfu_make_node without checks, which passes it unchecked to
cifs_strndup_to_utf16, which in turn passes it to
cifs_local_to_utf16_bytes where '*from' is dereferenced, causing a crash.

This patch adds a check for NULL 'src' in cifs_strndup_to_utf16 and
returns NULL early to prevent dereferencing NULL pointer.

Found by Linux Verification Center (linuxtesting.org) with SVACE

The Linux kernel CVE team has assigned CVE-2025-39838 to this issue.


Affected and fixed versions
===========================

	Fixed in 6.1.151 with commit 65b98a7e65e7a8f3894d8760cd194eaf20504c99
	Fixed in 6.6.105 with commit 1cfa5dd05847137f0fb3ce74ced80c0b4858d716
	Fixed in 6.12.46 with commit 1f797f062b5cf13a1c2bcc23285361baaa7c9260
	Fixed in 6.16.6 with commit 3c26a8d30ed6b53a52a023ec537dc50a6d34a67a
	Fixed in 6.17-rc5 with commit 70bccd9855dae56942f2b18a08ba137bb54093a0

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39838
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/smb/client/cifs_unicode.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/65b98a7e65e7a8f3894d8760cd194eaf20504c99
	https://git.kernel.org/stable/c/1cfa5dd05847137f0fb3ce74ced80c0b4858d716
	https://git.kernel.org/stable/c/1f797f062b5cf13a1c2bcc23285361baaa7c9260
	https://git.kernel.org/stable/c/3c26a8d30ed6b53a52a023ec537dc50a6d34a67a
	https://git.kernel.org/stable/c/70bccd9855dae56942f2b18a08ba137bb54093a0
