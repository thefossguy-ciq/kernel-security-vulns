From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39750: wifi: ath12k: Correct tid cleanup when tid setup fails

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

wifi: ath12k: Correct tid cleanup when tid setup fails

Currently, if any error occurs during ath12k_dp_rx_peer_tid_setup(),
the tid value is already incremented, even though the corresponding
TID is not actually allocated. Proceed to
ath12k_dp_rx_peer_tid_delete() starting from unallocated tid,
which might leads to freeing unallocated TID and cause potential
crash or out-of-bounds access.

Hence, fix by correctly decrementing tid before cleanup to match only
the successfully allocated TIDs.

Also, remove tid-- from failure case of ath12k_dp_rx_peer_frag_setup(),
as decrementing the tid before cleanup in loop will take care of this.

Compile tested only.

The Linux kernel CVE team has assigned CVE-2025-39750 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.3 with commit d889913205cf7ebda905b1e62c5867ed4e39f6c2 and fixed in 6.6.103 with commit 30cad87978057516c93467516bc481a3eacfd66a
	Issue introduced in 6.3 with commit d889913205cf7ebda905b1e62c5867ed4e39f6c2 and fixed in 6.12.43 with commit 2ef17d1476ab26bce89764e2f16833d7f52acc38
	Issue introduced in 6.3 with commit d889913205cf7ebda905b1e62c5867ed4e39f6c2 and fixed in 6.15.11 with commit 907c630e58af9e86e215f3951c7b287bd86d0f15
	Issue introduced in 6.3 with commit d889913205cf7ebda905b1e62c5867ed4e39f6c2 and fixed in 6.16.2 with commit 6301fe4f209165334d251a1c6da8ae47f93cb32c
	Issue introduced in 6.3 with commit d889913205cf7ebda905b1e62c5867ed4e39f6c2 and fixed in 6.17-rc1 with commit 4a2bf707270f897ab8077baee8ed5842a5321686

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39750
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/wireless/ath/ath12k/dp.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/30cad87978057516c93467516bc481a3eacfd66a
	https://git.kernel.org/stable/c/2ef17d1476ab26bce89764e2f16833d7f52acc38
	https://git.kernel.org/stable/c/907c630e58af9e86e215f3951c7b287bd86d0f15
	https://git.kernel.org/stable/c/6301fe4f209165334d251a1c6da8ae47f93cb32c
	https://git.kernel.org/stable/c/4a2bf707270f897ab8077baee8ed5842a5321686
