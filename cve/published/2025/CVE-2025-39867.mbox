From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39867: netfilter: nft_set_pipapo: fix null deref for empty set
Message-Id: <2025092357-CVE-2025-39867-51e2@gregkh>
Content-Length: 1965
Lines: 54
X-Developer-Signature: v=1; a=openpgp-sha256; l=2020;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=6lUsgthd5o7PFkjrvnq8YCeIT7rZbrGWbwyWt4L8aww=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBmXzGfGnn8bpfYmw+PvqvbnfPmuM5NUU2QX55/5khGsd
 GRbME96RywLgyATg6yYIsuXbTxH91ccUvQytD0NM4eVCWQIAxenAEzE2ZFhnnXSfl/3N8u+J7jb
 q/P8DmMVuf52JcOC08sOtgpc23ti4sHAv2ZvFaIPzFYpAQA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

netfilter: nft_set_pipapo: fix null deref for empty set

Blamed commit broke the check for a null scratch map:
  -  if (unlikely(!m || !*raw_cpu_ptr(m->scratch)))
  +  if (unlikely(!raw_cpu_ptr(m->scratch)))

This should have been "if (!*raw_ ...)".
Use the pattern of the avx2 version which is more readable.

This can only be reproduced if avx2 support isn't available.

The Linux kernel CVE team has assigned CVE-2025-39867 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.17-rc1 with commit d8d871a35ca9ee4881d34995444ed1cb826d01db and fixed in 6.17-rc2 with commit 30c1d25b9870d551be42535067d5481668b5e6f3

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39867
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/netfilter/nft_set_pipapo.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/44b2be6d5994ddf07ecc86c01d3279bfa13e9ef6
	https://git.kernel.org/stable/c/51a321b480d1e753667f6aea497312461563f9fe
	https://git.kernel.org/stable/c/30c1d25b9870d551be42535067d5481668b5e6f3
