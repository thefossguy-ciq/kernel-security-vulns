From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-40283: Bluetooth: btusb: reorder cleanup in btusb_disconnect to avoid UAF

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

Bluetooth: btusb: reorder cleanup in btusb_disconnect to avoid UAF

There is a KASAN: slab-use-after-free read in btusb_disconnect().
Calling "usb_driver_release_interface(&btusb_driver, data->intf)" will
free the btusb data associated with the interface. The same data is
then used later in the function, hence the UAF.

Fix by moving the accesses to btusb data to before the data is free'd.

The Linux kernel CVE team has assigned CVE-2025-40283 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.11 with commit fd913ef7ce619467c6b0644af48ba1fec499c623 and fixed in 5.4.302 with commit 297dbf87989e09af98f81f2bcb938041785557e8
	Issue introduced in 4.11 with commit fd913ef7ce619467c6b0644af48ba1fec499c623 and fixed in 5.10.247 with commit f858f004bc343a7ae9f2533bbb2a3ab27428532f
	Issue introduced in 4.11 with commit fd913ef7ce619467c6b0644af48ba1fec499c623 and fixed in 5.15.197 with commit 7a6d1e740220ff9dfcb6a8c994d6ba49e76db198
	Issue introduced in 4.11 with commit fd913ef7ce619467c6b0644af48ba1fec499c623 and fixed in 6.1.159 with commit 5dc00065a0496c36694afe11e52a5bc64524a9b8
	Issue introduced in 4.11 with commit fd913ef7ce619467c6b0644af48ba1fec499c623 and fixed in 6.6.117 with commit 1c28c1e1522c773a94e26950ffb145e88cd9834b
	Issue introduced in 4.11 with commit fd913ef7ce619467c6b0644af48ba1fec499c623 and fixed in 6.12.59 with commit 95b9b98c93b1c0916a3d4cf4540b7f5d69145a0d
	Issue introduced in 4.11 with commit fd913ef7ce619467c6b0644af48ba1fec499c623 and fixed in 6.17.9 with commit a2610ecd9fd5708be8997ca8f033e4200c0bb6af
	Issue introduced in 4.11 with commit fd913ef7ce619467c6b0644af48ba1fec499c623 and fixed in 6.18 with commit 23d22f2f71768034d6ef86168213843fc49bf550

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-40283
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/bluetooth/btusb.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/297dbf87989e09af98f81f2bcb938041785557e8
	https://git.kernel.org/stable/c/f858f004bc343a7ae9f2533bbb2a3ab27428532f
	https://git.kernel.org/stable/c/7a6d1e740220ff9dfcb6a8c994d6ba49e76db198
	https://git.kernel.org/stable/c/5dc00065a0496c36694afe11e52a5bc64524a9b8
	https://git.kernel.org/stable/c/1c28c1e1522c773a94e26950ffb145e88cd9834b
	https://git.kernel.org/stable/c/95b9b98c93b1c0916a3d4cf4540b7f5d69145a0d
	https://git.kernel.org/stable/c/a2610ecd9fd5708be8997ca8f033e4200c0bb6af
	https://git.kernel.org/stable/c/23d22f2f71768034d6ef86168213843fc49bf550
