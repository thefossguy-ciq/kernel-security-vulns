From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-68725: bpf: Do not let BPF test infra emit invalid GSO types to stack

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

bpf: Do not let BPF test infra emit invalid GSO types to stack

Yinhao et al. reported that their fuzzer tool was able to trigger a
skb_warn_bad_offload() from netif_skb_features() -> gso_features_check().
When a BPF program - triggered via BPF test infra - pushes the packet
to the loopback device via bpf_clone_redirect() then mentioned offload
warning can be seen. GSO-related features are then rightfully disabled.

We get into this situation due to convert___skb_to_skb() setting
gso_segs and gso_size but not gso_type. Technically, it makes sense
that this warning triggers since the GSO properties are malformed due
to the gso_type. Potentially, the gso_type could be marked non-trustworthy
through setting it at least to SKB_GSO_DODGY without any other specific
assumptions, but that also feels wrong given we should not go further
into the GSO engine in the first place.

The checks were added in 121d57af308d ("gso: validate gso_type in GSO
handlers") because there were malicious (syzbot) senders that combine
a protocol with a non-matching gso_type. If we would want to drop such
packets, gso_features_check() currently only returns feature flags via
netif_skb_features(), so one location for potentially dropping such skbs
could be validate_xmit_unreadable_skb(), but then otoh it would be
an additional check in the fast-path for a very corner case. Given
bpf_clone_redirect() is the only place where BPF test infra could emit
such packets, lets reject them right there.

The Linux kernel CVE team has assigned CVE-2025-68725 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.6 with commit 850a88cc4096fe1df407452ba2e4d28cf5b3eee9 and fixed in 6.6.122 with commit 8670b53b8ee91f028f7240531064020b7413c461
	Issue introduced in 5.6 with commit 850a88cc4096fe1df407452ba2e4d28cf5b3eee9 and fixed in 6.12.68 with commit 0f3a60869ca22024dfb9c6fce412b0c70cb4ea36
	Issue introduced in 5.6 with commit 850a88cc4096fe1df407452ba2e4d28cf5b3eee9 and fixed in 6.18.2 with commit fbea4c63b5385588cb44ab21f91e55e33c719a54
	Issue introduced in 5.6 with commit 850a88cc4096fe1df407452ba2e4d28cf5b3eee9 and fixed in 6.19-rc1 with commit 04a899573fb87273a656f178b5f920c505f68875

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-68725
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/bpf/test_run.c
	net/core/filter.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/8670b53b8ee91f028f7240531064020b7413c461
	https://git.kernel.org/stable/c/0f3a60869ca22024dfb9c6fce412b0c70cb4ea36
	https://git.kernel.org/stable/c/fbea4c63b5385588cb44ab21f91e55e33c719a54
	https://git.kernel.org/stable/c/04a899573fb87273a656f178b5f920c505f68875
