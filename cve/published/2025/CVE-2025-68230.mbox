From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-68230: drm/amdgpu: fix gpu page fault after hibernation on PF passthrough

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/amdgpu: fix gpu page fault after hibernation on PF passthrough

On PF passthrough environment, after hibernate and then resume, coralgemm
will cause gpu page fault.

Mode1 reset happens during hibernate, but partition mode is not restored
on resume, register mmCP_HYP_XCP_CTL and mmCP_PSP_XCP_CTL is not right
after resume. When CP access the MQD BO, wrong stride size is used,
this will cause out of bound access on the MQD BO, resulting page fault.

The fix is to ensure gfx_v9_4_3_switch_compute_partition() is called
when resume from a hibernation.
KFD resume is called separately during a reset recovery or resume from
suspend sequence. Hence it's not required to be called as part of
partition switch.

(cherry picked from commit 5d1b32cfe4a676fe552416cb5ae847b215463a1a)

The Linux kernel CVE team has assigned CVE-2025-68230 to this issue.


Affected and fixed versions
===========================

	Fixed in 6.12.60 with commit a45d6359eefb41e08d374a3260b10bff5626823b
	Fixed in 6.17.10 with commit eef72d856f978955e633c270abb1f7ec7b61c6d2
	Fixed in 6.18 with commit eb6e7f520d6efa4d4ebf1671455abe4a681f7a05

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-68230
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/amd/amdgpu/aqua_vanjaram.c
	drivers/gpu/drm/amd/amdgpu/gfx_v9_4_3.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/a45d6359eefb41e08d374a3260b10bff5626823b
	https://git.kernel.org/stable/c/eef72d856f978955e633c270abb1f7ec7b61c6d2
	https://git.kernel.org/stable/c/eb6e7f520d6efa4d4ebf1671455abe4a681f7a05
