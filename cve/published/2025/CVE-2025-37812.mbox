From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-37812: usb: cdns3: Fix deadlock when using NCM gadget

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

usb: cdns3: Fix deadlock when using NCM gadget

The cdns3 driver has the same NCM deadlock as fixed in cdnsp by commit
58f2fcb3a845 ("usb: cdnsp: Fix deadlock issue during using NCM gadget").

Under PREEMPT_RT the deadlock can be readily triggered by heavy network
traffic, for example using "iperf --bidir" over NCM ethernet link.

The deadlock occurs because the threaded interrupt handler gets
preempted by a softirq, but both are protected by the same spinlock.
Prevent deadlock by disabling softirq during threaded irq handler.

The Linux kernel CVE team has assigned CVE-2025-37812 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.4 with commit 7733f6c32e36ff9d7adadf40001039bf219b1cbe and fixed in 5.4.293 with commit eebfb64c624fc738b669100173344fb441c5e719
	Issue introduced in 5.4 with commit 7733f6c32e36ff9d7adadf40001039bf219b1cbe and fixed in 5.10.237 with commit 59a760e4796a3cd88d8b9d7706e0a638de677751
	Issue introduced in 5.4 with commit 7733f6c32e36ff9d7adadf40001039bf219b1cbe and fixed in 5.15.181 with commit b96239582531775f2fdcb14de29bdb6870fd4c8c
	Issue introduced in 5.4 with commit 7733f6c32e36ff9d7adadf40001039bf219b1cbe and fixed in 6.1.136 with commit c27db84ed44e50ff90d9e3a2a25fae2e0a0fa015
	Issue introduced in 5.4 with commit 7733f6c32e36ff9d7adadf40001039bf219b1cbe and fixed in 6.6.89 with commit 48a62deb857f0694f611949015e70ad194d97159
	Issue introduced in 5.4 with commit 7733f6c32e36ff9d7adadf40001039bf219b1cbe and fixed in 6.12.26 with commit 74cd6e408a4c010e404832f0e4609d29bf1d0c41
	Issue introduced in 5.4 with commit 7733f6c32e36ff9d7adadf40001039bf219b1cbe and fixed in 6.14.5 with commit 09e90a9689a4aac7a2f726dc2aa472b0b37937b7
	Issue introduced in 5.4 with commit 7733f6c32e36ff9d7adadf40001039bf219b1cbe and fixed in 6.15-rc4 with commit a1059896f2bfdcebcdc7153c3be2307ea319501f

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-37812
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/usb/cdns3/cdns3-gadget.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/eebfb64c624fc738b669100173344fb441c5e719
	https://git.kernel.org/stable/c/59a760e4796a3cd88d8b9d7706e0a638de677751
	https://git.kernel.org/stable/c/b96239582531775f2fdcb14de29bdb6870fd4c8c
	https://git.kernel.org/stable/c/c27db84ed44e50ff90d9e3a2a25fae2e0a0fa015
	https://git.kernel.org/stable/c/48a62deb857f0694f611949015e70ad194d97159
	https://git.kernel.org/stable/c/74cd6e408a4c010e404832f0e4609d29bf1d0c41
	https://git.kernel.org/stable/c/09e90a9689a4aac7a2f726dc2aa472b0b37937b7
	https://git.kernel.org/stable/c/a1059896f2bfdcebcdc7153c3be2307ea319501f
