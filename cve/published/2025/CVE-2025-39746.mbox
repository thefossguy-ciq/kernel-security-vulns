From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39746: wifi: ath10k: shutdown driver when hardware is unreliable

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

wifi: ath10k: shutdown driver when hardware is unreliable

In rare cases, ath10k may lose connection with the PCIe bus due to
some unknown reasons, which could further lead to system crashes during
resuming due to watchdog timeout:

ath10k_pci 0000:01:00.0: wmi command 20486 timeout, restarting hardware
ath10k_pci 0000:01:00.0: already restarting
ath10k_pci 0000:01:00.0: failed to stop WMI vdev 0: -11
ath10k_pci 0000:01:00.0: failed to stop vdev 0: -11
ieee80211 phy0: PM: **** DPM device timeout ****
Call Trace:
 panic+0x125/0x315
 dpm_watchdog_set+0x54/0x54
 dpm_watchdog_handler+0x57/0x57
 call_timer_fn+0x31/0x13c

At this point, all WMI commands will timeout and attempt to restart
device. So set a threshold for consecutive restart failures. If the
threshold is exceeded, consider the hardware is unreliable and all
ath10k operations should be skipped to avoid system crash.

fail_cont_count and pending_recovery are atomic variables, and
do not involve complex conditional logic. Therefore, even if recovery
check and reconfig complete are executed concurrently, the recovery
mechanism will not be broken.

Tested-on: QCA6174 hw3.2 PCI WLAN.RM.4.4.1-00288-QCARMSWPZ-1

The Linux kernel CVE team has assigned CVE-2025-39746 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.11 with commit 5e3dd157d7e70f0e3cea3f2573ed69fb156a19d5 and fixed in 6.12.43 with commit 201c9b4485edc618863a60f97a2d88bddd139467
	Issue introduced in 3.11 with commit 5e3dd157d7e70f0e3cea3f2573ed69fb156a19d5 and fixed in 6.15.11 with commit e36991bddf8be63e79659f654cdb1722db4e8132
	Issue introduced in 3.11 with commit 5e3dd157d7e70f0e3cea3f2573ed69fb156a19d5 and fixed in 6.16.2 with commit 84ca5632b8d05d1c2e25604d1d63434b2fb61c85
	Issue introduced in 3.11 with commit 5e3dd157d7e70f0e3cea3f2573ed69fb156a19d5 and fixed in 6.17-rc1 with commit c256a94d1b1b15109740306f7f2a7c2173e12072

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39746
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/wireless/ath/ath10k/core.c
	drivers/net/wireless/ath/ath10k/core.h
	drivers/net/wireless/ath/ath10k/mac.c
	drivers/net/wireless/ath/ath10k/wmi.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/201c9b4485edc618863a60f97a2d88bddd139467
	https://git.kernel.org/stable/c/e36991bddf8be63e79659f654cdb1722db4e8132
	https://git.kernel.org/stable/c/84ca5632b8d05d1c2e25604d1d63434b2fb61c85
	https://git.kernel.org/stable/c/c256a94d1b1b15109740306f7f2a7c2173e12072
