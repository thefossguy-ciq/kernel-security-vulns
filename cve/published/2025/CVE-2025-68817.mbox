From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-68817: ksmbd: fix use-after-free in ksmbd_tree_connect_put under concurrency

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ksmbd: fix use-after-free in ksmbd_tree_connect_put under concurrency

Under high concurrency, A tree-connection object (tcon) is freed on
a disconnect path while another path still holds a reference and later
executes *_put()/write on it.

The Linux kernel CVE team has assigned CVE-2025-68817 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.1.71 with commit 7b58ee8d0b91359554cf219cd4f33872ea2afd66 and fixed in 6.1.160 with commit d092de8a26c952379ded8e6b0bda31d89befac1a
	Issue introduced in 6.6 with commit 33b235a6e6ebe0f05f3586a71e8d281d00f71e2e and fixed in 6.6.120 with commit d64977495e44855f2b28d8ce56107c963a7a50e4
	Issue introduced in 6.6 with commit 33b235a6e6ebe0f05f3586a71e8d281d00f71e2e and fixed in 6.12.64 with commit 21a3d01fc6db5129f81edb0ab7cb94fd758bcbea
	Issue introduced in 6.6 with commit 33b235a6e6ebe0f05f3586a71e8d281d00f71e2e and fixed in 6.18.3 with commit 063cbbc6f595ea36ad146e1b7d2af820894beb21
	Issue introduced in 6.6 with commit 33b235a6e6ebe0f05f3586a71e8d281d00f71e2e and fixed in 6.19-rc1 with commit b39a1833cc4a2755b02603eec3a71a85e9dff926
	Issue introduced in 5.15.145 with commit dd45db4d9bbc8f122a9b4db5ce94ae29fcf03d3c

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-68817
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/smb/server/mgmt/tree_connect.c
	fs/smb/server/mgmt/tree_connect.h
	fs/smb/server/smb2pdu.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d092de8a26c952379ded8e6b0bda31d89befac1a
	https://git.kernel.org/stable/c/d64977495e44855f2b28d8ce56107c963a7a50e4
	https://git.kernel.org/stable/c/21a3d01fc6db5129f81edb0ab7cb94fd758bcbea
	https://git.kernel.org/stable/c/063cbbc6f595ea36ad146e1b7d2af820894beb21
	https://git.kernel.org/stable/c/b39a1833cc4a2755b02603eec3a71a85e9dff926
