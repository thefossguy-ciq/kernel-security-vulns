From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38198: fbcon: Make sure modelist not set on unregistered console

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

fbcon: Make sure modelist not set on unregistered console

It looks like attempting to write to the "store_modes" sysfs node will
run afoul of unregistered consoles:

UBSAN: array-index-out-of-bounds in drivers/video/fbdev/core/fbcon.c:122:28
index -1 is out of range for type 'fb_info *[32]'
...
 fbcon_info_from_console+0x192/0x1a0 drivers/video/fbdev/core/fbcon.c:122
 fbcon_new_modelist+0xbf/0x2d0 drivers/video/fbdev/core/fbcon.c:3048
 fb_new_modelist+0x328/0x440 drivers/video/fbdev/core/fbmem.c:673
 store_modes+0x1c9/0x3e0 drivers/video/fbdev/core/fbsysfs.c:113
 dev_attr_store+0x55/0x80 drivers/base/core.c:2439

static struct fb_info *fbcon_registered_fb[FB_MAX];
...
static signed char con2fb_map[MAX_NR_CONSOLES];
...
static struct fb_info *fbcon_info_from_console(int console)
...
        return fbcon_registered_fb[con2fb_map[console]];

If con2fb_map contains a -1 things go wrong here. Instead, return NULL,
as callers of fbcon_info_from_console() are trying to compare against
existing "info" pointers, so error handling should kick in correctly.

The Linux kernel CVE team has assigned CVE-2025-38198 to this issue.


Affected and fixed versions
===========================

	Fixed in 6.1.142 with commit b3237d451bf3a4490cb1a76f3b7c91d9888f1c4b
	Fixed in 6.6.95 with commit 519ba75728ee8cd561dce25fc52a2ec5c47171dc
	Fixed in 6.12.35 with commit f28f1f578cd810779d01999c60618cda14c281dd
	Fixed in 6.15.4 with commit 54b28f7c567dd659e5f9562f518e4d7f3f6a367b
	Fixed in 6.16-rc1 with commit cedc1b63394a866bf8663a3e40f4546f1d28c8d8

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38198
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/video/fbdev/core/fbcon.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/b3237d451bf3a4490cb1a76f3b7c91d9888f1c4b
	https://git.kernel.org/stable/c/519ba75728ee8cd561dce25fc52a2ec5c47171dc
	https://git.kernel.org/stable/c/f28f1f578cd810779d01999c60618cda14c281dd
	https://git.kernel.org/stable/c/54b28f7c567dd659e5f9562f518e4d7f3f6a367b
	https://git.kernel.org/stable/c/cedc1b63394a866bf8663a3e40f4546f1d28c8d8
