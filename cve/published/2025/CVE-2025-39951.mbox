From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39951: um: virtio_uml: Fix use-after-free after put_device in probe
Message-Id: <2025100420-CVE-2025-39951-24b1@gregkh>
Content-Length: 2600
Lines: 56
X-Developer-Signature: v=1; a=openpgp-sha256; l=2657;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=2d/wVFxXaCFcsuUCLxE11C2GsiMwDHRKgCZ28phHzzA=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBkPzh7oj/B+/mgh90f3nZtl+f2UnTwP1aitFvm5fMXO7
 +mdFawaHbEsDIJMDLJiiixftvEc3V9xSNHL0PY0zBxWJpAhDFycAjCRCi+GebbJahNdxDIEdc9O
 U5gVML3BM4q7jWHBFJ87V/V+rfdl4BR/u33Lrxa1rFhRAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

um: virtio_uml: Fix use-after-free after put_device in probe

When register_virtio_device() fails in virtio_uml_probe(),
the code sets vu_dev->registered = 1 even though
the device was not successfully registered.
This can lead to use-after-free or other issues.

The Linux kernel CVE team has assigned CVE-2025-39951 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.5 with commit 04e5b1fb01834a602acaae2276b67a783a8c6159 and fixed in 6.1.154 with commit aaf900a83508c8cd5cdf765e7749f9076196ec7f
	Issue introduced in 5.5 with commit 04e5b1fb01834a602acaae2276b67a783a8c6159 and fixed in 6.6.108 with commit 4f364023ddcfe83f7073b973a9cb98584b7f2a46
	Issue introduced in 5.5 with commit 04e5b1fb01834a602acaae2276b67a783a8c6159 and fixed in 6.12.49 with commit 00e98b5a69034b251bb36dc6e7123d7648e218e4
	Issue introduced in 5.5 with commit 04e5b1fb01834a602acaae2276b67a783a8c6159 and fixed in 6.16.9 with commit c2ff91255e0157b356cff115d8dc3eeb5162edf2
	Issue introduced in 5.5 with commit 04e5b1fb01834a602acaae2276b67a783a8c6159 and fixed in 6.17 with commit 7ebf70cf181651fe3f2e44e95e7e5073d594c9c0

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39951
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	arch/um/drivers/virtio_uml.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/aaf900a83508c8cd5cdf765e7749f9076196ec7f
	https://git.kernel.org/stable/c/4f364023ddcfe83f7073b973a9cb98584b7f2a46
	https://git.kernel.org/stable/c/00e98b5a69034b251bb36dc6e7123d7648e218e4
	https://git.kernel.org/stable/c/c2ff91255e0157b356cff115d8dc3eeb5162edf2
	https://git.kernel.org/stable/c/7ebf70cf181651fe3f2e44e95e7e5073d594c9c0
