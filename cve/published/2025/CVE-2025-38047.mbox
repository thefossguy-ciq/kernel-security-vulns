From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38047: x86/fred: Fix system hang during S4 resume with FRED enabled

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

x86/fred: Fix system hang during S4 resume with FRED enabled

Upon a wakeup from S4, the restore kernel starts and initializes the
FRED MSRs as needed from its perspective.  It then loads a hibernation
image, including the image kernel, and attempts to load image pages
directly into their original page frames used before hibernation unless
those frames are currently in use.  Once all pages are moved to their
original locations, it jumps to a "trampoline" page in the image kernel.

At this point, the image kernel takes control, but the FRED MSRs still
contain values set by the restore kernel, which may differ from those
set by the image kernel before hibernation.  Therefore, the image kernel
must ensure the FRED MSRs have the same values as before hibernation.
Since these values depend only on the location of the kernel text and
data, they can be recomputed from scratch.

The Linux kernel CVE team has assigned CVE-2025-38047 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.9 with commit ff45746fbf005f96e42bea466698e3fdbf926013 and fixed in 6.12.31 with commit c42f740a07eea4807e98d2d8febc549c957a7b49
	Issue introduced in 6.9 with commit ff45746fbf005f96e42bea466698e3fdbf926013 and fixed in 6.14.9 with commit e7090fe75a2826363c71ad1fb4e95e58141478df
	Issue introduced in 6.9 with commit ff45746fbf005f96e42bea466698e3fdbf926013 and fixed in 6.15 with commit e5f1e8af9c9e151ecd665f6d2e36fb25fec3b110

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38047
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	arch/x86/power/cpu.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/c42f740a07eea4807e98d2d8febc549c957a7b49
	https://git.kernel.org/stable/c/e7090fe75a2826363c71ad1fb4e95e58141478df
	https://git.kernel.org/stable/c/e5f1e8af9c9e151ecd665f6d2e36fb25fec3b110
