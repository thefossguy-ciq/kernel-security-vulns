From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38685: fbdev: Fix vmalloc out-of-bounds write in fast_imageblit

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

fbdev: Fix vmalloc out-of-bounds write in fast_imageblit

This issue triggers when a userspace program does an ioctl
FBIOPUT_CON2FBMAP by passing console number and frame buffer number.
Ideally this maps console to frame buffer and updates the screen if
console is visible.

As part of mapping it has to do resize of console according to frame
buffer info. if this resize fails and returns from vc_do_resize() and
continues further. At this point console and new frame buffer are mapped
and sets display vars. Despite failure still it continue to proceed
updating the screen at later stages where vc_data is related to previous
frame buffer and frame buffer info and display vars are mapped to new
frame buffer and eventully leading to out-of-bounds write in
fast_imageblit(). This bheviour is excepted only when fg_console is
equal to requested console which is a visible console and updates screen
with invalid struct references in fbcon_putcs().

The Linux kernel CVE team has assigned CVE-2025-38685 to this issue.


Affected and fixed versions
===========================

	Fixed in 5.15.190 with commit 078e62bffca4b7e72e8f3550eb063ab981c36c7a
	Fixed in 6.1.149 with commit 4c4d7ddaf1d43780b106bedc692679f965dc5a3a
	Fixed in 6.6.103 with commit 27b118aebdd84161c8ff5ce49d9d536f2af10754
	Fixed in 6.12.43 with commit ed9b8e5016230868c8d813d9179523f729fec8c6
	Fixed in 6.15.11 with commit 56701bf9eeb63219e378cb7fcbd066ea4eaeeb50
	Fixed in 6.16.2 with commit cfec17721265e72e50cc69c6004fe3475cd38df2
	Fixed in 6.17 with commit af0db3c1f898144846d4c172531a199bb3ca375d

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38685
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/video/fbdev/core/fbcon.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/078e62bffca4b7e72e8f3550eb063ab981c36c7a
	https://git.kernel.org/stable/c/4c4d7ddaf1d43780b106bedc692679f965dc5a3a
	https://git.kernel.org/stable/c/27b118aebdd84161c8ff5ce49d9d536f2af10754
	https://git.kernel.org/stable/c/ed9b8e5016230868c8d813d9179523f729fec8c6
	https://git.kernel.org/stable/c/56701bf9eeb63219e378cb7fcbd066ea4eaeeb50
	https://git.kernel.org/stable/c/cfec17721265e72e50cc69c6004fe3475cd38df2
	https://git.kernel.org/stable/c/af0db3c1f898144846d4c172531a199bb3ca375d
