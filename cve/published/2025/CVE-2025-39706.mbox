From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39706: drm/amdkfd: Destroy KFD debugfs after destroy KFD wq

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/amdkfd: Destroy KFD debugfs after destroy KFD wq

Since KFD proc content was moved to kernel debugfs, we can't destroy KFD
debugfs before kfd_process_destroy_wq. Move kfd_process_destroy_wq prior
to kfd_debugfs_fini to fix a kernel NULL pointer problem. It happens
when /sys/kernel/debug/kfd was already destroyed in kfd_debugfs_fini but
kfd_process_destroy_wq calls kfd_debugfs_remove_process. This line
    debugfs_remove_recursive(entry->proc_dentry);
tries to remove /sys/kernel/debug/kfd/proc/<pid> while
/sys/kernel/debug/kfd is already gone. It hangs the kernel by kernel
NULL pointer.

(cherry picked from commit 0333052d90683d88531558dcfdbf2525cc37c233)

The Linux kernel CVE team has assigned CVE-2025-39706 to this issue.


Affected and fixed versions
===========================

	Fixed in 6.1.149 with commit fc35c955da799ba62f6f977d58e0866d0251e3f8
	Fixed in 6.6.103 with commit 74ee7445c3b61c3bd899a54bd82c1982cb3a8206
	Fixed in 6.12.44 with commit 96609a51e6134542bf90e053c2cd2fe4f61ebce3
	Fixed in 6.16.4 with commit 910735ded17cc306625e7e1cdcc8102f7ac60994
	Fixed in 6.17-rc1 with commit 2e58401a24e7b2d4ec619104e1a76590c1284a4c

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39706
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/amd/amdkfd/kfd_module.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/fc35c955da799ba62f6f977d58e0866d0251e3f8
	https://git.kernel.org/stable/c/74ee7445c3b61c3bd899a54bd82c1982cb3a8206
	https://git.kernel.org/stable/c/96609a51e6134542bf90e053c2cd2fe4f61ebce3
	https://git.kernel.org/stable/c/910735ded17cc306625e7e1cdcc8102f7ac60994
	https://git.kernel.org/stable/c/2e58401a24e7b2d4ec619104e1a76590c1284a4c
