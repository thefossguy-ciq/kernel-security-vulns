From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38703: drm/xe: Make dma-fences compliant with the safe access rules
Message-Id: <2025090453-CVE-2025-38703-2f5c@gregkh>
Content-Length: 2685
Lines: 65
X-Developer-Signature: v=1; a=openpgp-sha256; l=2751;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=4J+YDiyWnQgVUk44sgHiACRXVGGg6QGd/1Mh2fKE1Gk=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBk7N6o1ftzVZz/pzsdrHxZ17ryz7pNATEJp7IwNbe9rN
 ik+FuNd2BHLwiDIxCArpsjyZRvP0f0VhxS9DG1Pw8xhZQIZwsDFKQATOXScYUHv2TsyUy5v0kqb
 8f/nqi4Zp2nBlVMZFizlXd76+E2Owy/2TWZr/PeLOmy/yQ0A
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/xe: Make dma-fences compliant with the safe access rules

Xe can free some of the data pointed to by the dma-fences it exports. Most
notably the timeline name can get freed if userspace closes the associated
submit queue. At the same time the fence could have been exported to a
third party (for example a sync_fence fd) which will then cause an use-
after-free on subsequent access.

To make this safe we need to make the driver compliant with the newly
documented dma-fence rules. Driver has to ensure a RCU grace period
between signalling a fence and freeing any data pointed to by said fence.

For the timeline name we simply make the queue be freed via kfree_rcu and
for the shared lock associated with multiple queues we add a RCU grace
period before freeing the per GT structure holding the lock.

The Linux kernel CVE team has assigned CVE-2025-38703 to this issue.


Affected and fixed versions
===========================

	Fixed in 6.12.43 with commit b17fcce70733c211cb5dabf54f4f9491920b1d92
	Fixed in 6.15.11 with commit ba37807d08bae67de6139346a85650cab5f6145a
	Fixed in 6.16.2 with commit 683b0e397dad9f26a42dcacf6f7f545a77ce6c06
	Fixed in 6.17-rc1 with commit 6bd90e700b4285e6a7541e00f969cab0d696adde

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38703
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/xe/xe_guc_exec_queue_types.h
	drivers/gpu/drm/xe/xe_guc_submit.c
	drivers/gpu/drm/xe/xe_hw_fence.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/b17fcce70733c211cb5dabf54f4f9491920b1d92
	https://git.kernel.org/stable/c/ba37807d08bae67de6139346a85650cab5f6145a
	https://git.kernel.org/stable/c/683b0e397dad9f26a42dcacf6f7f545a77ce6c06
	https://git.kernel.org/stable/c/6bd90e700b4285e6a7541e00f969cab0d696adde
