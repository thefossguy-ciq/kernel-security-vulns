From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38510: kasan: remove kasan_find_vm_area() to prevent possible deadlock
Message-Id: <2025081651-CVE-2025-38510-f67d@gregkh>
Content-Length: 3279
Lines: 72
X-Developer-Signature: v=1; a=openpgp-sha256; l=3352;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=5zOMchfpnyzhnManZhKU6ECQ9DxmzIJ8QijjMSoCb0k=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDBkLUvQV5DQts3ZltsZlaSZ//DXNz0r9R5pqbtmlqg2CA
 c+Vpj7oiGVhEGRikBVTZPmyjefo/opDil6Gtqdh5rAygQxh4OIUgInMv8Mwv6rk9lbRmsuR0qVP
 NGwjDkkXSqTHM8wV4WVb/Ll5duH3FRoWna3Z99qsRe8AAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

kasan: remove kasan_find_vm_area() to prevent possible deadlock

find_vm_area() couldn't be called in atomic_context.  If find_vm_area() is
called to reports vm area information, kasan can trigger deadlock like:

CPU0                                CPU1
vmalloc();
 alloc_vmap_area();
  spin_lock(&vn->busy.lock)
                                    spin_lock_bh(&some_lock);
   <interrupt occurs>
   <in softirq>
   spin_lock(&some_lock);
                                    <access invalid address>
                                    kasan_report();
                                     print_report();
                                      print_address_description();
                                       kasan_find_vm_area();
                                        find_vm_area();
                                         spin_lock(&vn->busy.lock) // deadlock!

To prevent possible deadlock while kasan reports, remove kasan_find_vm_area().

The Linux kernel CVE team has assigned CVE-2025-38510 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.18 with commit c056a364e9546bd513d1f5205f0ee316d8acb910 and fixed in 6.1.146 with commit 595f78d99b9051600233c0a5c4c47e1097e6ed01
	Issue introduced in 5.18 with commit c056a364e9546bd513d1f5205f0ee316d8acb910 and fixed in 6.6.99 with commit 8377d7744bdce5c4b3f1b58924eebd3fdc078dfc
	Issue introduced in 5.18 with commit c056a364e9546bd513d1f5205f0ee316d8acb910 and fixed in 6.12.39 with commit 2d89dab1ea6086e6cbe6fe92531b496fb6808cb9
	Issue introduced in 5.18 with commit c056a364e9546bd513d1f5205f0ee316d8acb910 and fixed in 6.15.7 with commit 0c3566d831def922cd56322c772a7b20d8b0e0c0
	Issue introduced in 5.18 with commit c056a364e9546bd513d1f5205f0ee316d8acb910 and fixed in 6.16 with commit 6ee9b3d84775944fb8c8a447961cd01274ac671c

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38510
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	mm/kasan/report.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/595f78d99b9051600233c0a5c4c47e1097e6ed01
	https://git.kernel.org/stable/c/8377d7744bdce5c4b3f1b58924eebd3fdc078dfc
	https://git.kernel.org/stable/c/2d89dab1ea6086e6cbe6fe92531b496fb6808cb9
	https://git.kernel.org/stable/c/0c3566d831def922cd56322c772a7b20d8b0e0c0
	https://git.kernel.org/stable/c/6ee9b3d84775944fb8c8a447961cd01274ac671c
