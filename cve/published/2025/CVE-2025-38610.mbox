From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38610: powercap: dtpm_cpu: Fix NULL pointer dereference in get_pd_power_uw()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

powercap: dtpm_cpu: Fix NULL pointer dereference in get_pd_power_uw()

The get_pd_power_uw() function can crash with a NULL pointer dereference
when em_cpu_get() returns NULL. This occurs when a CPU becomes impossible
during runtime, causing get_cpu_device() to return NULL, which propagates
through em_cpu_get() and leads to a crash when em_span_cpus() dereferences
the NULL pointer.

Add a NULL check after em_cpu_get() and return 0 if unavailable,
matching the existing fallback behavior in __dtpm_cpu_setup().

[ rjw: Drop an excess empty code line ]

The Linux kernel CVE team has assigned CVE-2025-38610 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.16 with commit eb82bace893169b319c563b7f813c58a0a5a9f76 and fixed in 6.1.148 with commit 27914f2b795e2b58e9506f281dcdd98fef09d3c2
	Issue introduced in 5.16 with commit eb82bace893169b319c563b7f813c58a0a5a9f76 and fixed in 6.6.102 with commit c6ec27091cf5ac05094c1fe3a6ce914cf711a37c
	Issue introduced in 5.16 with commit eb82bace893169b319c563b7f813c58a0a5a9f76 and fixed in 6.12.42 with commit 8374ac7d69a57d737e701a851ffe980a0d27d3ad
	Issue introduced in 5.16 with commit eb82bace893169b319c563b7f813c58a0a5a9f76 and fixed in 6.15.10 with commit 27e0318f0ea69fcfa32228847debc384ade14578
	Issue introduced in 5.16 with commit eb82bace893169b319c563b7f813c58a0a5a9f76 and fixed in 6.16.1 with commit 2fd001a0075ac01dc64a28a8e21226b3d989a91d
	Issue introduced in 5.16 with commit eb82bace893169b319c563b7f813c58a0a5a9f76 and fixed in 6.17-rc1 with commit 46dc57406887dd02565cb264224194a6776d882b

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38610
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/powercap/dtpm_cpu.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/27914f2b795e2b58e9506f281dcdd98fef09d3c2
	https://git.kernel.org/stable/c/c6ec27091cf5ac05094c1fe3a6ce914cf711a37c
	https://git.kernel.org/stable/c/8374ac7d69a57d737e701a851ffe980a0d27d3ad
	https://git.kernel.org/stable/c/27e0318f0ea69fcfa32228847debc384ade14578
	https://git.kernel.org/stable/c/2fd001a0075ac01dc64a28a8e21226b3d989a91d
	https://git.kernel.org/stable/c/46dc57406887dd02565cb264224194a6776d882b
