From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-38226: media: vivid: Change the siize of the composing

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

media: vivid: Change the siize of the composing

syzkaller found a bug:

BUG: KASAN: vmalloc-out-of-bounds in tpg_fill_plane_pattern drivers/media/common/v4l2-tpg/v4l2-tpg-core.c:2608 [inline]
BUG: KASAN: vmalloc-out-of-bounds in tpg_fill_plane_buffer+0x1a9c/0x5af0 drivers/media/common/v4l2-tpg/v4l2-tpg-core.c:2705
Write of size 1440 at addr ffffc9000d0ffda0 by task vivid-000-vid-c/5304

CPU: 0 UID: 0 PID: 5304 Comm: vivid-000-vid-c Not tainted 6.14.0-rc2-syzkaller-00039-g09fbf3d50205 #0
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-debian-1.16.3-2~bpo12+1 04/01/2014

Call Trace:
 <TASK>
 __dump_stack lib/dump_stack.c:94 [inline]
 dump_stack_lvl+0x241/0x360 lib/dump_stack.c:120
 print_address_description mm/kasan/report.c:378 [inline]
 print_report+0x169/0x550 mm/kasan/report.c:489
 kasan_report+0x143/0x180 mm/kasan/report.c:602
 kasan_check_range+0x282/0x290 mm/kasan/generic.c:189
 __asan_memcpy+0x40/0x70 mm/kasan/shadow.c:106
 tpg_fill_plane_pattern drivers/media/common/v4l2-tpg/v4l2-tpg-core.c:2608 [inline]
 tpg_fill_plane_buffer+0x1a9c/0x5af0 drivers/media/common/v4l2-tpg/v4l2-tpg-core.c:2705
 vivid_fillbuff drivers/media/test-drivers/vivid/vivid-kthread-cap.c:470 [inline]
 vivid_thread_vid_cap_tick+0xf8e/0x60d0 drivers/media/test-drivers/vivid/vivid-kthread-cap.c:629
 vivid_thread_vid_cap+0x8aa/0xf30 drivers/media/test-drivers/vivid/vivid-kthread-cap.c:767
 kthread+0x7a9/0x920 kernel/kthread.c:464
 ret_from_fork+0x4b/0x80 arch/x86/kernel/process.c:148
 ret_from_fork_asm+0x1a/0x30 arch/x86/entry/entry_64.S:244
 </TASK>

The composition size cannot be larger than the size of fmt_cap_rect.
So execute v4l2_rect_map_inside() even if has_compose_cap == 0.

The Linux kernel CVE team has assigned CVE-2025-38226 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.4.229 with commit 54f259906039dbfe46c550011409fa16f72370f6 and fixed in 5.4.296 with commit 57597d8db5bbda618ba2145b7e8a7e6f01b6a27e
	Issue introduced in 5.10.163 with commit f9d19f3a044ca651b0be52a4bf951ffe74259b9f and fixed in 5.10.239 with commit 635cea4f44c1ddae208666772c164eab5a6bce39
	Issue introduced in 5.15.86 with commit ab54081a2843aefb837812fac5488cc8f1696142 and fixed in 5.15.186 with commit 89b5ab822bf69867c3951dd0eb34b0314c38966b
	Issue introduced in 6.1.2 with commit 2f558c5208b0f70c8140e08ce09fcc84da48e789 and fixed in 6.1.142 with commit 5d89aa42534723400fefd46e26e053b9c382b4ee
	Issue introduced in 6.2 with commit 94a7ad9283464b75b12516c5512541d467cefcf8 and fixed in 6.6.95 with commit f6b1b0f8ba0b61d8b511df5649d57235f230c135
	Issue introduced in 6.2 with commit 94a7ad9283464b75b12516c5512541d467cefcf8 and fixed in 6.12.35 with commit 00da1c767a6567e56f23dda586847586868ac064
	Issue introduced in 6.2 with commit 94a7ad9283464b75b12516c5512541d467cefcf8 and fixed in 6.15.4 with commit c56398885716d97ee9bcadb2bc9663a8c1757a34
	Issue introduced in 6.2 with commit 94a7ad9283464b75b12516c5512541d467cefcf8 and fixed in 6.16 with commit f83ac8d30c43fd902af7c84c480f216157b60ef0
	Issue introduced in 4.9.337 with commit 8c0ee15d9a102c732d0745566d254040085d5663
	Issue introduced in 4.14.303 with commit 5edc3604151919da8da0fb092b71d7dce07d848a
	Issue introduced in 4.19.270 with commit 9c7fba9503b826f0c061d136f8f0c9f953ed18b9
	Issue introduced in 6.0.16 with commit ccb5392c4fea0e7d9f7ab35567e839d74cb3998b

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-38226
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/media/test-drivers/vivid/vivid-vid-cap.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/57597d8db5bbda618ba2145b7e8a7e6f01b6a27e
	https://git.kernel.org/stable/c/635cea4f44c1ddae208666772c164eab5a6bce39
	https://git.kernel.org/stable/c/89b5ab822bf69867c3951dd0eb34b0314c38966b
	https://git.kernel.org/stable/c/5d89aa42534723400fefd46e26e053b9c382b4ee
	https://git.kernel.org/stable/c/f6b1b0f8ba0b61d8b511df5649d57235f230c135
	https://git.kernel.org/stable/c/00da1c767a6567e56f23dda586847586868ac064
	https://git.kernel.org/stable/c/c56398885716d97ee9bcadb2bc9663a8c1757a34
	https://git.kernel.org/stable/c/f83ac8d30c43fd902af7c84c480f216157b60ef0
