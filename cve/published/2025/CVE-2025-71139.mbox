From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-71139: kernel/kexec: fix IMA when allocation happens in CMA area
Message-Id: <2026011455-CVE-2025-71139-5d93@gregkh>
Content-Length: 2927
Lines: 77
X-Developer-Signature: v=1; a=openpgp-sha256; l=3005;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=sTbfFRYvQ4ZFhAaroQ91wtLlOctez4w51BC0aeDNGjw=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJnpG73XZB51+30y8PljriiGTeWcfzKfLo1mqn3DuXDG9
 h/XvFMmdsSyMAgyMciKKbJ82cZzdH/FIUUvQ9vTMHNYmUCGMHBxCsBEnDgZ5jt2O2zRn3msLj60
 SKBxxuYzr8N3HmCYn3Li9/Onvbxxtiuil9jk7E++PP9gLAA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

kernel/kexec: fix IMA when allocation happens in CMA area

*** Bug description ***

When I tested kexec with the latest kernel, I ran into the following warning:

[   40.712410] ------------[ cut here ]------------
[   40.712576] WARNING: CPU: 2 PID: 1562 at kernel/kexec_core.c:1001 kimage_map_segment+0x144/0x198
[...]
[   40.816047] Call trace:
[   40.818498]  kimage_map_segment+0x144/0x198 (P)
[   40.823221]  ima_kexec_post_load+0x58/0xc0
[   40.827246]  __do_sys_kexec_file_load+0x29c/0x368
[...]
[   40.855423] ---[ end trace 0000000000000000 ]---

*** How to reproduce ***

This bug is only triggered when the kexec target address is allocated in
the CMA area. If no CMA area is reserved in the kernel, use the "cma="
option in the kernel command line to reserve one.

*** Root cause ***
The commit 07d24902977e ("kexec: enable CMA based contiguous
allocation") allocates the kexec target address directly on the CMA area
to avoid copying during the jump. In this case, there is no IND_SOURCE
for the kexec segment.  But the current implementation of
kimage_map_segment() assumes that IND_SOURCE pages exist and map them
into a contiguous virtual address by vmap().

*** Solution ***
If IMA segment is allocated in the CMA area, use its page_address()
directly.

The Linux kernel CVE team has assigned CVE-2025-71139 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.17 with commit 07d24902977e4704fab8472981e73a0ad6dfa1fd and fixed in 6.18.4 with commit a843e4155c83211c55b1b6cc17eab27a6a2c5b6f
	Issue introduced in 6.17 with commit 07d24902977e4704fab8472981e73a0ad6dfa1fd and fixed in 6.19-rc4 with commit a3785ae5d334bb71d47a593d54c686a03fb9d136

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-71139
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	kernel/kexec_core.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/a843e4155c83211c55b1b6cc17eab27a6a2c5b6f
	https://git.kernel.org/stable/c/a3785ae5d334bb71d47a593d54c686a03fb9d136
