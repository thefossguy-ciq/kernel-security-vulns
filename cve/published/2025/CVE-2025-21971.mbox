From bippy-7c5fe7eed585 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-21971: net_sched: Prevent creation of classes with TC_H_ROOT

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net_sched: Prevent creation of classes with TC_H_ROOT

The function qdisc_tree_reduce_backlog() uses TC_H_ROOT as a termination
condition when traversing up the qdisc tree to update parent backlog
counters. However, if a class is created with classid TC_H_ROOT, the
traversal terminates prematurely at this class instead of reaching the
actual root qdisc, causing parent statistics to be incorrectly maintained.
In case of DRR, this could lead to a crash as reported by Mingi Cho.

Prevent the creation of any Qdisc class with classid TC_H_ROOT
(0xFFFFFFFF) across all qdisc types, as suggested by Jamal.

The Linux kernel CVE team has assigned CVE-2025-21971 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.25 with commit 066a3b5b2346febf9a655b444567b7138e3bb939 and fixed in 5.4.292 with commit e05d9938b1b0ac40b6054cc5fa0ccbd9afd5ed4c
	Issue introduced in 2.6.25 with commit 066a3b5b2346febf9a655b444567b7138e3bb939 and fixed in 5.10.236 with commit 7a82fe67a9f4d7123d8e5ba8f0f0806c28695006
	Issue introduced in 2.6.25 with commit 066a3b5b2346febf9a655b444567b7138e3bb939 and fixed in 5.15.180 with commit 003d92c91cdb5a64b25a9a74cb8543aac9a8bb48
	Issue introduced in 2.6.25 with commit 066a3b5b2346febf9a655b444567b7138e3bb939 and fixed in 6.1.132 with commit e5ee00607bbfc97ef1526ea95b6b2458ac9e7cb7
	Issue introduced in 2.6.25 with commit 066a3b5b2346febf9a655b444567b7138e3bb939 and fixed in 6.6.84 with commit 78533c4a29ac3aeddce4b481770beaaa4f3bfb67
	Issue introduced in 2.6.25 with commit 066a3b5b2346febf9a655b444567b7138e3bb939 and fixed in 6.12.20 with commit 5c3ca9cb48b51bd72bf76b8b05e24f3cd53db5e7
	Issue introduced in 2.6.25 with commit 066a3b5b2346febf9a655b444567b7138e3bb939 and fixed in 6.13.8 with commit 94edfdfb9505ab608e86599d1d1e38c83816fc1c
	Issue introduced in 2.6.25 with commit 066a3b5b2346febf9a655b444567b7138e3bb939 and fixed in 6.14 with commit 0c3057a5a04d07120b3d0ec9c79568fceb9c921e

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-21971
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/sched/sch_api.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/e05d9938b1b0ac40b6054cc5fa0ccbd9afd5ed4c
	https://git.kernel.org/stable/c/7a82fe67a9f4d7123d8e5ba8f0f0806c28695006
	https://git.kernel.org/stable/c/003d92c91cdb5a64b25a9a74cb8543aac9a8bb48
	https://git.kernel.org/stable/c/e5ee00607bbfc97ef1526ea95b6b2458ac9e7cb7
	https://git.kernel.org/stable/c/78533c4a29ac3aeddce4b481770beaaa4f3bfb67
	https://git.kernel.org/stable/c/5c3ca9cb48b51bd72bf76b8b05e24f3cd53db5e7
	https://git.kernel.org/stable/c/94edfdfb9505ab608e86599d1d1e38c83816fc1c
	https://git.kernel.org/stable/c/0c3057a5a04d07120b3d0ec9c79568fceb9c921e
