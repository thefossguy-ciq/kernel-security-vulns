From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-71125: tracing: Do not register unsupported perf events

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

tracing: Do not register unsupported perf events

Synthetic events currently do not have a function to register perf events.
This leads to calling the tracepoint register functions with a NULL
function pointer which triggers:

 ------------[ cut here ]------------
 WARNING: kernel/tracepoint.c:175 at tracepoint_add_func+0x357/0x370, CPU#2: perf/2272
 Modules linked in: kvm_intel kvm irqbypass
 CPU: 2 UID: 0 PID: 2272 Comm: perf Not tainted 6.18.0-ftest-11964-ge022764176fc-dirty #323 PREEMPTLAZY
 Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.17.0-debian-1.17.0-1 04/01/2014
 RIP: 0010:tracepoint_add_func+0x357/0x370
 Code: 28 9c e8 4c 0b f5 ff eb 0f 4c 89 f7 48 c7 c6 80 4d 28 9c e8 ab 89 f4 ff 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc cc <0f> 0b 49 c7 c6 ea ff ff ff e9 ee fe ff ff 0f 0b e9 f9 fe ff ff 0f
 RSP: 0018:ffffabc0c44d3c40 EFLAGS: 00010246
 RAX: 0000000000000001 RBX: ffff9380aa9e4060 RCX: 0000000000000000
 RDX: 000000000000000a RSI: ffffffff9e1d4a98 RDI: ffff937fcf5fd6c8
 RBP: 0000000000000001 R08: 0000000000000007 R09: ffff937fcf5fc780
 R10: 0000000000000003 R11: ffffffff9c193910 R12: 000000000000000a
 R13: ffffffff9e1e5888 R14: 0000000000000000 R15: ffffabc0c44d3c78
 FS:  00007f6202f5f340(0000) GS:ffff93819f00f000(0000) knlGS:0000000000000000
 CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
 CR2: 000055d3162281a8 CR3: 0000000106a56003 CR4: 0000000000172ef0
 Call Trace:
  <TASK>
  tracepoint_probe_register+0x5d/0x90
  synth_event_reg+0x3c/0x60
  perf_trace_event_init+0x204/0x340
  perf_trace_init+0x85/0xd0
  perf_tp_event_init+0x2e/0x50
  perf_try_init_event+0x6f/0x230
  ? perf_event_alloc+0x4bb/0xdc0
  perf_event_alloc+0x65a/0xdc0
  __se_sys_perf_event_open+0x290/0x9f0
  do_syscall_64+0x93/0x7b0
  ? entry_SYSCALL_64_after_hwframe+0x76/0x7e
  ? trace_hardirqs_off+0x53/0xc0
  entry_SYSCALL_64_after_hwframe+0x76/0x7e

Instead, have the code return -ENODEV, which doesn't warn and has perf
error out with:

 # perf record -e synthetic:futex_wait
Error:
The sys_perf_event_open() syscall returned with 19 (No such device) for event (synthetic:futex_wait).
"dmesg | grep -i perf" may provide additional information.

Ideally perf should support synthetic events, but for now just fix the
warning. The support can come later.

The Linux kernel CVE team has assigned CVE-2025-71125 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.17 with commit 4b147936fa509650beaf638b331573c23ba4d609 and fixed in 5.10.248 with commit 6819bc6285c0ff835f67cfae7efebc03541782f6
	Issue introduced in 4.17 with commit 4b147936fa509650beaf638b331573c23ba4d609 and fixed in 5.15.198 with commit 6d15f08e6d8d4b4fb02d90805ea97f3e2c1d6fbc
	Issue introduced in 4.17 with commit 4b147936fa509650beaf638b331573c23ba4d609 and fixed in 6.1.160 with commit f7305697b60d79bc69c0a6e280fc931b4e8862dd
	Issue introduced in 4.17 with commit 4b147936fa509650beaf638b331573c23ba4d609 and fixed in 6.6.120 with commit 65b1971147ec12f0b1cee0811c859a3d7d9b04ce
	Issue introduced in 4.17 with commit 4b147936fa509650beaf638b331573c23ba4d609 and fixed in 6.12.64 with commit 3437c775bf209c674ad66304213b6b3c3b1b3f69
	Issue introduced in 4.17 with commit 4b147936fa509650beaf638b331573c23ba4d609 and fixed in 6.18.3 with commit 6df47e5bb9b62d72f186f826ab643ea1856877c7
	Issue introduced in 4.17 with commit 4b147936fa509650beaf638b331573c23ba4d609 and fixed in 6.19 with commit ef7f38df890f5dcd2ae62f8dbde191d72f3bebae

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-71125
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	kernel/trace/trace_events.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/6819bc6285c0ff835f67cfae7efebc03541782f6
	https://git.kernel.org/stable/c/6d15f08e6d8d4b4fb02d90805ea97f3e2c1d6fbc
	https://git.kernel.org/stable/c/f7305697b60d79bc69c0a6e280fc931b4e8862dd
	https://git.kernel.org/stable/c/65b1971147ec12f0b1cee0811c859a3d7d9b04ce
	https://git.kernel.org/stable/c/3437c775bf209c674ad66304213b6b3c3b1b3f69
	https://git.kernel.org/stable/c/6df47e5bb9b62d72f186f826ab643ea1856877c7
	https://git.kernel.org/stable/c/ef7f38df890f5dcd2ae62f8dbde191d72f3bebae
