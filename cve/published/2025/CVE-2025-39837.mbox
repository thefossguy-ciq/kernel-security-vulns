From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39837: platform/x86: asus-wmi: Fix racy registrations

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

platform/x86: asus-wmi: Fix racy registrations

asus_wmi_register_driver() may be called from multiple drivers
concurrently, which can lead to the racy list operations, eventually
corrupting the memory and hitting Oops on some ASUS machines.
Also, the error handling is missing, and it forgot to unregister ACPI
lps0 dev ops in the error case.

This patch covers those issues by introducing a simple mutex at
acpi_wmi_register_driver() & *_unregister_driver, and adding the
proper call of asus_s2idle_check_unregister() in the error path.

The Linux kernel CVE team has assigned CVE-2025-39837 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.16 with commit feea7bd6b02d43a794e3f065650d89cf8d8e8e59 and fixed in 6.16.6 with commit e7a70326fb26b905cfc8fe2366113aa4394733ef
	Issue introduced in 6.16 with commit feea7bd6b02d43a794e3f065650d89cf8d8e8e59 and fixed in 6.17-rc5 with commit 5549202b9c02c2ecbc8634768a3da8d9e82d548d

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39837
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/platform/x86/asus-wmi.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/e7a70326fb26b905cfc8fe2366113aa4394733ef
	https://git.kernel.org/stable/c/5549202b9c02c2ecbc8634768a3da8d9e82d548d
