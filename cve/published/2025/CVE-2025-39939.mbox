From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-39939: iommu/s390: Fix memory corruption when using identity domain

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

iommu/s390: Fix memory corruption when using identity domain

zpci_get_iommu_ctrs() returns counter information to be reported as part
of device statistics; these counters are stored as part of the s390_domain.
The problem, however, is that the identity domain is not backed by an
s390_domain and so the conversion via to_s390_domain() yields a bad address
that is zero'd initially and read on-demand later via a sysfs read.
These counters aren't necessary for the identity domain; just return NULL
in this case.

This issue was discovered via KASAN with reports that look like:
BUG: KASAN: global-out-of-bounds in zpci_fmb_enable_device
when using the identity domain for a device on s390.

The Linux kernel CVE team has assigned CVE-2025-39939 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.15 with commit 64af12c6ec3afd7d44bc8b2044eee59f98059087 and fixed in 6.16.9 with commit 17a58caf3863163c4a84a218a9649be2c8061443
	Issue introduced in 6.15 with commit 64af12c6ec3afd7d44bc8b2044eee59f98059087 and fixed in 6.17 with commit b3506e9bcc777ed6af2ab631c86a9990ed97b474

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-39939
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/iommu/s390-iommu.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/17a58caf3863163c4a84a218a9649be2c8061443
	https://git.kernel.org/stable/c/b3506e9bcc777ed6af2ab631c86a9990ed97b474
