From bippy-1.2.0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@kernel.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-40359: perf/x86/intel: Fix KASAN global-out-of-bounds warning
Message-Id: <2025121644-CVE-2025-40359-143c@gregkh>
Content-Length: 2770
Lines: 71
X-Developer-Signature: v=1; a=openpgp-sha256; l=2842;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=YB/ObfKW8GPd8GuuuLsKDXtMhtqzsuZx8q7pmxCrCxY=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDJmOiTF8b7lMlObvnNHoM2ua4YntN+R03nn+sumbcdXj3
 oyKNrO5HbEsDIJMDLJiiixftvEc3V9xSNHL0PY0zBxWJpAhDFycAjCRmyYMs9klblj8yQ/iy2W6
 sTY+fc3j64lcLxjmWc0M/rDHrMRwaT9L5elAn9r51/qYAQ==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

perf/x86/intel: Fix KASAN global-out-of-bounds warning

When running "perf mem record" command on CWF, the below KASAN
global-out-of-bounds warning is seen.

  ==================================================================
  BUG: KASAN: global-out-of-bounds in cmt_latency_data+0x176/0x1b0
  Read of size 4 at addr ffffffffb721d000 by task dtlb/9850

  Call Trace:

   kasan_report+0xb8/0xf0
   cmt_latency_data+0x176/0x1b0
   setup_arch_pebs_sample_data+0xf49/0x2560
   intel_pmu_drain_arch_pebs+0x577/0xb00
   handle_pmi_common+0x6c4/0xc80

The issue is caused by below code in __grt_latency_data(). The code
tries to access x86_hybrid_pmu structure which doesn't exist on
non-hybrid platform like CWF.

        WARN_ON_ONCE(hybrid_pmu(event->pmu)->pmu_type == hybrid_big)

So add is_hybrid() check before calling this WARN_ON_ONCE to fix the
global-out-of-bounds access issue.

The Linux kernel CVE team has assigned CVE-2025-40359 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.11 with commit 090262439f66df03d4e9d0e52e14104b729e2ef8 and fixed in 6.12.58 with commit 1b61a1da3d8105ea1be548c94c2856697eb7ffd1
	Issue introduced in 6.11 with commit 090262439f66df03d4e9d0e52e14104b729e2ef8 and fixed in 6.17.8 with commit 710a72e81a7028e1ad1a10eb14f941f8dd45ffd3
	Issue introduced in 6.11 with commit 090262439f66df03d4e9d0e52e14104b729e2ef8 and fixed in 6.18 with commit 0ba6502ce167fc3d598c08c2cc3b4ed7ca5aa251

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-40359
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	arch/x86/events/intel/ds.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/1b61a1da3d8105ea1be548c94c2856697eb7ffd1
	https://git.kernel.org/stable/c/710a72e81a7028e1ad1a10eb14f941f8dd45ffd3
	https://git.kernel.org/stable/c/0ba6502ce167fc3d598c08c2cc3b4ed7ca5aa251
